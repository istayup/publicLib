System.register(["./index-d48cc0ba.js","./animation-component-abfe5f7d.js","./director-39a00fed.js","./node-event-2a6499e4.js","./pipeline-state-manager-1c54311a.js","./buffer-barrier-a01f2732.js","./instantiate-d617f524.js","./move-30cd5838.js","./index-f463518e.js","./create-mesh-746ae60b.js","./deprecated-262b1482.js","./touch-029b049b.js","./mesh-renderer-14f7d58a.js","./mesh-7036037d.js","./deprecated-653e59b0.js","./deprecated-50ea3c1c.js","./model-renderer-2d8221ee.js","./renderer-3b929285.js","./util-eca09aa9.js","./capsule-4e336154.js","./skeleton-e819eef3.js","./camera-component-f1519417.js"],(function(t){"use strict";var e,n,i,r,o,a,s,u,l,c,h,f,p,d,v,_,y,g,m,E,T,A,b,C,S,w,P,O,N,I,x,R,k,L,M,D,B,F,U,V,G,W,z,j,H,Q,Y,q,Z,X,J,K,$,tt,et,nt,it,rt,ot,at,st,ut,lt,ct,ht,ft,pt,dt,vt,_t,yt,gt,mt,Et,Tt,At,bt,Ct,St,wt,Pt,Ot,Nt,It,xt,Rt,kt,Lt,Mt,Dt,Bt,Ft,Ut,Vt,Gt,Wt,zt,jt;return{setters:[function(t){e=t.bE,n=t.bF,i=t.bI,r=t.bC,o=t.aF,a=t.bj,s=t.f,u=t.w,l=t.cb,c=t.aT,h=t.d,f=t.bH,p=t.i,d=t.cz,v=t.cA,_=t.bz,y=t.o,g=t.Q,m=t.bM,E=t.aB,T=t.cB,A=t.bP,b=t.e,C=t.cC,S=t.bS,w=t.t,P=t.F,O=t.L,N=t.ae,I=t.cD,x=t.cE,R=t.c9,k=t.ck,L=t.by,M=t.cF,D=t.J,B=t.cG,F=t.bX,U=t.V,V=t.I,G=t.bL,W=t.bw,z=t.K,j=t.P,H=t.bV,Q=t.C,Y=t.bi,q=t.b3,Z=t.l,X=t.cj},function(e){J=e.C,K=e.A,$=e.c,tt=e.a,et=e.T,nt=e.i,it=e.e,rt=e.U,ot=e.b,at=e.t,st=e.n,ut=e.d,lt=e.f,ct=e.W,ht=e.g,ft=e.R,pt=e.V,dt=e.Q,vt=e.h,_t=e.S,yt=e.O,gt=e.j,mt=e.k,Et=e.H,Tt=e.l,At=e.m,bt=e.o,Ct=e.p,St=e.q,wt=e.r,t({AnimCurve:e.v,Animation:e.s,AnimationClip:e.f,AnimationComponent:e.s,AnimationState:e.A,EventInfo:e.E,RatioSampler:e.u,computeRatioByType:e.x,sampleAnimationCurve:e.w})},function(t){Pt=t.b4,Ot=t.a4,Nt=t.a1,It=t.a0,xt=t.be,Rt=t.bJ,kt=t.ax,Lt=t.aU,Mt=t.aT},function(t){Dt=t.A,Bt=t.C},function(t){Ft=t.d},function(t){Ut=t.T},function(t){Vt=t.i},function(t){Gt=t.s},function(){},function(){},function(e){Wt=e.g,zt=e.d,jt=e.c,t({getPathFromRoot:e.e,getWorldTransformUntilRoot:e.f})},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function(){var Ht,Qt,Yt,qt,Zt;e(J+"EmbeddedPlayer")((Ht=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).begin=Qt&&Qt(),e.end=Yt&&Yt(),e.reconciledSpeed=qt&&qt(),e.playable=Zt&&Zt(),e}return n(e,t),e}(o),Qt=i(Ht.prototype,"begin",[a],(function(){return 0})),Yt=i(Ht.prototype,"end",[a],(function(){return 0})),qt=i(Ht.prototype,"reconciledSpeed",[a],(function(){return!1})),Zt=i(Ht.prototype,"playable",[a],(function(){return null})),Ht));var Xt,Jt,Kt,$t=function(){},te=function(){function t(t){this._randomAccess=t}return t.prototype.setTime=function(){},r(t,[{key:"randomAccess",get:function(){return this._randomAccess}}]),t}();e(J+"EmbeddedAnimationClipPlayable")((Xt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).path=Jt&&Jt(),e.clip=Kt&&Kt(),e}return n(e,t),e.prototype.instantiate=function(t){var e=this.clip,n=this.path;if(!e)return null;var i=t.getChildByPath(n);if(!i)return s(3938,n,t.getPathInHierarchy(),e.name),null;var r=new K(e);return r.initialize(i),new ie(r)},e}($t),Jt=i(Xt.prototype,"path",[a],(function(){return""})),Kt=i(Xt.prototype,"clip",[a],(function(){return null})),Xt));var ee,ne,ie=function(t){function e(e){var n;return(n=t.call(this,!0)||this)._animationState=void 0,n._animationState=e,n}n(e,t);var i=e.prototype;return i.destroy=function(){this._animationState.destroy()},i.play=function(){this._animationState.play()},i.pause=function(){this._animationState.pause()},i.stop=function(){this._animationState.stop()},i.setSpeed=function(t){this._animationState.speed=t},i.setTime=function(t){this._animationState.time=t},e}(te);e(J+"EmbeddedParticleSystemPlayable")((ee=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).path=ne&&ne(),e}return n(e,t),e.prototype.instantiate=function(t){var e=t.getChildByPath(this.path);if(!e)return u("Hierarchy path "+this.path+" does not exists."),null;var n=l("cc.ParticleSystem");if(!n)return u("Particle system is required for embedded particle system player."),null;var i=e.getComponent(n);return i?new ae(i):(u(this.path+" does not includes a particle system component."),null)},e}($t),ne=i(ee.prototype,"path",[a],(function(){return""})),ee));var re,oe,ae=function(t){function e(e){var n;return(n=t.call(this,!1)||this)._particleSystem=void 0,n._particleSystem=e,n}n(e,t);var i=e.prototype;return i.destroy=function(){},i.play=function(){this._particleSystem.play()},i.pause=function(){this._particleSystem.stopEmitting()},i.stop=function(){this._particleSystem.stopEmitting()},i.setSpeed=function(t){this._particleSystem.simulationSpeed=t},e}(te),se=a;e(J+"RealArrayTrack")((re=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._channels=oe&&oe(),e}n(e,t);var i=e.prototype;return i.channels=function(){return this._channels},i[$]=function(){return new Ae(this._channels.map((function(t){return t.curve})))},r(e,[{key:"elementCount",get:function(){return this._channels.length},set:function(t){var e=this._channels.length;if(t<e)this._channels.splice(t);else if(t>e){var n;(n=this._channels).push.apply(n,Array.from({length:t-e},(function(){return new tt(new c)})))}}}]),e}(et),oe=i(re.prototype,"_channels",[se],(function(){return[]})),re));var ue,le,ce,he,fe,pe,de,ve,_e,ye,ge,me,Ee,Te,Ae=function(){function t(t){this._curves=t,this._result=new Array(t.length).fill(0)}return t.prototype.evaluate=function(t){for(var e=this._result,n=e.length,i=0;i<n;++i)e[i]=this._curves[i].evaluate(t);return this._result},r(t,[{key:"requiresDefault",get:function(){return!1}}]),t}(),be=e("cc.animation.UniformProxyFactory")((le=function(){function t(t,e){this.passIndex=ce&&ce(),this.uniformName=he&&he(),d(this,"channelIndex",fe,this),this.passIndex=e||0,this.uniformName=t||""}return t.prototype.forTarget=function(t){if(t instanceof Pt){var e=this.passIndex,n=this.uniformName,i=this.channelIndex;if(e<0||e>=t.passes.length)h(3941,t.name,e);else{var r=t.passes[e],o=r.getHandle(n);if(o){if(Ot.getTypeFromHandle(o)<Ut.SAMPLER1D){var a=void 0===i?o:r.getHandle(n,i,Ut.FLOAT);return a?function(t,e){for(var n,i=p(t.shaderInfo.blocks);!(n=i()).done;)for(var r,o=n.value,a=p(o.members);!(r=a()).done;){var s=r.value;if(s.name===e)return s.count>1}return!1}(r,n)?{set:function(t){r.setUniformArray(a,t)}}:{set:function(t){r.setUniform(a,t)}}:void h(3943,t.name,e,n,i)}var s=Ot.getBindingFromHandle(o),l=r.properties[n],c=l&&l.value?""+l.value+Nt(l.type):It(l.type),f=xt.get(c);return f||(u("Illegal texture default value: "+c+"."),f=xt.get("default-texture")),{set:function(t){t||(t=f);var e=t.getGFXTexture();e&&e.width&&e.height&&(r.bindTexture(s,e),t instanceof Rt&&r.bindSampler(s,Ft.gfxDevice.getSampler(t.getSamplerInfo())))}}}h(3942,t.name,e,n)}}else h(3940,t)},t}(),ce=i(le.prototype,"passIndex",[a],(function(){return 0})),he=i(le.prototype,"uniformName",[a],(function(){return""})),fe=f(le.prototype,"channelIndex",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),ue=le))||ue,Ce=e("cc.animation.MorphWeightValueProxy")((de=function(){function t(){this.subMeshIndex=ve&&ve(),this.shapeIndex=_e&&_e()}return t.prototype.forTarget=function(t){var e=this;return{set:function(n){t.setWeight(n,e.subMeshIndex,e.shapeIndex)}}},t}(),ve=i(de.prototype,"subMeshIndex",[a],(function(){return 0})),_e=i(de.prototype,"shapeIndex",[a],(function(){return 0})),pe=de))||pe,Se=e("cc.animation.MorphWeightsValueProxy")((ge=function(){function t(){this.subMeshIndex=me&&me()}return t.prototype.forTarget=function(t){var e=this;return{set:function(n){t.setWeights(n,e.subMeshIndex)}}},t}(),me=i(ge.prototype,"subMeshIndex",[a],(function(){return 0})),ye=ge))||ye,we=e("cc.animation.MorphWeightsAllValueProxy")(Ee=function(){function t(){}return t.prototype.forTarget=function(t){return{set:function(e){for(var n,i,r=null!==(n=null===(i=t.mesh)||void 0===i?void 0:i.struct.primitives.length)&&void 0!==n?n:0,o=0;o<r;++o)t.setWeights(e,o)}}},t}())||Ee,Pe=Symbol("[[Owner]]");function Oe(t,e){_(t[Pe]===e)}!function(t){t[t.FLOAT=0]="FLOAT",t[t.BOOLEAN=1]="BOOLEAN",t[t.TRIGGER=2]="TRIGGER",t[t.INTEGER=3]="INTEGER",t[t.VEC3_experimental=4]="VEC3_experimental",t[t.QUAT_experimental=5]="QUAT_experimental"}(Te||(Te={}));var Ne,Ie,xe,Re,ke,Le,Me,De,Be=Symbol("CreateInstance"),Fe=function(){function t(t){this._refs=[],this.type=t}return t.prototype.bind=function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._refs.push({fn:t,thisArg:e,args:i}),this.getValue()},r(t,[{key:"value",get:function(){return this.getValue()},set:function(t){this.setValue(t);for(var e,n=p(this._refs);!(e=n()).done;){var i=e.value,r=i.fn,o=i.thisArg,a=i.args;r.call.apply(r,[o,t].concat(a))}}}]),t}(),Ue=e("cc.animation.PlainVariable")((Ie=function(){function t(t){if(this._type=xe&&xe(),this._value=Re&&Re(),void 0!==t)switch(this._type=t,t){default:break;case Te.FLOAT:case Te.INTEGER:this._value=0;break;case Te.BOOLEAN:this._value=!1}}return t.prototype[Be]=function(){return new Ve(this._type,this._value)},r(t,[{key:"type",get:function(){return this._type}},{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]),t}(),xe=i(Ie.prototype,"_type",[a],(function(){return Te.FLOAT})),Re=i(Ie.prototype,"_value",[a],(function(){return 0})),Ne=Ie))||Ne,Ve=function(t){function e(e,n){var i;return(i=t.call(this,e)||this)._value=void 0,i._value=n,i}n(e,t);var i=e.prototype;return i.getValue=function(){return this._value},i.setValue=function(t){this._value=t},e}(Fe);!function(t){t[t.AFTER_CONSUMED=0]="AFTER_CONSUMED",t[t.NEXT_FRAME_OR_AFTER_CONSUMED=1]="NEXT_FRAME_OR_AFTER_CONSUMED"}(De||(De={})),_(0==(0|De.AFTER_CONSUMED<<1));var Ge,We,ze,je,He,Qe,Ye,qe,Ze,Xe,Je,Ke,$e=e("cc.animation.TriggerVariable")((Le=function(){function t(){this._flags=Me&&Me()}return t.prototype[Be]=function(){return new tn(this.value,this.resetMode)},r(t,[{key:"type",get:function(){return Te.TRIGGER}},{key:"value",get:function(){return!!((1&this._flags)>>0)},set:function(t){t?this._flags|=1:this._flags&=-2}},{key:"resetMode",get:function(){return(6&this._flags)>>1},set:function(t){this._flags&=-7,this._flags|=t<<1}}]),t}(),Me=i(Le.prototype,"_flags",[a],(function(){return 0})),ke=Le))||ke,tn=function(t){function e(e,n){var i;return(i=t.call(this,Te.TRIGGER)||this).resetMode=De.AFTER_CONSUMED,i._value=void 0,i.resetMode=n,i._value=e,i}n(e,t);var i=e.prototype;return i.getValue=function(){return this._value},i.setValue=function(t){this._value=t},e}(Fe),en=e("cc.animation.Vec3Variable")((We=function(){function t(){this._value=ze&&ze()}return t.prototype[Be]=function(){return new nn(this.value)},r(t,[{key:"type",get:function(){return Te.VEC3_experimental}},{key:"value",get:function(){return this._value},set:function(t){y.copy(this._value,t)}}]),t}(),ze=i(We.prototype,"_value",[a],(function(){return new y})),Ge=We))||Ge,nn=function(t){function e(e){var n;return(n=t.call(this,Te.VEC3_experimental)||this)._value=new y,y.copy(n._value,e),n}n(e,t);var i=e.prototype;return i.getValue=function(){return this._value},i.setValue=function(t){y.copy(this._value,t)},e}(Fe),rn=e("cc.animation.QuatVariable")((He=function(){function t(){this._value=Qe&&Qe()}return t.prototype[Be]=function(){return new on(this._value)},r(t,[{key:"type",get:function(){return Te.QUAT_experimental}},{key:"value",get:function(){return this._value},set:function(t){g.copy(this._value,t)}}]),t}(),Qe=i(He.prototype,"_value",[a],(function(){return new g})),je=He))||je,on=function(t){function e(e){var n;return(n=t.call(this,Te.QUAT_experimental)||this)._value=new g,g.copy(n._value,e),n}n(e,t);var i=e.prototype;return i.getValue=function(){return this._value},i.setValue=function(t){g.copy(this._value,t)},e}(Fe),an=function(t){function e(e){var n;return(n=t.call(this,e+" transition is invalid")||this).name="TransitionRejectError",n}return n(e,t),e}(m(Error)),sn=function(t){function e(e){return t.call(this,"Graph variable "+e+" is not defined")||this}return n(e,t),e}(m(Error)),un=function(t){function e(e,n,i){return t.call(this,"Expect graph variable "+e+" to have type '"+n+"' instead of received '"+(null!=i?i:typeof i)+"'")||this}return n(e,t),e}(m(Error));function ln(t){var e=t[E];if("object"==typeof e&&e){var n,i=e;return null===(n=i.clone)||void 0===n?void 0:n.call(i,t)}}var cn,hn,fn,pn,dn,vn,_n,yn,gn,mn,En,Tn,An=Symbol("[[Outgoing transitions]]"),bn=Symbol("[[Incoming transitions]]"),Cn=e,Sn=a,wn=Cn("cc.animation.State")((qe=function(t){function e(){var e;return(e=t.call(this)||this).name=Ze&&Ze(),e[An]=[],e[bn]=[],e}return n(e,t),e.prototype.copyTo=function(t){t.name=this.name,t[E]=ln(this)},e}(o),Ze=i(qe.prototype,"name",[Sn],(function(){return""})),Ye=qe))||Ye,Pn=Cn(J+"InteractiveState")((Je=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._components=Ke&&Ke(),e}n(e,t);var i=e.prototype;return i.addComponent=function(t){var e=new t;return this._components.push(e),e},i.removeComponent=function(t){T(this._components,t)},i.instantiateComponents=function(){return this._components.map((function(t){return Vt(t)}))},i.copyTo=function(e){t.prototype.copyTo.call(this,e),e._components=this.instantiateComponents()},r(e,[{key:"components",get:function(){return this._components}}]),e}(wn),Ke=i(Je.prototype,"_components",[Sn],(function(){return[]})),Xe=Je))||Xe,On=e(J+"AnimationGraphEventBinding")((hn=function(){function t(){this.methodName=fn&&fn()}var e=t.prototype;return e.emit=function(t){this.methodName&&nt(t,this.methodName,[])},e.copyTo=function(t){return t.methodName=this.methodName,this},r(t,[{key:"isBound",get:function(){return!!this.methodName}}]),t}(),fn=i(hn.prototype,"methodName",[a],(function(){return""})),cn=hn))||cn,Nn=e("cc.animation.Motion")((dn=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).motion=vn&&vn(),e.speed=_n&&_n(),e.speedMultiplier=yn&&yn(),e.speedMultiplierEnabled=gn&&gn(),e.transitionInEventBinding=mn&&mn(),e.transitionOutEventBinding=En&&En(),e}n(e,t);var i=e.prototype;return i.__callOnAfterDeserializeRecursive=function(){var t;null===(t=this.motion)||void 0===t||t.__callOnAfterDeserializeRecursive()},i.copyTo=function(e){var n,i;return t.prototype.copyTo.call(this,e),e.motion=null!==(n=null===(i=this.motion)||void 0===i?void 0:i.clone())&&void 0!==n?n:null,e.speed=this.speed,e.speedMultiplier=this.speedMultiplier,e.speedMultiplierEnabled=this.speedMultiplierEnabled,this.transitionInEventBinding.copyTo(e.transitionInEventBinding),this.transitionOutEventBinding.copyTo(e.transitionOutEventBinding),this},e}(Pn),vn=i(dn.prototype,"motion",[a],(function(){return null})),_n=i(dn.prototype,"speed",[a],(function(){return 1})),yn=i(dn.prototype,"speedMultiplier",[a],(function(){return""})),gn=i(dn.prototype,"speedMultiplierEnabled",[a],(function(){return!1})),mn=i(dn.prototype,"transitionInEventBinding",[a],(function(){return new On})),En=i(dn.prototype,"transitionOutEventBinding",[a],(function(){return new On})),pn=dn))||pn,In=Symbol("[[OnAfterDeserialized]]"),xn=e(J+"AnimationGraphLike")(Tn=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e}(Dt))||Tn;function Rn(t,e,n){var i=Object.prototype.propertyIsEnumerable;if(!i.call(t,e))return t;if(n in t)return t;var r={};return"symbol"==typeof e?(Object.entries(t).forEach((function(t){var e=t[0],n=t[1];r[e]=n})),Object.getOwnPropertySymbols(t).forEach((function(o){i.call(t,o)&&(r[o===e?n:o]=t[o])}))):(Object.entries(t).forEach((function(t){var i=t[0],o=t[1];r[i===e?n:i]=o})),Object.getOwnPropertySymbols(t).forEach((function(e){i.call(t,e)&&(r[e]=t[e])}))),r}var kn,Ln,Mn,Dn,Bn,Fn,Un,Vn,Gn=function(){var t=!1;try{t=[]instanceof function(){function t(){}return t[Symbol.hasInstance]=function(t){return Array.isArray(t)},t}()}catch(e){t=!1}return t?function(t){function e(){throw new Error("This function can not be called as a constructor.")}return Object.defineProperty(e,Symbol.hasInstance,{value:function(e){return e instanceof t}}),e}:function(t){return t}}(),Wn=e(J+"PoseGraphNodeShell")((Ln=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._bindings=Mn&&Mn(),e}n(e,t);var i=e.prototype;return i.getBindings=function(){return this._bindings},i.addBinding=function(t,e,n){this._emplaceBinding(new Hn(t,e,n))},i.deleteBinding=function(t){var e=this._findBindingIndex(t);e>=0&&this._bindings.splice(e,1)},i.moveArrayElementBindingForward=function(t,e,n){for(var i=this._bindings,r=[],o=0;o<i.length;++o){var a=i[o],s=a.inputPath,u=s[0],l=s[1];u===t&&(void 0===l?-1:l)>=e&&(r.push(a),i.splice(o,1))}for(var c=0,h=r;c<h.length;c++){var f=h[c],p=f.inputPath,d=p[0],v=p[1],_=void 0===v?-1:v;this.addBinding([d,_+(n?-1:1)],f.producer,f.outputIndex)}},i.deleteBindingTo=function(t){for(var e=this._bindings,n=0;n<e.length;++n)e[n].producer===t&&e.splice(n,1)},i.findBinding=function(t){var e=this._findBindingIndex(t);return e>=0?this._bindings[e]:void 0},i._findBindingIndex=function(t){return this._bindings.findIndex((function(e){return zn(e.inputPath,t)}))},i._emplaceBinding=function(t){var e=this._bindings.findIndex((function(e){return zn(e.inputPath,t.inputPath)}));e>=0?this._bindings[e]=t:this._bindings.push(t)},e}(o),Mn=i(Ln.prototype,"_bindings",[a],(function(){return[]})),kn=Ln))||kn;function zn(t,e){var n=t[0],i=t[1],r=e[0],o=e[1];return n===r&&i===o}var jn,Hn=e(J+"PoseGraphNodeInputBinding")((Bn=function(){function t(t,e,n){this._inputPath=Fn&&Fn(),this._producer=Un&&Un(),this._outputIndex=Vn&&Vn(),this._inputPath=t,this._producer=e,void 0!==n&&(this._outputIndex=n)}return r(t,[{key:"inputPath",get:function(){return this._inputPath}},{key:"producer",get:function(){return this._producer}},{key:"outputIndex",get:function(){return this._outputIndex}}]),t}(),Fn=i(Bn.prototype,"_inputPath",[a],null),Un=i(Bn.prototype,"_producer",[a],null),Vn=i(Bn.prototype,"_outputIndex",[a],(function(){return 0})),Dn=Bn))||Dn,Qn=function(t){function e(e){return t.call(this,"Can not add the specified "+e.toString()+" since it has already been added into another graph.")||this}return n(e,t),e}(m(Error)),Yn=function(t){function e(e){return t.call(this,"Can not perform specified operation on "+e.toString()+" since it has not been added in to graph.")||this}return n(e,t),e}(m(Error));!function(t){t[t.FLOAT=0]="FLOAT",t[t.INTEGER=1]="INTEGER",t[t.BOOLEAN=2]="BOOLEAN",t[t.VEC3=3]="VEC3",t[t.QUAT=4]="QUAT",t[t.POSE=5]="POSE"}(jn||(jn={}));var qn=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e}(o),Zn=new WeakMap;function Xn(t){return function(e){if(A(e,qn)||(b("This kind of decorator should only be applied to pose graph node classes."),0)){var n=function(t){var e=Zn.get(t);if(e)return e;var n={};return Zn.set(t,n),n}(e);t(n)}}}var Jn=function(t){return Xn((function(e){e.category=t}))},Kn=function(t){return Xn((function(e){e.factory=t}))},$n=function(t){return void 0===t&&(t=!0),Xn((function(e){e.hide=t}))},ti=function(t){return Xn((function(e){var n;Object.assign(null!==(n=e.appearance)&&void 0!==n?n:e.appearance={},t)}))},ei=["arraySyncGroup"];function ni(t,e,n,i){var r=t.getShell(e);if(!r)throw new Yn(e);var o=n[0],a=n[1],s=void 0===a?-1:a,u=e[o];Array.isArray(u)&&(u.splice(s,0,i),r.moveArrayElementBindingForward(o,s+1,!1))}function ii(t,e,n){var i=t.getShell(e);if(!i)throw new Yn(e);var r=n[0],o=n[1],a=void 0===o?-1:o,s=e[r];Array.isArray(s)&&(a<0||a>=s.length||(i.deleteBinding(n),s.splice(a,1),i.moveArrayElementBindingForward(r,a+1,!0)))}function ri(t){switch(t){default:case jn.FLOAT:case jn.INTEGER:return 0;case jn.BOOLEAN:return!1;case jn.POSE:return null;case jn.VEC3:return new y;case jn.QUAT:return new g}}var oi,ai=new(function(){function t(){this._classInputMap=new WeakMap}var e=t.prototype;return e.setPropertyNodeInputRecord=function(t,e,n){var i=this._classInputMap.get(t);i||(i={properties:{}},this._classInputMap.set(t,i)),n.arraySyncGroup;var r=C(n,ei),o=n.arraySyncGroup;if(o){var a,s;i.arraySyncGroups||(i.arraySyncGroups={});var u=null!==(s=(a=i.arraySyncGroups)[o])&&void 0!==s?s:a[o]={members:[]};u.members.includes(e)||u.members.push(e),r.arraySyncGroup=u}i.properties[e]=Object.freeze(r)},e.getInputKeys=function(t){var e=this,n=[];return function i(r){if(r){i(S(r));var o=e._classInputMap.get(r);if(o)for(var a=function(){var e=u[s][0];if(n.findIndex((function(t){var n=t[0];return e===n}))>=0)return 1;var i=t[e];if(Array.isArray(i))for(var r=0;r<i.length;++r)n.push([e,r]);else n.push([e])},s=0,u=Object.entries(o.properties);s<u.length;s++)a()}}(t.constructor),n},e.isPoseInput=function(t,e){var n=e[0],i=this._getPropertyNodeInputRecord(t.constructor,n);return!!i&&i.type===jn.POSE},e.getInputMetadata=function(t,e){var n=e[0],i=e[1],r=void 0===i?-1:i,o=this._getPropertyNodeInputRecord(t.constructor,n);if(o){var a=t[n];if(Array.isArray(a)){if(r<0||r>=a.length)return;var s,u,l=null!==(s=null===(u=o.getArrayElementDisplayName)||void 0===u?void 0:u.call(t,r))&&void 0!==s?s:o.displayName;return{type:o.type,displayName:l,deletable:!(o.arraySyncGroup&&o.arraySyncGroupFollower),insertPoint:!0}}return{type:o.type,displayName:o.displayName}}},e.hasInput=function(t,e){var n=e[0],i=e[1],r=void 0===i?-1:i;if(!this._getPropertyNodeInputRecord(t.constructor,n))return!1;var o=t[n];return!Array.isArray(o)||!(r<0||r>=o.length)},e.getInputInsertInfos=function(t){for(var e={},n=t.constructor;n;n=S(n)){var i=this._classInputMap.get(n);if(i)for(var r in i.properties){var o=i.properties[r],a=t[r];if(Array.isArray(a)){if(o.arraySyncGroup&&o.arraySyncGroupFollower)continue;e[r]={displayName:r}}}}return e},e.deleteInput=function(t,e,n){var i=n[0],r=n[1],o=void 0===r?-1:r,a=this._getPropertyNodeInputRecord(e.constructor,i);if(a){var s=e[i];if(Array.isArray(s)&&!(o<0||o>=s.length)){var u=a.arraySyncGroup;u?this._deleteInputInArraySyncGroup(t,e,u,s.length,o):ii(t,e,n)}}},e.insertInput=function(t,e,n){var i=n,r=this._getPropertyNodeInputRecord(e.constructor,i);if(r){var o=e[i];if(Array.isArray(o)){var a=o.length,s=r.arraySyncGroup;s?this._insertInputInArraySyncGroup(t,e,s,o.length,a):ni(t,e,[i,a],ri(r.type))}}},e._getPropertyNodeInputRecord=function(t,e){if(t){var n=this._classInputMap.get(t);if(n){var i=n.properties[e];if(i)return i}return this._getPropertyNodeInputRecord(S(t),e)}},e._insertInputInArraySyncGroup=function(t,e,n,i,r){for(var o=0;o<n.members.length;++o){var a=n.members[o],s=this._getPropertyNodeInputRecord(e.constructor,a),u=e[a];Array.isArray(u)&&u.length===i&&ni(t,e,[a,r],ri(s.type))}},e._deleteInputInArraySyncGroup=function(t,e,n,i,r){for(var o=0;o<n.members.length;++o){var a=n.members[o];this._getPropertyNodeInputRecord(e.constructor,a);var s=e[a];Array.isArray(s)&&s.length===i&&ii(t,e,[a,r])}},t}()),si=new y,ui=new y,li=new g;new g;var ci,hi,fi,pi=function(){function t(){this._position=new y,this._rotation=new g,this._scale=y.clone(y.ONE)}return t.clone=function(e){var n=new t;return t.copy(n,e),n},t.setIdentity=function(t){return y.copy(t._position,y.ZERO),g.copy(t._rotation,g.IDENTITY),y.copy(t._scale,y.ONE),t},t.copy=function(t,e){return y.copy(t._position,e._position),g.copy(t._rotation,e._rotation),y.copy(t._scale,e._scale),t},t.equals=function(t,e,n){return y.equals(t._position,e._position,n)&&g.equals(t._rotation,e._rotation,n)&&y.equals(t._scale,e._scale,n)},t.strictEquals=function(t,e){return y.strictEquals(t._position,e._position)&&g.strictEquals(t._rotation,e._rotation)&&y.strictEquals(t._scale,e._scale)},t.lerp=function(e,n,i,r){return 0===r?t.copy(e,n):1===r?t.copy(e,i):(y.lerp(e._position,n._position,i._position,r),g.slerp(e._rotation,n._rotation,i._rotation,r),y.lerp(e._scale,n._scale,i._scale,r),e)},t.multiply=function(t,e,n){var i=g.multiply(li,e._rotation,n._rotation),r=y.multiply(si,n._scale,e._scale),o=y.multiply(ui,n._position,e._scale);return y.transformQuat(o,o,e._rotation),y.add(o,o,e._position),y.copy(t._position,o),g.copy(t._rotation,i),y.copy(t._scale,r),t},t.invert=function(t,e){var n=t._rotation,i=t._scale,r=t._position;return g.invert(n,e._rotation),di(i,e._scale,P),y.negate(r,e._position),y.multiply(r,r,i),y.transformQuat(r,r,n),t},t.fromMatrix=function(t,e){return w.toSRT(e,t._rotation,t._position,t._scale),t},t.toMatrix=function(t,e){return w.fromSRT(t,e._rotation,e._position,e._scale)},r(t,[{key:"position",get:function(){return this._position},set:function(t){y.copy(this._position,t)}},{key:"rotation",get:function(){return this._rotation},set:function(t){g.copy(this._rotation,t)}},{key:"scale",get:function(){return this._scale},set:function(t){y.copy(this._scale,t)}}]),t}();function di(t,e,n){var i=e.x,r=e.y,o=e.z;return y.set(t,Math.abs(i)<=n?0:1/i,Math.abs(r)<=n?0:1/r,Math.abs(o)<=n?0:1/o)}oi=pi,pi.IDENTITY=Object.freeze(new oi),pi.ZERO=Object.freeze((ci=new oi,y.copy(ci._position,y.ZERO),g.set(ci._rotation,0,0,0,0),y.copy(ci._scale,y.ZERO),ci)),pi.calculateRelative=(hi=new g,fi=new y,function(t,e,n){var i=g.invert(hi,n._rotation),r=di(fi,n._scale,P),o=y.subtract(ui,e._position,n._position);return y.transformQuat(o,o,i),y.multiply(o,o,r),y.copy(t._position,o),g.multiply(t._rotation,i,e._rotation),y.multiply(t._scale,e._scale,r),t});var vi,_i,yi,gi=(vi=new g,function(t,e,n,i){y.scaleAndAdd(t.position,e.position,n.position,i);var r=g.slerp(vi,g.IDENTITY,n.rotation,i);return g.multiply(t.rotation,r,e.rotation),y.scaleAndAdd(t.scale,e.scale,n.scale,i),t}),mi=(_i=new g,function(t,e,n){var i=g.invert(_i,e);return g.multiply(t,n,i)}),Ei=Object.freeze(function(){var t=new pi;return t.position=y.ZERO,t.rotation=g.IDENTITY,t.scale=y.ZERO,t}()),Ti=function(){function t(t,e){this.transforms=void 0,this.auxiliaryCurves=void 0,this._poseTransformSpace=yi.LOCAL,this.transforms=t,this.auxiliaryCurves=e}return t._create=function(e,n){return new t(e,n)},t}();!function(t){t[t.LOCAL=0]="LOCAL",t[t.COMPONENT=1]="COMPONENT"}(yi||(yi={}));var Ai=function(){function t(t){this._involvedTransforms=new Uint16Array(t)}return r(t,[{key:"involvedTransforms",get:function(){return this._involvedTransforms}}]),t}();function bi(t,e,n,i){void 0===i&&(i=void 0),function(t,e,n,i){void 0===i&&(i=void 0);var r=t.length;if(_(r===t.length),0!==n)if(1!==n)if(i)for(var o=0;o<i.involvedTransforms.length;++o){var a=i.involvedTransforms[o];wi(t,e,n,a)}else for(var s=0;s<r;++s)wi(t,e,n,s);else i?function(t,e,n){var i=t.length;_(i===t.length);for(var r=0;r<n.involvedTransforms.length;++r){var o=n.involvedTransforms[r];t.copyRange(o,e,o,1)}}(t,e,i):t.set(e)}(t.transforms,e.transforms,n,i),function(t,e,n){var i=e.length;_(i===t.length);for(var r=0;r<i;++r)t[r]=O(t[r],e[r],n)}(t.auxiliaryCurves,e.auxiliaryCurves,n)}var Ci,Si,wi=(Ci=new pi,Si=new pi,function(t,e,n,i){var r=t.getTransform(i,Si),o=e.getTransform(i,Ci);pi.lerp(r,r,o,n),t.setTransform(i,r)});var Pi=function(){var t=new pi,e=new pi;return function(n,i,r){var o=i.getTransform(r,t),a=n.getTransform(r,e);!function(t,e,n){y.subtract(t.position,e.position,n.position),mi(t.rotation,n.rotation,e.rotation),y.subtract(t.scale,e.scale,n.scale)}(a,a,o),n.setTransform(r,a)}}();function Oi(t,e,n,i){void 0===i&&(i=void 0),function(t,e,n,i){void 0===i&&(i=void 0);var r=t.length;if(_(r===e.length),i)for(var o=0;o<i.involvedTransforms.length;++o){var a=i.involvedTransforms[o];xi(t,e,n,a)}else for(var s=0;s<r;++s)xi(t,e,n,s)}(t.transforms,e.transforms,n,i),function(t,e,n){var i=t.length;_(i===e.length);for(var r=0;r<t.length;++r)t[r]+=e[r]*n}(t.auxiliaryCurves,e.auxiliaryCurves,n)}var Ni,Ii,xi=function(){var t=new pi,e=new pi;return function(n,i,r,o){var a=i.getTransform(o,t),s=n.getTransform(o,e);gi(s,s,a,r),n.setTransform(o,s)}}();!function(t){t[t.NO=0]="NO",t[t.LOCAL=1]="LOCAL",t[t.COMPONENT=2]="COMPONENT"}(Ii||(Ii={})),N(Ii);var Ri,ki,Li,Mi,Di,Bi,Fi=e(J+"PoseNode")(Ni=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._dependencyEvaluation=void 0,e}n(e,t);var i=e.prototype;return i.update=function(t){var e;null===(e=this._dependencyEvaluation)||void 0===e||e.evaluate(),this.doUpdate(t)},i.evaluate=function(t,e){var n=this.doEvaluate(t),i=n._poseTransformSpace;switch(e){default:case Ii.NO:break;case Ii.LOCAL:i===yi.COMPONENT&&t._poseTransformsSpaceComponentToLocal(n),_(n._poseTransformSpace===yi.LOCAL);break;case Ii.COMPONENT:i===yi.LOCAL&&t._poseTransformsSpaceLocalToComponent(n),_(n._poseTransformSpace===yi.COMPONENT)}return n},e.evaluateDefaultPose=function(t,e){switch(e){default:case Ii.NO:case Ii.LOCAL:return t.pushDefaultedPose();case Ii.COMPONENT:return t.pushDefaultedPoseInComponentSpace()}},i._setDependencyEvaluation=function(t){this._dependencyEvaluation=t},i._forceEvaluateEvaluation=function(){var t;null===(t=this._dependencyEvaluation)||void 0===t||t.evaluate()},e}(qn))||Ni,Ui=function(t){function e(e){var n;return(n=t.call(this)||this)._outputTypes=[],n._outputTypes=e,n}n(e,t);var i=e.prototype;return i.getOutputType=function(t){return this._outputTypes[t]},i.link=function(){},r(e,[{key:"outputCount",get:function(){return this._outputTypes.length}}]),e}(qn),Vi=function(t){function e(e){return t.call(this,[e])||this}return n(e,t),e.prototype.selfEvaluate=function(t){t[0]=this.selfEvaluateDefaultOutput()},e}(Ui);function Gi(t){return function(e,n){var i=e.constructor;t.type!==jn.POSE||A(i,Fi)?A(i,Fi)||A(i,Ui)?Wi(t)(e,n):b("@input can be only applied to fields of subclasses of PoseNode or PureValueNode."):b("@input specifying pose input can be only applied to fields of subclasses of PoseNode.")}}function Wi(t){return function(e,n){if("string"==typeof n){var i=e.constructor;ai.setPropertyNodeInputRecord(i,n,t),I(e,n).__internalFlags|=x.STANDALONE|x.IMPLICIT_VISIBLE}else b("@input can be only applied to string-named fields.")}}var zi,ji,Hi,Qi,Yi,qi,Zi,Xi,Ji,Ki,$i,tr,er,nr,ir,rr,or,ar,sr,ur,lr,cr,hr,fr,pr,dr,vr,_r,yr,gr,mr,Er,Tr,Ar,br,Cr,Sr,wr,Pr,Or,Nr,Ir,xr,Rr,kr,Lr,Mr,Dr,Br,Fr,Ur,Vr,Gr,Wr,zr,jr,Hr,Qr,Yr,qr,Zr=(Ri=e(J+"PoseGraphOutputNode"),ki=ti({themeColor:"#CD3A58",inline:!0}),Li=Wi({type:jn.POSE}),Ri(Mi=ki((Di=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,d(e,"pose",Bi,R(e)),e}return n(e,t),e}(qn),Bi=f(Di.prototype,"pose",[a,Li],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mi=Di))||Mi)||Mi),Xr=e(J+"PoseGraph")((ji=function(t){function e(){var e;return(e=t.call(this)||this)._outputNode=Hi&&Hi(),e._nodes=Qi&&Qi(),e._shells=Yi&&Yi(),e._shellMap=qi&&qi(),e.addNode(e._outputNode),e}n(e,t);var i=e.prototype;return i.__callOnAfterDeserializeRecursive=function(){_(this._nodes.length===this._shells.length);for(var t=0;t<this._nodes.length;++t){var e,n=this._nodes[t],i=this._shells[t];this._shellMap.set(n,i),null===(e=n.__callOnAfterDeserializeRecursive)||void 0===e||e.call(n)}},i.nodes=function(){return this._nodes.values()},i.addNode=function(t){if(this._shellMap.has(t))throw new Qn(t);var e=new Wn;return this._shells.push(e),this._nodes.push(t),this._shellMap.set(t,e),t},i.removeNode=function(t){if(t!==this._outputNode){var e=this._nodes.indexOf(t);if(!(e<0)){_(this._shellMap.has(t));for(var n,i=p(this._shells);!(n=i()).done;)n.value.deleteBindingTo(t);k(this._shells,e),k(this._nodes,e),this._shellMap.delete(t)}}else b("Can not remove the output node.")},i.getShell=function(t){return this._shellMap.get(t)},r(e,[{key:"outputNode",get:function(){return this._outputNode}}]),e}(o),Hi=i(ji.prototype,"_outputNode",[a],(function(){return new Zr})),Qi=i(ji.prototype,"_nodes",[a],(function(){return[]})),Yi=i(ji.prototype,"_shells",[a],(function(){return[]})),qi=i(ji.prototype,"_shellMap",[a],(function(){return new Map})),zi=ji))||zi,Jr=e(J+"Transition")((Xi=function(t){function e(e,n,i){var r;return(r=t.call(this)||this).from=Ji&&Ji(),r.to=Ki&&Ki(),r.conditions=$i&&$i(),r[Pe]=void 0,r.from=e,r.to=n,i&&(r.conditions=i),r}return n(e,t),e.prototype.copyTo=function(t){t.conditions=this.conditions.map((function(t){return t.clone()}))},e}(o),Ji=i(Xi.prototype,"from",[a],null),Ki=i(Xi.prototype,"to",[a],null),$i=i(Xi.prototype,"conditions",[a],(function(){return[]})),Zi=Xi))||Zi,Kr=e(J+"DurationalTransition")((er=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).destinationStart=nr&&nr(),e.relativeDestinationStart=ir&&ir(),e.startEventBinding=rr&&rr(),e.endEventBinding=or&&or(),e[Pe]=void 0,e}return n(e,t),e.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),e.destinationStart=this.destinationStart,e.relativeDestinationStart=this.relativeDestinationStart,this.startEventBinding.copyTo(e.startEventBinding),this.endEventBinding.copyTo(e.endEventBinding)},e}(Jr),nr=i(er.prototype,"destinationStart",[a],(function(){return 0})),ir=i(er.prototype,"relativeDestinationStart",[a],(function(){return!1})),rr=i(er.prototype,"startEventBinding",[a],(function(){return new On})),or=i(er.prototype,"endEventBinding",[a],(function(){return new On})),tr=er))||tr,$r=e(J+"AnimationTransition")((sr=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).duration=ur&&ur(),e.relativeDuration=lr&&lr(),e.exitConditionEnabled=cr&&cr(),e._exitCondition=hr&&hr(),e}return n(e,t),e.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),e.duration=this.duration,e.relativeDuration=this.relativeDuration,e.exitConditionEnabled=this.exitConditionEnabled,e.exitCondition=this.exitCondition},r(e,[{key:"exitCondition",get:function(){return this._exitCondition},set:function(t){this._exitCondition=t}}]),e}(Kr),ur=i(sr.prototype,"duration",[a],(function(){return.3})),lr=i(sr.prototype,"relativeDuration",[a],(function(){return!1})),cr=i(sr.prototype,"exitConditionEnabled",[a],(function(){return!0})),hr=i(sr.prototype,"_exitCondition",[a],(function(){return 1})),ar=sr))||ar;function to(t){return t instanceof $r}var eo,no=e(J+"EmptyState")(fr=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e}(wn))||fr,io=e(J+"EmptyStateTransition")((dr=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).duration=vr&&vr(),e}return n(e,t),e.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),e.duration=this.duration},e}(Kr),vr=i(dr.prototype,"duration",[a],(function(){return.3})),pr=dr))||pr,ro=e(J+"ProceduralPoseState")((yr=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).graph=gr&&gr(),e.transitionInEventBinding=mr&&mr(),e.transitionOutEventBinding=Er&&Er(),e}n(e,t);var i=e.prototype;return i.__callOnAfterDeserializeRecursive=function(){this.graph.__callOnAfterDeserializeRecursive()},i.copyTo=function(e){return t.prototype.copyTo.call(this,e),this.transitionInEventBinding.copyTo(e.transitionInEventBinding),this.transitionOutEventBinding.copyTo(e.transitionOutEventBinding),this},e}(wn),gr=i(yr.prototype,"graph",[a],(function(){return new Xr})),mr=i(yr.prototype,"transitionInEventBinding",[a],(function(){return new On})),Er=i(yr.prototype,"transitionOutEventBinding",[a],(function(){return new On})),_r=yr))||_r,oo=Gn(ro),ao=e(J+"ProceduralPoseTransition")((Ar=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).duration=br&&br(),e}return n(e,t),e.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),e.duration=this.duration},e}(Kr),br=i(Ar.prototype,"duration",[a],(function(){return.3})),Tr=Ar))||Tr,so=Gn(ao),uo=e("cc.animation.StateMachine")((Sr=function(t){n(i,t);var e=i.prototype;function i(e){var n;return(n=t.call(this)||this)._states=wr&&wr(),n._transitions=Pr&&Pr(),n._entryState=Or&&Or(),n._exitState=Nr&&Nr(),n._anyState=Ir&&Ir(),n._allowEmptyStates=!0,n._allowEmptyStates=null!=e&&e,n._entryState=n._addState(new wn),n._entryState.name="Entry",n._exitState=n._addState(new wn),n._exitState.name="Exit",n._anyState=n._addState(new wn),n._anyState.name="Any",n}return e.__callOnAfterDeserializeRecursive=function(){this[In]();for(var t=this._states.length,e=0;e<t;++e){var n=this._states[e];n instanceof lo?n.stateMachine.__callOnAfterDeserializeRecursive():(n instanceof ro||n instanceof Nn)&&n.__callOnAfterDeserializeRecursive()}},e[In]=function(){this._states.forEach((function(){})),this._transitions.forEach((function(t){t.from[An].push(t),t.to[bn].push(t)}))},e.states=function(){return this._states},e.transitions=function(){return this._transitions},e.getTransitionsBetween=function(t,e){return Oe(t,this),Oe(e,this),t[An].filter((function(t){return t.to===e}))},e.getOutgoings=function(t){return Oe(t,this),t[An]},e.getIncomings=function(t){return Oe(t,this),t[bn]},e.addMotion=function(){return this._addState(new Nn)},e.addSubStateMachine=function(){return this._addState(new lo(this._allowEmptyStates))},e.addEmpty=function(){if(!this._allowEmptyStates)throw new Error("Empty states are now allowed in this state machine.");return this._addState(new no)},e.addProceduralPoseState=function(){return this._addState(new ro)},e.remove=function(t){Oe(t,this),t!==this.entryState&&t!==this.exitState&&t!==this.anyState&&(this.eraseTransitionsIncludes(t),T(this._states,t))},e.connect=function(t,e,n){if(Oe(t,this),Oe(e,this),e===this.entryState)throw new an("to-entry");if(e===this.anyState)throw new an("to-any");if(t===this.exitState)throw new an("from-exit");var i=t instanceof Nn||t===this._anyState?new $r(t,e,n):t instanceof no?new io(t,e,n):t instanceof ro?new ao(t,e,n):new Jr(t,e,n);return this._transitions.push(i),t[An].push(i),e[bn].push(i),i},e.disconnect=function(t,e){Oe(t,this),Oe(e,this);for(var n=t[An],i=e[bn],r=this._transitions,o=n.filter((function(t){return t.to===e})),a=o.length,s=function(){var t=o[u];T(n,t),_(T(r,t)),L(M(i,(function(e){return e===t})))},u=0;u<a;++u)s()},e.removeTransition=function(t){_(T(this._transitions,t)),L(M(t.from[An],(function(e){return e===t}))),L(M(t.to[bn],(function(e){return e===t})))},e.eraseOutgoings=function(t){var e=this;Oe(t,this);for(var n=t[An],i=function(){var t=n[r],i=t.to;_(T(e._transitions,t)),L(M(i[bn],(function(e){return e===t})))},r=0;r<n.length;++r)i();n.length=0},e.eraseIncomings=function(t){var e=this;Oe(t,this);for(var n=t[bn],i=function(){var t=n[r],i=t.from;_(T(e._transitions,t)),L(M(i[An],(function(e){return e===t})))},r=0;r<n.length;++r)i();n.length=0},e.eraseTransitionsIncludes=function(t){this.eraseIncomings(t),this.eraseOutgoings(t)},e.adjustTransitionPriority=function(t,e){var n=t.from;if(0!==e){var i=n[An],r=i.indexOf(t),o=D(r+e,0,i.length-1),a=this._transitions,s=a.indexOf(t);if(o>r)for(var u=r+1;u<=o;++u){var l=i[u],c=a.indexOf(l);a[s]=l,s=c}else if(r>o)for(var h=r-1;h>=o;--h){var f=i[h],p=a.indexOf(f);a[s]=f,s=p}a[s]=t,Gt(i,r,o)}},e.copyTo=function(t){for(var e,n=t._states.filter((function(e){switch(e){case t._entryState:case t._exitState:case t._anyState:return!0;default:return!1}})),i=p(n);!(e=i()).done;){var r=e.value;t.remove(r)}for(var o,a=new Map,s=p(this._states);!(o=s()).done;){var u=o.value;switch(u){case this._entryState:a.set(u,t._entryState);break;case this._exitState:a.set(u,t._exitState);break;case this._anyState:a.set(u,t._anyState);break;default:if(u instanceof Nn||u instanceof lo||u instanceof no||u instanceof ro){if(u instanceof no&&!t._allowEmptyStates)continue;var l=Vt(u);t._addState(l),a.set(u,l)}}}for(var c,h=p(this._transitions);!(c=h()).done;){var f=c.value;if(t._allowEmptyStates||!(f.from instanceof no||f.to instanceof no)){var d=a.get(f.from),v=a.get(f.to),_=t.connect(d,v);_.conditions=f.conditions.map((function(t){return t.clone()})),f.copyTo(_)}}},e.clone=function(){var t=new i(this._allowEmptyStates);return this.copyTo(t),t},e._addState=function(t){return this._states.push(t),t},r(i,[{key:"allowEmptyStates",get:function(){return this._allowEmptyStates}},{key:"entryState",get:function(){return this._entryState}},{key:"exitState",get:function(){return this._exitState}},{key:"anyState",get:function(){return this._anyState}}]),i}(o),wr=i(Sr.prototype,"_states",[a],(function(){return[]})),Pr=i(Sr.prototype,"_transitions",[a],(function(){return[]})),Or=i(Sr.prototype,"_entryState",[a],null),Nr=i(Sr.prototype,"_exitState",[a],null),Ir=i(Sr.prototype,"_anyState",[a],null),Cr=Sr))||Cr,lo=e("cc.animation.SubStateMachine")((Rr=function(t){function e(e){var n;return(n=t.call(this)||this)._stateMachine=kr&&kr(),n._stateMachine=new uo(e),n}return n(e,t),e.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),this._stateMachine.copyTo(e._stateMachine)},r(e,[{key:"stateMachine",get:function(){return this._stateMachine}}]),e}(Pn),kr=i(Rr.prototype,"_stateMachine",[a],null),xr=Rr))||xr,co=e(J+"PoseGraphStash")((Mr=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).graph=Dr&&Dr(),e}return n(e,t),e}(o),Dr=i(Mr.prototype,"graph",[a],(function(){return new Xr})),Lr=Mr))||Lr,ho=e("cc.animation.Layer")((Fr=function(){var t=e.prototype;function e(){this[Pe]=void 0,this._stateMachine=Ur&&Ur(),this.name=Vr&&Vr(),this.weight=Gr&&Gr(),this.mask=Wr&&Wr(),this.additive=zr&&zr(),this._stashes=jr&&jr(),this._stateMachine=new uo(!0)}return t.__callOnAfterDeserializeRecursive=function(){for(var t in this.stateMachine._allowEmptyStates=!0,this.stateMachine.__callOnAfterDeserializeRecursive(),this._stashes)this._stashes[t].graph.__callOnAfterDeserializeRecursive()},t.stashes=function(){return Object.entries(this._stashes)},t.getStash=function(t){return this._stashes[t]},t.addStash=function(t){return this._stashes[t]=new co},t.removeStash=function(t){delete this._stashes[t]},t.renameStash=function(t,e){this._stashes=Rn(this._stashes,t,e)},r(e,[{key:"stateMachine",get:function(){return this._stateMachine}}]),e}(),Ur=i(Fr.prototype,"_stateMachine",[a],null),Vr=i(Fr.prototype,"name",[a],(function(){return""})),Gr=i(Fr.prototype,"weight",[a],(function(){return 1})),Wr=i(Fr.prototype,"mask",[a],(function(){return null})),zr=i(Fr.prototype,"additive",[a],(function(){return!1})),jr=i(Fr.prototype,"_stashes",[a],(function(){return{}})),Br=Fr))||Br;!function(t){t[t.override=0]="override",t[t.additive=1]="additive"}(eo||(eo={}));var fo,po=e("cc.animation.AnimationGraph")((Qr=function(t){function e(){var e;return(e=t.call(this)||this)._layers=Yr&&Yr(),e._variables=qr&&qr(),e}n(e,t);var i=e.prototype;return i.onLoaded=function(){for(var t=this._layers,e=t.length,n=0;n<e;++n)t[n].__callOnAfterDeserializeRecursive()},i.addLayer=function(){var t=new ho;return this._layers.push(t),t},i.removeLayer=function(t){k(this._layers,t)},i.moveLayer=function(t,e){Gt(this._layers,t,e)},i.addVariable=function(t,e,n){var i=function(t,e){var n;switch(t){case Te.FLOAT:case Te.INTEGER:case Te.BOOLEAN:n=new Ue(t);break;case Te.TRIGGER:n=new $e;break;case Te.VEC3_experimental:n=new en;break;case Te.QUAT_experimental:n=new rn;break;default:throw new Error("Unknown variable type "+t)}return void 0!==e&&(n.value=e),n}(e,n);return this._variables[t]=i,i},i.removeVariable=function(t){delete this._variables[t]},i.getVariable=function(t){return this._variables[t]},i.renameVariable=function(t,e){this._variables=Rn(this._variables,t,e)},r(e,[{key:"layers",get:function(){return this._layers}},{key:"variables",get:function(){return Object.entries(this._variables)}}]),e}(xn),Yr=i(Qr.prototype,"_layers",[a],(function(){return[]})),qr=i(Qr.prototype,"_variables",[a],(function(){return{}})),Hr=Qr))||Hr,vo=Symbol("[[createEval]]"),_o=e(J+"MotionBase")(fo=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e.prototype.__callOnAfterDeserializeRecursive=function(){},e}(o))||fo;var yo=new y,go=new g,mo=function(){function t(t){this._transformHandle=t}return t.prototype.destroy=function(){this._transformHandle.destroy()},t}(),Eo=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var i=e.prototype;return i.setValue=function(t,e){e.transforms.setPosition(this._transformHandle.index,t)},i.getValue=function(t){return t.transforms.getPosition(this._transformHandle.index,yo)},e}(mo),To=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var i=e.prototype;return i.setValue=function(t,e){e.transforms.setRotation(this._transformHandle.index,t)},i.getValue=function(t){return t.transforms.getRotation(this._transformHandle.index,go)},e}(mo),Ao=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var i=e.prototype;return i.setValue=function(t,n){var i=g.fromEuler(e._EULER_TO_QUAT_CACHE,t.x,t.y,t.z);n.transforms.setRotation(this._transformHandle.index,i)},i.getValue=function(t){var e=t.transforms.getRotation(this._transformHandle.index,go);return g.toEuler(yo,e)},e}(mo);Ao._EULER_TO_QUAT_CACHE=new g;var bo=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var i=e.prototype;return i.setValue=function(t,e){e.transforms.setScale(this._transformHandle.index,t)},i.getValue=function(t){return t.transforms.getScale(this._transformHandle.index,yo)},e}(mo),Co=function(){function t(t){this._handle=t}var e=t.prototype;return e.destroy=function(){this._handle.destroy()},e.setValue=function(t,e){e.auxiliaryCurves[this._handle.index]=t},e.getValue=function(t){return t.auxiliaryCurves[this._handle.index]},t}(),So=function(){function t(t){this.binding=t}var e=t.prototype;return e.destroy=function(){},e.setValue=function(t){this.binding.setValue(t)},e.getValue=function(){var t,e,n;return null!==(t=null===(e=(n=this.binding).getValue)||void 0===e?void 0:e.call(n))&&void 0!==t?t:void 0},t}(),wo=function(){function t(t,e){this._binding=void 0,this._trackSampler=void 0,this._binding=t,this._trackSampler=e}var e=t.prototype;return e.destroy=function(){this._binding.destroy()},e.evaluate=function(t,e){var n=this._trackSampler,i=this._binding,r=n.requiresDefault?i.getValue(e):void 0,o=n.evaluate(t,r);i.setValue(o,e)},t}();function Po(t,e,n){var i=function(t,e){var n=e.origin,i=t.path,r=t.proxy,o=i.length,a=o-1;if(0!==o&&(i.isPropertyAt(a)||i.isElementAt(a))&&!r){var s=i.isPropertyAt(a)?i.parsePropertyAt(a):i.parseElementAt(a),u=i[st](n,0,o-1);if(null===u)return null;if(u instanceof kt&&ut(s)){var l=function(){for(var t=[],e=u;e&&e!==n;e=e.parent)t.unshift(e.name);return e===n?t.join("/"):void 0}();if("string"==typeof l){var c=e.bindTransform(l);if(!c)return;return function(t,e){switch(e){case"position":return new Eo(t);case"rotation":return new To(t);case"eulerAngles":return new Ao(t);case"scale":return new bo(t)}}(c,s)}}}var h=t.createRuntimeBinding(e.origin,void 0,!1);return h?new So(h):null}(e[at],n);return null!=i?i:void 0}var Oo,No,Io,xo,Ro,ko,Lo,Mo,Do,Bo,Fo,Uo,Vo,Go,Wo,zo,jo,Ho,Qo,Yo,qo,Zo,Xo,Jo,Ko,$o,ta,ea=function(){function t(t,e){this._binding=t,this._curve=e}return t.prototype.evaluate=function(t,e){var n=this._curve,i=this._binding,r=e,o=n.evaluate(t);i.setValue(o,r)},t}(),na=function(){function t(t,e){this._trackEvaluations=[],this._exoticAnimationEvaluation=void 0,this._auxiliaryCurveEvaluations=[],t._trySyncLegacyData();for(var n,i,r=[],o=[],a=t.tracks,s=t[it],u=p(a);!(i=u()).done;){var l=i.value;if(!(l instanceof rt||Array.from(l.channels()).every((function(t){return 0===t.curve.keyFramesCount})))){var c=Po(0,l,e);if(c){var h=l[$](),f=new wo(c,h);r.push(f)}}}s&&(n=s.createEvaluatorForAnimationGraph(e));for(var d=t.getAuxiliaryCurveNames_experimental(),v=d.length,_=0;_<v;++_){var y=d[_],g=t.getAuxiliaryCurve_experimental(y),m=e.bindAuxiliaryCurve(y),E=new Co(m);o.push(new ea(E,g))}this._trackEvaluations=r,this._exoticAnimationEvaluation=n,this._auxiliaryCurveEvaluations=o}var e=t.prototype;return e.destroy=function(){var t;null===(t=this._exoticAnimationEvaluation)||void 0===t||t.destroy();for(var e=this._trackEvaluations,n=e.length,i=0;i<n;++i)e[i].destroy()},e.evaluate=function(t,e){for(var n=this._trackEvaluations,i=this._exoticAnimationEvaluation,r=this._auxiliaryCurveEvaluations,o=e.pushDefaultedPose(),a=n.length,s=0;s<a;++s)n[s].evaluate(t,o);i&&i.evaluate(t,o);for(var u=r.length,l=0;l<u;++l)r[l].evaluate(t,o);return o},t}(),ia=function(){function t(t,e){this._clipEval=void 0,this._refClipEval=void 0,this._clipEval=new na(t,e);var n=t[ot].refClip;n&&n!==t&&(this._refClipEval=new na(n,e))}var e=t.prototype;return e.destroy=function(){var t;this._clipEval.destroy(),null===(t=this._refClipEval)||void 0===t||t.destroy()},e.evaluate=function(t,e){var n,i,r,o=this._clipEval.evaluate(t,e);return n=this._refClipEval?this._refClipEval.evaluate(0,e):this._clipEval.evaluate(0,e),r=n,function(t,e){var n=t.length;_(n===e.length);for(var i=0;i<n;++i)Pi(t,e,i)}((i=o).transforms,r.transforms),function(t,e){var n=t.length;_(n===e.length);for(var i=0;i<t.length;++i)t[i]-=e[i]}(i.auxiliaryCurves,r.auxiliaryCurves),e.popPose(),o},t}(),ra=F,oa=(Oo=e("cc.animation.ClipMotion"),No=ra(lt),Oo((xo=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).clip=Ro&&Ro(),e}n(e,t);var i=e.prototype;return i[vo]=function(t,e){return this.clip?new sa(t,this.clip,e):null},i.clone=function(){var t=new e;return t.clip=this.clip,t[E]=ln(this),t},e}(_o),Ro=i(xo.prototype,"clip",[No,a],(function(){return null})),Io=xo))||Io),aa=Symbol("EvaluatePort"),sa=function(){function t(t,e,n){var i,r;this._clipEmbeddedPlayerEval=null,this._frameEventEval=null,this._wrapInfo=new ct,this._duration=0,this._ignoreEmbeddedPlayers=void 0,this._originalClip=e,this._ignoreEmbeddedPlayers=n;var o=null!==(i=null===(r=t.clipOverrides)||void 0===r?void 0:r.get(e))&&void 0!==i?i:e;this._setClip(o,t)}var e=t.prototype;return e.createPort=function(){return new ua(this)},e.getClipStatuses=function(t){var e=this,n=!1;return{next:function(){return n?{done:!0,value:void 0}:(n=!0,{done:!1,value:{__DEBUG_ID__:e.__DEBUG__ID__,clip:e._clip,weight:t}})}}},e[aa]=function(t,e){var n,i,r=this._duration,o=this._clip.duration,a=this._clipEval,s=r*t,u=this._clip.wrapMode,l=function(t,e,n,i,r,o){if(0===e)return o.time=0,o.ratio=0,o.direction=1,o.stopped=!!Number.isFinite(i),o.iterations=0,o;var a=!1,s=t>0?t/e:-t/e;if(s>=i){s=i,a=!0;var u=i-(0|i);0===u&&(u=1),t=u*e*(t>0?1:-1)}if(t>e){var l=t%e;t=0===l?e:l}else t<0&&0!=(t%=e)&&(t+=e);var c=!1,h=n&B.ShouldWrap;h&&(c=function(t,e){var n=!1;return(t&B.PingPong)===B.PingPong&&(e-(0|e)==0&&e>0&&(e-=1),1&e&&(n=!n)),(t&B.Reverse)===B.Reverse&&(n=!n),n}(n,s));var f=c?-1:1;return r&&(f*=-1),h&&c&&(t=e-t),o.time=t,o.ratio=o.time/e,o.direction=f,o.stopped=a,o.iterations=s,o}(s,r,u,(u&B.Loop)===B.Loop?1/0:1,!1,this._wrapInfo),c=l.ratio*o,h=a.evaluate(c,e);return null===(n=this._frameEventEval)||void 0===n||n.sample(l.ratio,l.direction,l.iterations),null===(i=this._clipEmbeddedPlayerEval)||void 0===i||i.evaluate(c,Math.trunc(l.iterations)),h},e.overrideClips=function(t){var e,n=this._originalClip,i=null===(e=t.clipOverrides)||void 0===e?void 0:e.get(n);i&&this._setClip(i,t)},e.reenter=function(){var t;null===(t=this._frameEventEval)||void 0===t||t.reset()},e._setClip=function(t,e){var n;null===(n=this._clipEval)||void 0===n||n.destroy(),this._frameEventEval=null,this._clipEmbeddedPlayerEval&&(this._clipEmbeddedPlayerEval.destroy(),this._clipEmbeddedPlayerEval=null),this._clip=t,this._duration=0===t.speed?0:t.duration/t.speed,this._clipEval=function(t,e){return t.isAdditive_experimental?new ia(t,e):new na(t,e)}(t,e),this._frameEventEval=t.createEventEvaluator(e.origin),!this._ignoreEmbeddedPlayers&&t.containsAnyEmbeddedPlayer()&&(this._clipEmbeddedPlayerEval=t.createEmbeddedPlayerEvaluator(e.origin))},r(t,[{key:"duration",get:function(){return this._duration}}]),t}(),ua=function(){function t(t){this._eval=void 0,this._eval=t}var e=t.prototype;return e.evaluate=function(t,e){return this._eval[aa](t,e)},e.reenter=function(){this._eval.reenter()},t}(),la=e,ca=a,ha=la(J+"AnimationBlendItem")((Lo=function(){function t(){this.motion=Mo&&Mo()}var e=t.prototype;return e.clone=function(){var e=new t;return this._copyTo(e),e},e._copyTo=function(t){var e,n;return t.motion=null!==(e=null===(n=this.motion)||void 0===n?void 0:n.clone())&&void 0!==e?e:null,t},t}(),Mo=i(Lo.prototype,"motion",[ca],(function(){return null})),ko=Lo))||ko,fa=la(J+"AnimationBlend")((Bo=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name=Fo&&Fo(),e}return n(e,t),e.prototype.copyTo=function(t){t.name=this.name,t[E]=ln(this)},e}(_o),Fo=i(Bo.prototype,"name",[ca],(function(){return""})),Do=Bo))||Do,pa=function(){function t(t,e,n,i,r){this._childEvaluators=i.map((function(n){var i,r;return null!==(i=null===(r=n.motion)||void 0===r?void 0:r[vo](t,e))&&void 0!==i?i:null})),this._weights=new Array(this._childEvaluators.length).fill(0),this._inputs=[].concat(r)}var e=t.prototype;return e.createPort=function(){return new da(this,this._childEvaluators.map((function(t){var e;return null!==(e=null==t?void 0:t.createPort())&&void 0!==e?e:null})))},e.getChildWeight=function(t){return this._weights[t]},e.getChildMotionEval=function(t){return this._childEvaluators[t]},e.getClipStatuses=function(t){var e,n=this._childEvaluators,i=this._weights,r=n.length,o=0;return{next:function(){for(;;){if(e){var a=e.next();if(!a.done)return a}if(o>=r)return{done:!0,value:void 0};var s=n[o];e=null==s?void 0:s.getClipStatuses(t*i[o]),++o}}}},e.__evaluatePort=function(t,e,n){for(var i=this._childEvaluators.length,r=0,o=null,a=0;a<i;++a){var s,u=this._weights[a];if(u){var l=null===(s=t.childPorts[a])||void 0===s?void 0:s.evaluate(e,n);l&&(r+=u,o?(r&&bi(o,l,u/r),n.popPose()):o=l)}}return o||n.pushDefaultedPose()},e.overrideClips=function(t){for(var e=0;e<this._childEvaluators.length;++e){var n;null===(n=this._childEvaluators[e])||void 0===n||n.overrideClips(t)}},e.setInput=function(t,e){this._inputs[e]=t,this.doEval()},e.doEval=function(){this.eval(this._weights,this._inputs)},r(t,[{key:"childCount",get:function(){return this._weights.length}},{key:"duration",get:function(){for(var t=0,e=0;e<this._childEvaluators.length;++e){var n,i;t+=(null!==(n=null===(i=this._childEvaluators[e])||void 0===i?void 0:i.duration)&&void 0!==n?n:0)*this._weights[e]}return t}}]),t}(),da=function(){function t(t,e){this.childPorts=[],this._host=void 0,this._host=t,this.childPorts=e}var e=t.prototype;return e.evaluate=function(t,e){return this._host.__evaluatePort(this,t,e)},e.reenter=function(){for(var t=this.childPorts,e=t.length,n=0;n<e;++n){var i;null===(i=t[n])||void 0===i||i.reenter()}},t}(),va=e,_a=a,ya=va(J+"BindableNumber")((Vo=function(){function t(t){void 0===t&&(t=0),this.variable=Go&&Go(),this.value=Wo&&Wo(),this.value=t}return t.prototype.clone=function(){var e=new t;return e.value=this.value,e.variable=this.variable,e},t}(),Go=i(Vo.prototype,"variable",[_a],(function(){return""})),Wo=i(Vo.prototype,"value",[_a],(function(){return 0})),Uo=Vo))||Uo,ga=va(J+"BindableBoolean")((jo=function(){function t(t){void 0===t&&(t=!1),this.variable=Ho&&Ho(),this.value=Qo&&Qo(),this.value=t}return t.prototype.clone=function(){var e=new t;return e.value=this.value,e.variable=this.variable,e},t}(),Ho=i(jo.prototype,"variable",[_a],(function(){return""})),Qo=i(jo.prototype,"value",[_a],(function(){return!1})),zo=jo))||zo;function ma(t,e,n,i,r){var o=e.variable,a=e.value;if(!o)return a;var s=t.getVar(o);if(!Ea(s,o))return a;if(s.type!==n)throw new un(o,"number");for(var u=arguments.length,l=new Array(u>5?u-5:0),c=5;c<u;c++)l[c-5]=arguments[c];var h=s.bind.apply(s,[i,r].concat(l));return h}function Ea(t,e){if(t)return!0;throw new sn(e)}var Ta,Aa,ba=e,Ca=a,Sa=ba(J+"AnimationBlend1DItem")((qo=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).threshold=Zo&&Zo(),e}n(e,t);var i=e.prototype;return i.clone=function(){var t=new e;return this._copyTo(t),t},i._copyTo=function(e){return t.prototype._copyTo.call(this,e),e.threshold=this.threshold,e},e}(ha),Zo=i(qo.prototype,"threshold",[Ca],(function(){return 0})),Yo=qo))||Yo,wa=ba("cc.animation.AnimationBlend1D")(((ta=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._items=Ko&&Ko(),e.param=$o&&$o(),e}n(e,t);var i=e.prototype;return i.clone=function(){var t=new e;return this.copyTo(t),t._items=this._items.map((function(t){return t.clone()})),t.param=this.param.clone(),t},i[vo]=function(t,e){var n=new Pa(t,e,this,this._items,this._items.map((function(t){return t.threshold})),0),i=ma(t,this.param,Te.FLOAT,n.setInput,n,0);return n.setInput(i,0),n},r(e,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t).sort((function(t,e){return t.threshold-e.threshold}))}}]),e}(fa)).Item=Sa,Ko=i((Jo=ta).prototype,"_items",[Ca],(function(){return[]})),$o=i(Jo.prototype,"param",[Ca],(function(){return new ya})),Xo=Jo))||Xo,Pa=function(t){function e(e,n,i,r,o,a){var s;return(s=t.call(this,e,n,i,r,[a])||this)._thresholds=o,s.doEval(),s}return n(e,t),e.prototype.eval=function(t,e){var n=e[0];!function(t,e,n){if(t.fill(0),0===e.length);else if(n<=e[0])t[0]=1;else if(n>=e[e.length-1])t[t.length-1]=1;else{for(var i=0,r=1;r<e.length;++r)if(e[r]>n){i=r;break}var o=e[i-1],a=e[i],s=a-o;t[i-1]=(a-n)/s,t[i]=(n-o)/s}}(t,this._thresholds,n)},e}(pa),Oa=(Ta=new U,Aa={wA:0,wB:0},function(t,e,n){if(_(t.length===e.length),0!==e.length)if(1!==e.length)if(U.strictEquals(n,U.ZERO)){var i=e.findIndex((function(t){return U.strictEquals(t,U.ZERO)}));i>=0?t[i]=1:t.fill(1/e.length)}else{for(var r=-1,o=-1,a=-1,s=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY,l=n.x,c=n.y,h=0;h<e.length;++h){var f=e[h];if(U.equals(f,U.ZERO))a=h;else{var p=U.normalize(Ta,f),d=U.dot(p,n);p.x*c-p.y*l>0?d>=u&&(u=d,r=h):d>=s&&(s=d,o=h)}}var v=0;if(r<0||o<0)v=1;else{var y=(S=e[r],w=e[o],P=n,O=Aa,(N=U.cross(S,w))?(O.wA=U.cross(P,w)/N,O.wB=U.cross(P,S)/-N):(O.wA=0,O.wB=0),O),g=y.wA,m=y.wB,E=0,T=0,A=g+m;A>1?(E=g/A,T=m/A):A<0?(E=0,T=0,v=1):(E=g,T=m,v=1-A),t[r]=E,t[o]=T}if(v>0)if(a>=0)t[a]=v;else for(var b=v/t.length,C=0;C<t.length;++C)t[C]+=b}else t[0]=1;var S,w,P,O,N});var Na,Ia,xa,Ra,ka,La,Ma,Da,Ba,Fa,Ua=function(t,e,n,i,r){U.subtract(i,n,t),U.subtract(r,e,t)},Va=function(){function t(e){for(var n=t._ANGLE_MULTIPLIER,i=e.length,r=this._exampleMagnitudes=new Array(i).fill(0),o=this._exampleDirections=e.map((function(t,e){var n=U.copy(new U,t),i=U.len(n);return r[e]=i,V(i,0,1e-5)||U.multiplyScalar(n,n,1/i),n})),a=this._precomputedVIJs=new Float32Array(3*i*i),s=0;s<i;++s)for(var u=r[s],l=o[s],c=0;c<i;++c)if(s!==c){var h=r[c],f=o[c],p=(u+h)/2,d=3*(i*s+c);a[d+0]=(h-u)/p,a[d+1]=Ga(l,f)*n,a[d+2]=p}this._cacheVIXAngles=new Float32Array(i)}return t.prototype.interpolate=function(e,n){var i=this._exampleDirections,r=this._exampleMagnitudes,o=this._precomputedVIJs,a=this._cacheVIXAngles,s=t._CACHE_INPUT_DIRECTION,u=t._CACHE_VIJ,l=t._CACHE_VIX,c=t._ANGLE_MULTIPLIER,h=i.length;if(_(e.length===h),0!==h)if(1!==h){var f=n,p=U.len(f),d=a;if(U.equals(f,U.ZERO))for(var v=0;v<h;++v)d[v]=0;else for(var y=U.multiplyScalar(s,f,1/p),g=0;g<h;++g){var m=i[g];U.equals(m,U.ZERO)?d[g]=0:d[g]=Ga(m,y)*c}for(var E=0,T=0;T<h;++T){for(var A=r[T],b=i[T],C=Number.POSITIVE_INFINITY,S=0;S<h;++S)if(T!==S){var w=i[S],P=3*(h*T+S),O=o[P+0],N=o[P+1],I=o[P+2],x=N,R=d[T];U.equals(b,U.ZERO)?x=d[S]:U.equals(w,U.ZERO)?x=d[T]:U.equals(f,U.ZERO)&&(R=x);var k=U.set(u,O,x),L=U.set(l,(p-A)/I,R),M=1-U.dot(L,k)/U.lengthSqr(k);if(M<=0){C=0;break}C=Math.min(C,M)}e[T]=C,E+=C}if(E>0)for(var D=0;D<h;++D)e[D]/=E;else for(var B=1/h,F=0;F<h;++F)e[F]=B}else e[0]=1},t}();function Ga(t,e){var n=U.angle(t,e);return t.x*e.y-t.y*e.x<0?-n:n}Va._CACHE_INPUT_DIRECTION=new U,Va._CACHE_VIJ=new U,Va._CACHE_VIX=new U,Va._ANGLE_MULTIPLIER=1;var Wa,za=e,ja=a;!function(t){t[t.SIMPLE_DIRECTIONAL=0]="SIMPLE_DIRECTIONAL",t[t.FREEFORM_CARTESIAN=1]="FREEFORM_CARTESIAN",t[t.FREEFORM_DIRECTIONAL=2]="FREEFORM_DIRECTIONAL"}(Wa||(Wa={})),N(Wa);var Ha,Qa,Ya,qa,Za,Xa,Ja=za(J+"AnimationBlend2DItem")((Ia=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).threshold=xa&&xa(),e}n(e,t);var i=e.prototype;return i.clone=function(){var t=new e;return this._copyTo(t),t},i._copyTo=function(e){return t.prototype._copyTo.call(this,e),U.copy(e.threshold,this.threshold),e},e}(ha),xa=i(Ia.prototype,"threshold",[ja],(function(){return new U})),Na=Ia))||Na,Ka=za("cc.animation.AnimationBlend2D")(((Fa=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._items=La&&La(),e.paramX=Ma&&Ma(),e.paramY=Da&&Da(),e._algorithm=Ba&&Ba(),e._polarSpaceGBI=void 0,e}n(e,t);var i=e.prototype;return i.__callOnAfterDeserializeRecursive=function(){this._tryReconstructPolarSpaceInterpolator()},i.clone=function(){var t=new e;return this.copyTo(t),t._items=this._items.map((function(t){var e;return null!==(e=null==t?void 0:t.clone())&&void 0!==e?e:null})),t.paramX=this.paramX.clone(),t.paramY=this.paramY.clone(),t.algorithm=this._algorithm,t},i[vo]=function(t,e){var n,i=this.algorithm;switch(i){case Wa.FREEFORM_DIRECTIONAL:_(this._polarSpaceGBI),n=new ts(t,e,this,this._items,this._polarSpaceGBI,[0,0]);break;default:case Wa.SIMPLE_DIRECTIONAL:case Wa.FREEFORM_CARTESIAN:n=new $a(t,e,this,this._items,this._items.map((function(t){return t.threshold})),i,[0,0])}var r=ma(t,this.paramX,Te.FLOAT,n.setInput,n,0),o=ma(t,this.paramY,Te.FLOAT,n.setInput,n,1);return n.setInput(r,0),n.setInput(o,1),n},i._tryReconstructPolarSpaceInterpolator=function(){this._algorithm===Wa.FREEFORM_DIRECTIONAL?this._polarSpaceGBI=new Va(this._items.map((function(t){return t.threshold}))):this._polarSpaceGBI=void 0},r(e,[{key:"algorithm",get:function(){return this._algorithm},set:function(t){t!==this._algorithm&&(this._algorithm=t,this._tryReconstructPolarSpaceInterpolator())}},{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t),this._tryReconstructPolarSpaceInterpolator()}}]),e}(fa)).Algorithm=Wa,Fa.Item=Ja,La=i((ka=Fa).prototype,"_items",[ja],(function(){return[]})),Ma=i(ka.prototype,"paramX",[ja],(function(){return new ya})),Da=i(ka.prototype,"paramY",[ja],(function(){return new ya})),Ba=i(ka.prototype,"_algorithm",[ja],(function(){return Wa.SIMPLE_DIRECTIONAL})),Ra=ka))||Ra,$a=function(t){function e(e,n,i,r,o,a,s){var u;return(u=t.call(this,e,n,i,r,s)||this)._thresholds=void 0,u._algorithm=void 0,u._value=new U,u._thresholds=o,u._algorithm=a,u.doEval(),u}return n(e,t),e.prototype.eval=function(t,e){var n=e[0],i=e[1];switch(U.set(this._value,n,i),t.fill(0),this._algorithm){case Wa.SIMPLE_DIRECTIONAL:Oa(t,this._thresholds,this._value);break;case Wa.FREEFORM_CARTESIAN:!function(t,e,n){!function(t,e,n,i){t.fill(0);for(var r=new U(0,0),o=new U(0,0),a=0,s=e.length,u=0;u<s;++u){for(var l=Number.MAX_VALUE,c=!1,h=0;h<s;++h)if(u!==h){i(e[u],e[h],n,r,o);var f=1-U.dot(r,o)/U.lengthSqr(o);if(f<0){c=!0;break}l=Math.min(l,f)}c||(t[u]=l,a+=l)}a>0&&t.forEach((function(e,n){return t[n]=e/a}))}(t,e,n,Ua)}(t,this._thresholds,this._value)}},e}(pa),ts=function(t){function e(e,n,i,r,o,a){var s;return(s=t.call(this,e,n,i,r,a)||this)._interpolator=void 0,s._value=new U,s._interpolator=o,s.doEval(),s}return n(e,t),e.prototype.eval=function(t,e){var n=e[0],i=e[1];U.set(this._value,n,i),t.fill(0),this._interpolator.interpolate(t,this._value)},e}(pa),es=e,ns=a,is=es(J+"AnimationBlendDirectItem")((Qa=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).weight=Ya&&Ya(),e}n(e,t);var i=e.prototype;return i.clone=function(){var t=new e;return this._copyTo(t),t},i._copyTo=function(e){return t.prototype._copyTo.call(this,e),e.weight=this.weight,e},e}(ha),Ya=i(Qa.prototype,"weight",[ns],(function(){return new ya(0)})),Ha=Qa))||Ha;es("cc.animation.AnimationBlendDirect")(((Xa=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._items=Za&&Za(),e}n(e,t);var i=e.prototype;return i.clone=function(){var t=new e;return this.copyTo(t),t._items=this._items.map((function(t){var e;return null!==(e=null==t?void 0:t.clone())&&void 0!==e?e:null})),t},i[vo]=function(t,e){for(var n=new Ms(t,e,this,this._items,new Array(this._items.length).fill(0)),i=0;i<this._items.length;++i){var r=ma(t,this._items[i].weight,Te.FLOAT,n.setInput,n,i);n.setInput(r,i)}return n},r(e,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t)}}]),e}(fa)).Item=is,Za=i((qa=Xa).prototype,"_items",[ns],(function(){return[]})),qa));var rs,os,as,ss,us,ls,cs,hs,fs,ps,ds,vs,_s,ys,gs,ms,Es,Ts,As,bs,Cs,Ss,ws,Ps,Os,Ns,Is,xs,Rs,ks,Ls,Ms=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).doEval(),e}return n(e,t),e.prototype.eval=function(t,e){for(var n=t.length,i=0;i<n;++i)t[i]=e[i]},e}(pa),Ds=e("cc.JointMask")((os=function(){this.path=as&&as(),this.enabled=ss&&ss()},as=i(os.prototype,"path",[a],(function(){return""})),ss=i(os.prototype,"enabled",[a],(function(){return!0})),rs=os))||rs,Bs=(us=e(J+"AnimationMask"),ls=F(Ds),us((hs=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._jointMasks=fs&&fs(),e}n(e,t);var i=e.prototype;return i.addJoint=function(t,e){this.removeJoint(t);var n=new Ds;n.path=t,n.enabled=e,this._jointMasks.push(n)},i.removeJoint=function(t){M(this._jointMasks,(function(e){return e.path===t}))},i.clear=function(){this._jointMasks.length=0},i.filterDisabledNodes=function(t){for(var e=this._jointMasks,n=e.length,i=new Set,r=0;r<n;++r){var o=e[r],a=o.path;if(!o.enabled){var s=t.getChildByPath(a);s&&i.add(s)}}return i},i.isExcluded=function(t){var e,n;return!(null===(e=null===(n=this._jointMasks.find((function(e){return e.path===t})))||void 0===n?void 0:n.enabled)||void 0===e||e)},r(e,[{key:"joints",get:function(){return this._jointMasks},set:function(t){this.clear();for(var e,n=p(t);!(e=n()).done;){var i=e.value;this.addJoint(i.path,i.enabled)}}}]),e}(Dt),fs=i(hs.prototype,"_jointMasks",[a],(function(){return[]})),f(hs.prototype,"joints",[ls],Object.getOwnPropertyDescriptor(hs.prototype,"joints"),hs.prototype),cs=hs))||cs),Fs=e(J+"ClipOverrideEntry")((vs=function(){this.original=_s&&_s(),this.substitution=ys&&ys()},_s=i(vs.prototype,"original",[a],(function(){return null})),ys=i(vs.prototype,"substitution",[a],(function(){return null})),ds=vs))||ds,Us=(gs=e(J+"AnimationGraphVariant"),ms=F(po),gs((Ts=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._graph=As&&As(),e._clipOverrides=bs&&bs(),e}return n(e,t),r(e,[{key:"original",get:function(){return this._graph},set:function(t){this._graph=t}},{key:"clipOverrides",get:function(){return this._clipOverrides}}]),e}(xn),f(Ts.prototype,"original",[ms],Object.getOwnPropertyDescriptor(Ts.prototype,"original"),Ts.prototype),As=i(Ts.prototype,"_graph",[a],(function(){return null})),bs=i(Ts.prototype,"_clipOverrides",[a],(function(){return new Vs})),Es=Ts))||Es),Vs=e(J+"ClipOverrideMap")((ps=Symbol.iterator,Ss=function(){function t(){this._entries=ws&&ws()}var e=t.prototype;return e[ps]=function(){return this._entries[Symbol.iterator]()},e.has=function(t){return!!this._entries.find((function(e){return e.original===t}))},e.get=function(t){var e=this._entries.find((function(e){return e.original===t}));return null==e?void 0:e.substitution},e.set=function(t,e){var n=this._entries.find((function(e){return e.original===t}));if(n)n.substitution=e;else{var i=new Fs;i.original=t,i.substitution=e,this._entries.push(i)}},e.delete=function(t){M(this._entries,(function(e){return e.original===t}))},e.clear=function(){this._entries.length=0},r(t,[{key:"size",get:function(){return this._entries.length}}]),t}(),ws=i(Ss.prototype,"_entries",[a],(function(){return[]})),Cs=Ss))||Cs,Gs="i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes/",Ws=Gs+"/i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes_blend/",zs={listEntries:function(t){return[].concat(t.animationGraph.layers[t.layerIndex].stashes()).map((function(t){var e=t[0];return{arg:e,menu:e}}))},create:function(t){var e=new js;return e.stashName=t,e}},js=e(J+"PoseNodeUseStashedPose")(Ps=Jn(Gs)(Ps=Kn(zs)(Ps=ti({inline:!0})((Os=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).stashName=Ns&&Ns(),e._runtimeStash=void 0,e}n(e,t);var i=e.prototype;return i.bind=function(t){var e=this.stashName;if(e){var n=t.stashView.bindStash(e);this._runtimeStash=n}},i.settle=function(){},i.reenter=function(){var t;null===(t=this._runtimeStash)||void 0===t||t.reenter()},i.doUpdate=function(t){var e;null===(e=this._runtimeStash)||void 0===e||e.requestUpdate(t)},i.doEvaluate=function(t){var e,n;return null!==(e=null===(n=this._runtimeStash)||void 0===n?void 0:n.evaluate(t))&&void 0!==e?e:t.pushDefaultedPose()},e}(Fi),Ns=i(Os.prototype,"stashName",[a],(function(){return""})),Ps=Os))||Ps)||Ps)||Ps)||Ps,Hs=e,Qs=a;!function(t){t[t.TRUTHY=0]="TRUTHY",t[t.FALSY=1]="FALSY"}(Ls||(Ls={})),Hs(J+"UnaryCondition")(((ks=function(){function t(){this.operator=xs&&xs(),this.operand=Rs&&Rs()}var e=t.prototype;return e.clone=function(){var e=new t;return e.operator=this.operator,e.operand=this.operand.clone(),e},e[vo]=function(t){var e=this.operator,n=this.operand,i=new qs(e,!1),r=ma(t,n,Te.BOOLEAN,i.setOperand,i);return i.reset(r),i},t}()).Operator=Ls,xs=i((Is=ks).prototype,"operator",[Qs],(function(){return Ls.TRUTHY})),Rs=i(Is.prototype,"operand",[Qs],(function(){return new ga})),Is));var Ys,qs=function(){function t(t,e){this._operator=t,this._operand=e,this._eval()}var e=t.prototype;return e.reset=function(t){this.setOperand(t)},e.setOperand=function(t){this._operand=t,this._eval()},e.eval=function(){return this._result},e._eval=function(){var t=this._operand;switch(this._operator){default:case Ls.TRUTHY:this._result=!!t;break;case Ls.FALSY:this._result=!t}},t}();!function(t){t[t.FLOAT=0]="FLOAT",t[t.INTEGER=3]="INTEGER"}(Ys||(Ys={}));var Zs,Xs=function(){},Js=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(){}};!function(t){t[t.MOTION=1]="MOTION",t[t.POSE=2]="POSE",t[t.EMPTY=4]="EMPTY",t[t.WEIGHTED=7]="WEIGHTED"}(Zs||(Zs={}));var Ks,$s,tu,eu,nu,iu,ru,ou=a,au=e(J+"TCVariableBinding")(Ks=Js(Ys.FLOAT,Ys.INTEGER)(($s=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).type=tu&&tu(),e.variableName=eu&&eu(),e}n(e,t);var i=e.prototype;return i.getValueType=function(){return this.type},i.bind=function(t){var e=t.getVar(this.variableName);if(e)return new su(e)},e}(Xs),tu=i($s.prototype,"type",[ou,G],(function(){return Ys.FLOAT})),eu=i($s.prototype,"variableName",[ou],(function(){return""})),Ks=$s))||Ks)||Ks,su=function(){function t(t){this._varInstance=t}return t.prototype.evaluate=function(){return this._varInstance.value},t}(),uu=a;e(J+"TCAuxiliaryCurveBinding")(nu=Js(Ys.FLOAT)((iu=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).curveName=ru&&ru(),e}n(e,t);var i=e.prototype;return i.getValueType=function(){return Ys.FLOAT},i.bind=function(t){var e=t.getEvaluationTimeAuxiliaryCurveView();return new fu(e,this.curveName)},e}(Xs),ru=i(iu.prototype,"curveName",[uu],(function(){return""})),nu=iu))||nu);var lu,cu,hu,fu=function(){function t(t,e){this._view=t,this._curveName=e}return t.prototype.evaluate=function(){return this._view.get(this._curveName)},t}();lu=e(J+"TCStateWeightBinding"),cu=Js(Ys.FLOAT),Zs.WEIGHTED,lu(hu=cu(hu=void(hu=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var i=e.prototype;return i.getValueType=function(){return Ys.FLOAT},i.bind=function(){return new _u},e}(Xs))||hu)||hu);var pu,du,vu,_u=function(){function t(){}return t.prototype.evaluate=function(t){return t.sourceStateWeight},t}();pu=e(J+"TCStateMotionTimeBinding"),du=Js(Ys.FLOAT),Zs.POSE,pu(vu=du(vu=void(vu=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var i=e.prototype;return i.getValueType=function(){return Ys.FLOAT},i.bind=function(){return new Cu},e}(Xs))||vu)||vu);var yu,gu,mu,Eu,Tu,Au,bu,Cu=function(){function t(){}return t.prototype.evaluate=function(t){return t.sourceStateMotionTimeNormalized},t}(),Su=e,wu=a;!function(t){t[t.EQUAL_TO=0]="EQUAL_TO",t[t.NOT_EQUAL_TO=1]="NOT_EQUAL_TO",t[t.LESS_THAN=2]="LESS_THAN",t[t.LESS_THAN_OR_EQUAL_TO=3]="LESS_THAN_OR_EQUAL_TO",t[t.GREATER_THAN=4]="GREATER_THAN",t[t.GREATER_THAN_OR_EQUAL_TO=5]="GREATER_THAN_OR_EQUAL_TO"}(bu||(bu={})),Su(J+"BinaryCondition")(((Au=function(){function t(){this.operator=gu&&gu(),this.lhs=mu&&mu(),this.lhsBinding=Eu&&Eu(),this.rhs=Tu&&Tu()}var e=t.prototype;return e.clone=function(){var e=new t;return e.operator=this.operator,e.lhs=this.lhs,e.lhsBinding=Vt(this.lhsBinding),e.rhs=this.rhs,e},e[vo]=function(t){var e,n=null===(e=this.lhsBinding)||void 0===e?void 0:e.bind(t);return new xu(this.operator,this.lhs,this.rhs,n)},t}()).Operator=bu,gu=i((yu=Au).prototype,"operator",[wu],(function(){return bu.EQUAL_TO})),mu=i(yu.prototype,"lhs",[wu],(function(){return 0})),Eu=i(yu.prototype,"lhsBinding",[wu],(function(){return new au})),Tu=i(yu.prototype,"rhs",[wu],(function(){return 0})),yu));var Pu,Ou,Nu,Iu,xu=function(){function t(t,e,n,i){this._operator=t,this._lhsBindingEvaluation=i,this._lhsValue=e,this._rhsValue=n}return t.prototype.eval=function(t){var e,n,i=null!==(e=null===(n=this._lhsBindingEvaluation)||void 0===n?void 0:n.evaluate(t))&&void 0!==e?e:this._lhsValue,r=this._rhsValue;switch(this._operator){default:case bu.EQUAL_TO:return i===r;case bu.NOT_EQUAL_TO:return i!==r;case bu.LESS_THAN:return i<r;case bu.LESS_THAN_OR_EQUAL_TO:return i<=r;case bu.GREATER_THAN:return i>r;case bu.GREATER_THAN_OR_EQUAL_TO:return i>=r}},t}(),Ru=a,ku=e(J+"TriggerCondition")((Ou=function(){function t(){this.trigger=Nu&&Nu()}var e=t.prototype;return e.clone=function(){var e=new t;return e.trigger=this.trigger,e},e[vo]=function(t){var e=new Lu(!1),n=t.getVar(this.trigger);return Ea(n,this.trigger)&&(function(t,e){if(t!==Te.TRIGGER)throw new un(e,"trigger")}(n.type,this.trigger),e.setTrigger(n.bind(e.setTrigger,e))),e},t}(),Nu=i(Ou.prototype,"trigger",[Ru],(function(){return""})),Pu=Ou))||Pu,Lu=function(){function t(t){this._triggered=!1,this._triggered=t}var e=t.prototype;return e.setTrigger=function(t){this._triggered=t},e.eval=function(){return this._triggered},t}(),Mu=e(J+"StateMachineComponent")(Iu=function(){function t(){}var e=t.prototype;return e.onMotionStateEnter=function(){},e.onMotionStateExit=function(){},e.onMotionStateUpdate=function(){},e.onStateMachineEnter=function(){},e.onStateMachineExit=function(){},t}())||Iu,Du=10,Bu=Float64Array.BYTES_PER_ELEMENT*Du,Fu=function(){function t(t,e,n){this._data=void 0,this._data=void 0===t?new Float64Array:"number"==typeof t?new Float64Array(Du*t):new Float64Array(t,e,"number"==typeof n?Du*n:void 0)}var e=t.prototype;return e.getTransform=function(t,e){var n=this._data,i=e.position,r=e.rotation,o=e.scale,a=Du*t;return y.fromArray(i,n,a),g.fromArray(r,n,a+3),y.fromArray(o,n,a+7),e},e.getPosition=function(t,e){var n=this._data,i=Du*t;return y.fromArray(e,n,i),e},e.getRotation=function(t,e){var n=this._data,i=Du*t;return g.fromArray(e,n,i+3),e},e.getScale=function(t,e){var n=this._data,i=Du*t;return y.fromArray(e,n,i+7),e},e.setTransform=function(t,e){var n=this._data,i=e.position,r=e.rotation,o=e.scale,a=Du*t;y.toArray(n,i,a),g.toArray(n,r,a+3),y.toArray(n,o,a+7)},e.setPosition=function(t,e){var n=this._data,i=Du*t;y.toArray(n,e,i)},e.setRotation=function(t,e){var n=this._data,i=Du*t;g.toArray(n,e,i+3)},e.setScale=function(t,e){var n=this._data,i=Du*t;y.toArray(n,e,i+7)},e.copyWithin=function(t,e,n){this._data.copyWithin(t*Du,e*Du,"number"==typeof n?n*Du:void 0)},e.fill=function(t,e,n){var i,r,o=this.length;if(null!==(i=e)&&void 0!==i||(e=0),null!==(r=n)&&void 0!==r||(n=o),!(e>=o)){this.setTransform(e,t);for(var a=e+1;a<n;++a)this.copyWithin(a,e,e+1)}},e.fillZero=function(t,e){this._data.fill(0,"number"==typeof t?t*Du:void 0,"number"==typeof e?e*Du:void 0)},e.set=function(t,e){this._data.set(t._data,"number"==typeof e?e*Du:void 0)},e.slice=function(e,n){var i=this._data.slice("number"==typeof e?e*Du:void 0,"number"==typeof n?n*Du:void 0);return new t(i.buffer,i.byteOffset,i.length/Du)},e.copyRange=function(t,e,n,i){for(var r=Du*i,o=this._data,a=Du*t,s=e._data,u=Du*n,l=0;l<r;++l)o[a+l]=s[u+l]},r(t,[{key:"buffer",get:function(){return this._data.buffer}},{key:"byteLength",get:function(){return this._data.byteLength}},{key:"byteOffset",get:function(){return this._data.byteOffset}},{key:"length",get:function(){return this._data.length/Du}}],[{key:"BYTES_PER_ELEMENT",get:function(){return Bu}}]),t}(),Uu=Symbol(""),Vu=Symbol(""),Gu=function(t){this.buffer=void 0,this.useCount=0,this.buffer=new ArrayBuffer(t)},Wu=function(){function t(t,e){this._locking=!1,this._pages=[],this._allocatorCount=0,this._manager=t,this._pageSize=e}var e=t.prototype;return e.debugLock=function(){_(!this._locking),this._locking=!0},e.debugUnlock=function(){_(this._locking),this._locking=!1},e.getPageMemory=function(t){return _(t>=0&&t<this._pages.length),this._pages[t].buffer},e.pushPage=function(t){var e=t[Uu];_(e<=this._pages.length),e===this._pages.length&&this._pushNewPage(),_(e<this._pages.length);var n=this._pages[e];return++n.useCount,++t[Uu],n},e.popPage=function(t){var e=t[Uu]-1,n=this._pages[e];_(n.useCount>0),--n.useCount,--t[Uu],0===n.useCount&&(_(e===this._pages.length-1),this._pages.pop())},e.createAllocator=function(t){var e=new ju(this,t);return++this._allocatorCount,e},e.destroyAllocator=function(t){for(var e=t[Uu],n=0;n<e;++n){var i=this._pages[n];_(i.useCount>0),--i.useCount}_(this._allocatorCount>0),--this._allocatorCount,0===this._allocatorCount&&this._manager[Vu](this)},e._pushNewPage=function(){var t=new Gu(this._pageSize);this._pages.push(t)},r(t,[{key:"pageSize",get:function(){return this._pageSize}},{key:"debugLocking",get:function(){return this._locking}},{key:"allocatorCount",get:function(){return this._allocatorCount}}]),t}(),zu=function(t,e){this.buffer=t,this.byteOffset=e},ju=function(){function t(t,e){this[Uu]=0,this._slicesPerPage=0,this._slices=[],this._resource=t,this._sliceSize=e;var n=Math.floor(this._resource.pageSize/e);this._slicesPerPage=n}var e=t.prototype;return e.destroy=function(){_(0===this._slices.length),_(!this._resource.debugLocking),this._resource.destroyAllocator(this)},e.debugLock=function(){this._resource.debugLock()},e.debugUnlock=function(){this._resource.debugUnlock()},e.push=function(){var t=this._sliceSize,e=this._slices,n=this._slicesPerPage,i=e.length,r=0,o=0;0===t?(0===this[Uu]&&this._resource.pushPage(this),_(1===this[Uu])):(i===n*this[Uu]&&(this._resource.pushPage(this),_(i<n*this[Uu])),o=(i-(r=i%n))/n,_(this[Uu]*n>=i));var a=this._resource.getPageMemory(o),s=new zu(a,t*r);return this._slices.push(s),s},e.pop=function(){var t=this._slices,e=this._slicesPerPage,n=t.length-1;0===this._sliceSize?(_(1===this[Uu]),0===n&&this._resource.popPage(this)):0==n%e&&this._resource.popPage(this),this._slices.pop()},r(t,[{key:"isEmpty",get:function(){return 0===this._slices.length}}]),t}(),Hu=function(){function t(t){this._stacks=new Map,this._thresholds=t,_(t.every((function(t,e,n){return 0===e||t>n[e-1]})))}var e=t.prototype;return e.createAllocator=function(t){var e=t,n=this._selectStackPageSize(e),i=this._stacks.get(n);return i||(i=new Wu(this,n),this._stacks.set(n,i)),i.createAllocator(e)},e[Vu]=function(t){for(var e,n=p(this._stacks);!(e=n()).done;){var i=e.value,r=i[0];if(i[1]===t){this._stacks.delete(r);break}}},e._selectStackPageSize=function(t){var e=W(this._thresholds,t),n=t;return e>=0?n=this._thresholds[e]:(e=~e)===this._thresholds.length||(_(e>=0&&e<this._thresholds.length),n=this._thresholds[e]),n},r(t,[{key:"isEmpty",get:function(){return 0===this._stacks.size}}]),t}(),Qu=function(){function t(t,e){this._poses=[],this._allocatedCount=0,this._memoryAllocator=void 0,this._transformCount=t,this._auxiliaryCurveCount=e;var n=Yu(t,e,1);this._memoryAllocator=Zu.createAllocator(n)}var e=t.prototype;return e.destroy=function(){_(0===this._allocatedCount);for(var t=0;t<this._poses.length;++t)this._memoryAllocator.pop();return this._poses.length=0,this._memoryAllocator.destroy()},e.push=function(){0===this._allocatedCount&&this._memoryAllocator.debugLock(),this._allocatedCount===this._poses.length&&(this._allocateNewPose(),_(this._allocatedCount<this._poses.length));var t=this._poses[this._allocatedCount];return++this._allocatedCount,t},e.pop=function(){_(this._allocatedCount>0),--this._allocatedCount,0===this._allocatedCount&&this._memoryAllocator.debugUnlock()},e._allocateNewPose=function(){var t=this._memoryAllocator.push(),e=Fu.BYTES_PER_ELEMENT*this._transformCount,n=t.byteOffset,i=new Fu(t.buffer,n,this._transformCount),r=new Float64Array(t.buffer,n+e,this._auxiliaryCurveCount),o=Ti._create(i,r);this._poses.push(o)},r(t,[{key:"allocatedCount",get:function(){return this._allocatedCount}},{key:"top",get:function(){return _(this._allocatedCount>0),this._poses[this._allocatedCount-1]}}]),t}();function Yu(t,e,n){return(Fu.BYTES_PER_ELEMENT*t+Float64Array.BYTES_PER_ELEMENT*e)*n}var qu,Zu=new Hu([Yu(128,10,4)]);!function(t){t[t.WORLD=0]="WORLD",t[t.COMPONENT=1]="COMPONENT",t[t.PARENT=2]="PARENT",t[t.LOCAL=3]="LOCAL"}(qu||(qu={})),N(qu);var Xu,Ju,Ku,$u,tl,el,nl,il,rl=Symbol("PoseHeapAllocator"),ol=function(){function t(t,e){this._transformCount=0,this._metaValueCount=0,this._pages=[],this._allocatedCount=0,this._foremostPossibleFreePage=0,this._transformCount=t,this._metaValueCount=e}var e=t.prototype;return e.allocatePose=function(){++this._allocatedCount;for(var t=this._pages,e=t.length,n=this._foremostPossibleFreePage;n<e;++n){var i=t[n],r=i.tryAllocate();if(r)return r[rl].pageIndex=n,0===i.freeCount&&++this._foremostPossibleFreePage,r}var o=this._allocatePoseInNewPage();return this._foremostPossibleFreePage=o[rl].pageIndex,o},e.destroyPose=function(t){var e=this._pages;e.length;var n=t[rl].pageIndex,i=e[n];i.deallocate(t),--this._allocatedCount,n<this._foremostPossibleFreePage&&(_(i.freeCount>0),this._foremostPossibleFreePage=n)},e._allocatePoseInNewPage=function(){var t=new ll(this._transformCount,this._metaValueCount,4),e=this._pages.length;this._pages.push(t);var n=t.tryAllocate();return n[rl].pageIndex=e,n},r(t,[{key:"allocatedCount",get:function(){return this._allocatedCount}}]),t}(),al=function(){function t(){this._id=-1}return r(t,[{key:"pageIndex",get:function(){return this._id>>ul},set:function(t){this._id&=sl,this._id|=t<<ul}},{key:"poseIndex",get:function(){return this._id&sl},set:function(t){this._id&=~sl,this._id|=t}}]),t}(),sl=7,ul=3,ll=function(){function t(t,e,n){this._buffer=void 0,this._idleFlags=15,this._poses=void 0,this._freeCount=0,this._transformCount=t,this._metaValueCount=e,this._capacity=n;var i=(Fu.BYTES_PER_ELEMENT*t+Float64Array.BYTES_PER_ELEMENT*e)*n;this._buffer=new ArrayBuffer(i),this._poses=new Array(n).fill(null),this._freeCount=n}var e=t.prototype;return e.tryAllocate=function(){var t,e,n=this._poses,i=this._idleFlags,r=this._capacity,o=0===(e=i)?1/0:Math.log2(e&-e);if(o>=r)return null;_(o>=0&&o<n.length);var a=null!==(t=n[o])&&void 0!==t?t:n[o]=this._createPose(o);return a[rl].poseIndex=o,this._idleFlags&=~(1<<o),_(this._freeCount>0),--this._freeCount,a},e.deallocate=function(t){var e=this._poses,n=t[rl].poseIndex;_(n>=0&&n<e.length),_(e[n]===t),this._idleFlags|=1<<n,_(this._freeCount<this._capacity),++this._freeCount},e._createPose=function(t){var e=Fu.BYTES_PER_ELEMENT*this._transformCount,n=(e+Float64Array.BYTES_PER_ELEMENT*this._metaValueCount)*t,i=new Fu(this._buffer,n,this._transformCount),r=new Float64Array(this._buffer,n+e,this._metaValueCount),o=Ti._create(i,r);return o[rl]=new al,o},r(t,[{key:"capacity",get:function(){return this._capacity}},{key:"freeCount",get:function(){return this._freeCount}}]),t}();function cl(t,e){if(t.name===e)return t;for(var n=t.children.length,i=0;i<n;++i){var r=cl(t.children[i],e);if(r)return r}return null}var hl,fl=function(){function t(t,e,n,i){var r=this;this._origin=void 0,this._layoutMaintainer=void 0,this._varRegistry=void 0,this._additiveFlagStack=[],this._triggerResetter=function(t){return r._resetTrigger(t)},this._isLayerWideContextPropertiesSet=!1,this._stashView=void 0,this._motionSyncManager=void 0,this._clipOverrides=void 0,this._controller=i,this._origin=t,this._layoutMaintainer=e,this._varRegistry=n,this._additiveFlagStack=[!1]}var e=t.prototype;return e.bindTransform=function(t){var e=this._origin.getChildByPath(t);return e?this._layoutMaintainer.getOrCreateTransformBinding(e):null},e.bindTransformByName=function(t){var e=cl(this._origin,t);return e?this._layoutMaintainer.getOrCreateTransformBinding(e):null},e.getBoneChildren=function(t){var e=cl(this._origin,t);return e?e.children.map((function(t){return t.name})):[]},e.getParentBoneNameByName=function(t){var e,n=cl(this._origin,t);return n?n===this._origin?"":null===(e=n.parent)||void 0===e?void 0:e.name:null},e.bindAuxiliaryCurve=function(t){return this._layoutMaintainer.getOrCreateAuxiliaryCurveBinding(t)},e.getEvaluationTimeAuxiliaryCurveView=function(){return this._layoutMaintainer.auxiliaryCurveRegistry},e.getVar=function(t){return this._varRegistry[t]},e._pushAdditiveFlag=function(t){this._additiveFlagStack.push(t)},e._popAdditiveFlag=function(){_(this._additiveFlagStack.length>1),this._additiveFlagStack.pop()},e._integrityCheck=function(){return 1===this._additiveFlagStack.length},e._setLayerWideContextProperties=function(t,e){_(!this._isLayerWideContextPropertiesSet),this._isLayerWideContextPropertiesSet=!0,this._stashView=t,this._motionSyncManager=e},e._unsetLayerWideContextProperties=function(){_(this._isLayerWideContextPropertiesSet),this._isLayerWideContextPropertiesSet=!1,this._stashView=void 0,this._motionSyncManager=void 0},e._setClipOverrides=function(t){this._clipOverrides=t},e._resetTrigger=function(t){var e=this._varRegistry[t];e&&(e.value=!1)},r(t,[{key:"origin",get:function(){return this._origin}},{key:"controller",get:function(){return this._controller}},{key:"triggerResetter",get:function(){return this._triggerResetter}},{key:"clipOverrides",get:function(){return this._clipOverrides}},{key:"additive",get:function(){var t=this._additiveFlagStack;return t[t.length-1]}},{key:"stashView",get:function(){return _(this._stashView),this._stashView}},{key:"motionSyncManager",get:function(){return _(this._motionSyncManager),this._motionSyncManager}}]),t}(),pl=new pi,dl=function(){function t(){this._namedCurves=new Map}var e=t.prototype;return e.names=function(){return this._namedCurves.keys()},e.has=function(t){return this._namedCurves.has(t)},e.get=function(t){var e;return null!==(e=this._namedCurves.get(t))&&void 0!==e?e:0},e.set=function(t,e){this._namedCurves.set(t,e)},t}();!function(t){t[t.TRANSFORM_COUNT=1]="TRANSFORM_COUNT",t[t.TRANSFORM_ORDER=2]="TRANSFORM_ORDER",t[t.AUXILIARY_CURVE_COUNT=4]="AUXILIARY_CURVE_COUNT"}(hl||(hl={}));var vl=(Xu=function(){},Ju=function(){},Ku=function(){},$u=function(){},tl=function(){},el=function(){},nl=function(){},il=function(){function t(t,e){this._origin=void 0,this._auxiliaryCurveRegistry=void 0,this._auxiliaryCurveRecords=[],this._transformRecords=[],this._parentTable=[],this._bindStarted=!1,this._transformCountBeforeBind=-1,this._auxiliaryCurveCountBeforeBind=-1,this._origin=t,this._auxiliaryCurveRegistry=e}var e=t.prototype;return e.getOrCreateTransformBinding=function(t){for(var e=this._origin,n=!1,i=t;i;i=i.parent)if(i===e){n=!0;break}if(!n)return null;var r=this._getOrCreateTransformBinding(t);if(t!==e)for(var o=t.parent;o!==e;o=o.parent)this._getOrCreateTransformBinding(o);return r},e._getOrCreateTransformBinding=function(t){var e=this._transformRecords,n=e.findIndex((function(e){return e.node===t}));if(n>=0){var i=e[n];return++i.refCount,i.handle}for(var r=0,o=function(t){var n=e.findIndex((function(e){return e.node===t}));if(n>=0)return r=n+1,1},a=t.parent;a&&!o(a);a=a.parent);for(var s=r;s<e.length;++s)++e[s].handle.index;var u=new _l(new Ul(this,r),t);return e.splice(r,0,u),u.handle},e.getOrCreateAuxiliaryCurveBinding=function(t){var e=this._auxiliaryCurveRecords,n=e.findIndex((function(e){return e.name===t}));if(n>=0){var i=e[n];return++i.refCount,i.handle}var r=e.length,o=new yl(new Vl(this,r),t);return e.push(o),o.handle},e.createEvaluationContext=function(){return _(!this._bindStarted),new Fl(this.transformCount,this.auxiliaryCurveCount,this._parentTable.slice(),this._origin)},e.resetPoseStashAllocator=function(t){_(!this._bindStarted),t._reset(this.transformCount,this.auxiliaryCurveCount)},e.createTransformFilter=function(t){for(var e,n=this._origin,i=[],r=p(this._transformRecords);!(e=r()).done;){var o=e.value,a=o.node,s=o.handle,u=l(n,a);if(void 0===u)b(a.getPathInHierarchy()+" is not a child of "+n.getPathInHierarchy());else if(t.isExcluded(u))continue;i.push(s.index)}return i.sort(),new Ai(i);function l(t,e){for(var n=[],i=e;i;i=i.parent){if(i===t)return n.join("/");n.unshift(i.name)}}},e.fetchDefaultTransforms=function(t){var e=this._transformRecords.length;_(t.length===e);for(var n=0;n<e;++n){var i=this._transformRecords[n].defaultTransform;t.setTransform(n,i)}},e.apply=function(t){var e=t.transforms,n=t.auxiliaryCurves,i=this._transformRecords.length;_(e.length===i);for(var r=0;r<i;++r){var o=e.getTransform(r,pl);this._transformRecords[r].node.setRTS(o.rotation,o.position,o.scale)}for(var a=this._auxiliaryCurveRecords.length,s=0;s<a;++s){var u=this._auxiliaryCurveRecords[s].name,l=n[s];this._auxiliaryCurveRegistry.set(u,l)}},e._destroyTransformHandle=function(t){_(t>=0&&t<this._transformRecords.length);var e=this._transformRecords[t];_(e.refCount>0),--e.refCount},e._destroyAuxiliaryCurveHandle=function(t){_(t>=0&&t<this._auxiliaryCurveRecords.length);var e=this._auxiliaryCurveRecords[t];_(e.refCount>0),--e.refCount},e.startBind=function(){this._bindStarted=!0,this._transformCountBeforeBind=this._transformRecords.length,this._auxiliaryCurveCountBeforeBind=this._auxiliaryCurveRecords.length},e.endBind=function(){var t=this._transformRecords,e=this._auxiliaryCurveRecords,n=0;if(gl(t),t.length!==this._transformCountBeforeBind){n|=hl.TRANSFORM_COUNT;for(var i=t.length,r=0;r<i;++r)t[r].order=r}else{for(var o=t.length,a=!1,s=0;s<o;++s){var u=t[s];u.order!==s&&(a=!0,u.order=s)}a&&(n|=hl.TRANSFORM_ORDER)}gl(e),e.length!==this._auxiliaryCurveCountBeforeBind&&(n|=hl.AUXILIARY_CURVE_COUNT);var l=this._parentTable,c=this._origin;l.length=t.length;for(var h=function(){var e=t[f].node;if(e===c)return l[f]=-1,1;var n=e.parent;if(n===c){var i=t.findIndex((function(t){return t.node===n}));l[f]=i>=0?i:-1}else{var r=t.findIndex((function(t){return t.node===n}));l[f]=r}},f=0;f<t.length;++f)h();return this._bindStarted=!1,n},r(t,[{key:"transformCount",get:function(){return this._transformRecords.length}},{key:"auxiliaryCurveCount",get:function(){return this._auxiliaryCurveRecords.length}},{key:"auxiliaryCurveRegistry",get:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){return this._auxiliaryCurveRegistry}))}]),t}(),f(il.prototype,"getOrCreateTransformBinding",[Xu],Object.getOwnPropertyDescriptor(il.prototype,"getOrCreateTransformBinding"),il.prototype),f(il.prototype,"_getOrCreateTransformBinding",[Ju],Object.getOwnPropertyDescriptor(il.prototype,"_getOrCreateTransformBinding"),il.prototype),f(il.prototype,"getOrCreateAuxiliaryCurveBinding",[Ku],Object.getOwnPropertyDescriptor(il.prototype,"getOrCreateAuxiliaryCurveBinding"),il.prototype),f(il.prototype,"_destroyTransformHandle",[$u],Object.getOwnPropertyDescriptor(il.prototype,"_destroyTransformHandle"),il.prototype),f(il.prototype,"_destroyAuxiliaryCurveHandle",[tl],Object.getOwnPropertyDescriptor(il.prototype,"_destroyAuxiliaryCurveHandle"),il.prototype),f(il.prototype,"startBind",[el],Object.getOwnPropertyDescriptor(il.prototype,"startBind"),il.prototype),f(il.prototype,"endBind",[nl],Object.getOwnPropertyDescriptor(il.prototype,"endBind"),il.prototype),il),_l=function(t,e){this.order=-1,this.refCount=1,this.handle=void 0,this.node=void 0,this.defaultTransform=void 0,this.handle=t,this.node=e;var n=new pi;n.position=e.position,n.rotation=e.rotation,n.scale=e.scale,this.defaultTransform=n},yl=function(t,e){this.refCount=1,this.handle=void 0,this.name=void 0,this.handle=t,this.name=e};function gl(t){var e=function(t,e){for(var n=t.length,i=0;i<n&&e(t[i]);++i);if(i===n)return n;for(var r=i,o=i+1;o<n;++o){var a=t[o];if(e(a)){var s=a;t[o]=t[r],t[r]=s,++r}}return r}(t,(function(t){return _(t.refCount>=0),t.refCount>0}));if(_(e<=t.length),e!==t.length){for(var n=0;n<e;++n)t[n].handle.index=n;t.splice(e,t.length-e)}}var ml,El,Tl,Al,bl,Cl,Sl,wl,Pl,Ol,Nl,Il,xl,Rl,kl,Ll=Symbol("[[DefaultTransforms]]"),Ml=function(){function t(t){this._layoutMaintainer=t}return t.prototype.createTransformFilter=function(t){return this._layoutMaintainer.createTransformFilter(t)},r(t,[{key:"transformCount",get:function(){return this._layoutMaintainer.transformCount}}]),t}(),Dl=new pi,Bl=new pi,Fl=function(){function t(t,e,n,i){this[Ll]=void 0,this._poseAllocator=void 0,this._parentTable=void 0,this._componentNode=void 0,this._cacheComponentToWorldTransform=new pi,this._poseAllocator=new Qu(t,e),this._parentTable=n,this._componentNode=i,this[Ll]=new Fu(t)}var e=t.prototype;return e.destroy=function(){this._poseAllocator.destroy()},e.pushDefaultedPose=function(){var t=this._poseAllocator.push();return t.transforms.set(this[Ll]),t._poseTransformSpace=yi.LOCAL,t.auxiliaryCurves.fill(0),t},e.pushDefaultedPoseInComponentSpace=function(){var t=this.pushDefaultedPose();return this._poseTransformsSpaceLocalToComponent(t),t},e.pushZeroDeltaPose=function(){var t=this._poseAllocator.push();return t.transforms.fill(Ei),t._poseTransformSpace=yi.LOCAL,t.auxiliaryCurves.fill(0),t},e.pushDuplicatedPose=function(t){var e=this._poseAllocator.push();return e.transforms.set(t.transforms),e._poseTransformSpace=t._poseTransformSpace,e.auxiliaryCurves.set(t.auxiliaryCurves),e},e.popPose=function(){this._poseAllocator.pop()},e._isStackTopPose_debugging=function(t){return t===this._poseAllocator.top},e._poseTransformsSpaceLocalToComponent=function(t){for(var e=t.transforms,n=e.length,i=0;i<n;++i){var r=this._parentTable[i];if(!(r<0)){var o=e.getTransform(i,Dl),a=e.getTransform(r,Bl);pi.multiply(o,a,o),e.setTransform(i,o)}}t._poseTransformSpace=yi.COMPONENT},e._poseTransformsSpaceComponentToLocal=function(t){for(var e=t.transforms,n=e.length-1;n>=0;--n){var i=this._parentTable[n];if(!(i<0)){var r=e.getTransform(n,Dl),o=e.getTransform(i,Bl);pi.calculateRelative(r,r,o),e.setTransform(n,r)}}t._poseTransformSpace=yi.LOCAL},e._convertPoseSpaceTransformToTargetSpace=function(t,e,n,i){var r=n._poseTransformSpace;switch(e){default:break;case qu.WORLD:r===yi.COMPONENT?pi.multiply(t,this._getComponentToWorldTransform(),t):(_(r===yi.LOCAL),pi.multiply(t,this._getLocalToWorldTransform(Bl,n,i),t));break;case qu.COMPONENT:r===yi.COMPONENT||(_(r===yi.LOCAL),pi.multiply(t,this._getLocalToComponentTransform(Bl,n,i),t));break;case qu.PARENT:if(r===yi.COMPONENT){var o=this._parentTable[i];if(o>=0){var a=n.transforms.getTransform(o,Bl),s=pi.invert(a,a);pi.multiply(t,s,t)}}else _(r===yi.LOCAL);break;case qu.LOCAL:_(r===yi.COMPONENT||r===yi.LOCAL);var u=n.transforms.getTransform(i,Bl),l=pi.invert(u,u);pi.multiply(t,l,t)}return t},e._convertTransformToPoseTransformSpace=function(t,e,n,i){var r=n._poseTransformSpace;switch(e){default:break;case qu.WORLD:if(r===yi.COMPONENT){var o=pi.invert(Bl,this._getComponentToWorldTransform());pi.multiply(t,o,t)}else{_(r===yi.LOCAL);var a=this._getLocalToWorldTransform(Bl,n,i),s=pi.invert(a,a);pi.multiply(t,s,t)}break;case qu.COMPONENT:if(r===yi.COMPONENT);else{_(r===yi.LOCAL);var u=this._getLocalToComponentTransform(Bl,n,i),l=pi.invert(u,u);pi.multiply(t,l,t)}break;case qu.PARENT:if(r===yi.COMPONENT){var c=this._parentTable[i];if(c>=0){var h=n.transforms.getTransform(c,Bl);pi.multiply(t,h,t)}}break;case qu.LOCAL:_(r===yi.COMPONENT||r===yi.LOCAL);var f=n.transforms.getTransform(i,Bl);pi.multiply(t,f,t)}return t},e._getComponentToWorldTransform=function(){var t=this._cacheComponentToWorldTransform,e=this._componentNode;return t.position=e.worldPosition,t.rotation=e.worldRotation,t.scale=e.worldScale,t},e._getLocalToComponentTransform=function(t,e,n){var i=this._parentTable;pi.setIdentity(t);for(var r=i[n];r>=0;r=i[r]){var o=e.transforms.getTransform(r,Dl);pi.multiply(t,o,t)}return t},e._getLocalToWorldTransform=function(t,e,n){return this._getLocalToComponentTransform(t,e,n),pi.multiply(t,this._getComponentToWorldTransform(),t),t},r(t,[{key:"allocatedPoseCount",get:function(){return this._poseAllocator.allocatedCount}},{key:"parentTable",get:function(){return this._parentTable}},{key:"_stackSize_debugging",get:function(){return this._poseAllocator.allocatedCount}}]),t}(),Ul=function(){function t(t,e){this.index=-1,this._host=void 0,this._host=t,this.index=e}return t.prototype.destroy=function(){this._host._destroyTransformHandle(this.index)},t}(),Vl=function(){function t(t,e){this.index=-1,this._host=void 0,this._host=t,this.index=e}return t.prototype.destroy=function(){this._host._destroyAuxiliaryCurveHandle(this.index)},t}(),Gl=function(){function t(){this._context={deltaTime:0,indicativeWeight:0}}var e=t.prototype;return e.generate=function(t,e){return this._context.deltaTime=t,this._context.indicativeWeight=e,this._context},e.forkSubWeight=function(t,e){this._context.deltaTime=t.deltaTime,this._context.indicativeWeight=t.indicativeWeight*e},t}(),Wl=function(){function t(){this._allocator=null}var e=t.prototype;return e._reset=function(t,e){this._allocator=new ol(t,e)},e.allocatePose=function(){return _(this._allocator),this._allocator.allocatePose()},e.destroyPose=function(t){return _(this._allocator),this._allocator.destroyPose(t)},r(t,[{key:"allocatedPoseCount",get:function(){return _(this._allocator),this._allocator.allocatedCount}}]),t}(),zl=e(J+"MotionSyncInfo")((El=function(){this.group=Tl&&Tl()},Tl=i(El.prototype,"group",[a],(function(){return""})),ml=El))||ml;function jl(t){return{listEntries:function(){return[{arg:{type:"clip-motion"},menu:"i18n:ENGINE.animation_graph.pose_graph_node_sub_menus.play_or_sample_clip_motion"},{arg:{type:"animation-blend-1d"},menu:"i18n:ENGINE.animation_graph.pose_graph_node_sub_menus.play_or_sample_animation_blend_1d"},{arg:{type:"animation-blend-2d"},menu:"i18n:ENGINE.animation_graph.pose_graph_node_sub_menus.play_or_sample_animation_blend_2d"}]},create:function(e){var n=null;switch(e.type){case"clip-motion":n=new oa;break;case"animation-blend-1d":n=new wa;break;case"animation-blend-2d":n=new Ka}return t(n)}}}var Hl=1e-5,Ql=(Al=e(J+"PoseNodePlayMotion"),bl=Jn(Gs),Cl=Kn(jl((function(t){var e=new Ql;return e.motion=t,e}))),Sl=ti({themeColor:"#227F9B"}),wl=Gi({type:jn.FLOAT}),Pl=Gi({type:jn.FLOAT}),Al(Ol=bl(Ol=Cl(Ol=Sl((Nl=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).motion=Il&&Il(),e.syncInfo=xl&&xl(),d(e,"startTime",Rl,R(e)),d(e,"speedMultiplier",kl,R(e)),e._workspace=null,e._runtimeSyncRecord=void 0,e}n(e,t);var i=e.prototype;return i.bind=function(t){var e=this.motion;if(e){var n=e[vo](t,!1);n&&(this._workspace=new Yl(n,n.createPort()),this.syncInfo.group&&(this._runtimeSyncRecord=t.motionSyncManager.register(this.syncInfo)))}},i.settle=function(){},i.reenter=function(){if(this._workspace){var t=this._runtimeSyncRecord,e=this._workspace.motionEval.duration;this._forceEvaluateEvaluation();var n=e<Hl?0:z(this.startTime/e);t?t.notifyRenter(n):this._workspace.normalizedTime=n,this._workspace.lastIndicativeWeight=0}},i.doUpdate=function(t){if(this._workspace){var e=t.deltaTime,n=this._runtimeSyncRecord,i=this._workspace.motionEval.duration,r=0;i>Hl&&(r=e*this.speedMultiplier/i),n?n.notifyUpdate(r,t.indicativeWeight):this._workspace.normalizedTime+=r,this._workspace.lastIndicativeWeight=t.indicativeWeight}},i.doEvaluate=function(t){if(this._workspace){var e=this._runtimeSyncRecord?this._runtimeSyncRecord.getSyncedEnterTime():this._workspace.normalizedTime;return this._workspace.motionEvalPort.evaluate(e,t)}return t.pushDefaultedPose()},r(e,[{key:"lastIndicativeWeight",get:function(){var t,e;return null!==(t=null===(e=this._workspace)||void 0===e?void 0:e.lastIndicativeWeight)&&void 0!==t?t:0}},{key:"elapsedMotionTime",get:function(){var t,e;return null!==(t=null===(e=this._workspace)||void 0===e?void 0:e.normalizedTime)&&void 0!==t?t:0}}]),e}(Fi),Il=i(Nl.prototype,"motion",[a],(function(){return new oa})),xl=i(Nl.prototype,"syncInfo",[a],(function(){return new zl})),Rl=f(Nl.prototype,"startTime",[a,wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kl=f(Nl.prototype,"speedMultiplier",[a,Pl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ol=Nl))||Ol)||Ol)||Ol)||Ol),Yl=function(t,e){this.normalizedTime=0,this.lastIndicativeWeight=0,this.motionEval=t,this.motionEvalPort=e};function ql(t){return t instanceof Fi||t instanceof Ui}var Zl=function(){function t(t,e){this._rootPoseNode=t,this._countingPlayMotionNodes=e}var e=t.prototype;return e.bind=function(t){var e;null===(e=this._rootPoseNode)||void 0===e||e.bind(t)},e.settle=function(t){var e;null===(e=this._rootPoseNode)||void 0===e||e.settle(t)},e.reenter=function(){var t;null===(t=this._rootPoseNode)||void 0===t||t.reenter()},e.update=function(t){var e;null===(e=this._rootPoseNode)||void 0===e||e.update(t)},e.evaluate=function(t){var e,n;return null!==(e=null===(n=this._rootPoseNode)||void 0===n?void 0:n.evaluate(t,Ii.LOCAL))&&void 0!==e?e:null},e.countMotionTime=function(){var t=this._countingPlayMotionNodes;if(!t)return 0;for(var e=0,n=Number.NEGATIVE_INFINITY,i=0;i<t.length;++i){var r=t[i],o=r.elapsedMotionTime,a=r.lastIndicativeWeight;a>n&&(n=a,e=o)}return e},t}();function Xl(t,e,n){void 0===n&&(n=!1);var i=t.outputNode,r=t.getShell(i).getBindings();if(_(r.length<2),0===r.length)return new Zl(void 0,n?[]:void 0);var o=r[0];_(0===o.outputIndex),_(o.producer instanceof Fi);var a=new Map,s=Jl(t,o.producer,a,e);return new Zl(s,n?Array.from(a.values()).filter((function(t){return t instanceof Ql})):void 0)}function Jl(t,e,n,i){var r=t.getShell(e),o=n.get(e);if(o)return o;var a=Vt(e);"__callOnAfterDeserializeRecursive"in a&&a.__callOnAfterDeserializeRecursive(),a instanceof Ui&&a.link(i);for(var s,l=a,c=[],h=p(r.getBindings());!(s=h()).done;){var f=s.value,d=f.producer,v=f.outputIndex,_=f.inputPath;if(ql(d)){var y=Jl(t,d,n,i);if(y instanceof Fi)tc(l,_,y,v);else{var g=rc(l,_,y,v);g&&c.push(g)}}else u("There's a input bound to a node with unrecognized type.")}var m,E=new Kl(c);return l instanceof Fi?(l._setDependencyEvaluation(E),m=l):m=new $l(l,E),n.set(e,m),m}var Kl=function(){function t(t){this._bindingEvaluations=void 0,this._bindingEvaluations=t}return t.prototype.evaluate=function(){for(var t,e=this._bindingEvaluations,n=p(e);!(t=n()).done;)t.value.evaluate()},t}(),$l=function(){function t(t,e){this._outputs=void 0,this._node=t,this._dependency=e,this._outputs=new Array(t.outputCount)}var e=t.prototype;return e.getDefaultOutput=function(){return this.getOutput(0)},e.getOutput=function(t){return this._outputs[t]},e.evaluate=function(){var t=this._node;this._dependency.evaluate(),t.selfEvaluate(this._outputs)},r(t,[{key:"node",get:function(){return this._node}},{key:"outputCount",get:function(){return this._outputs.length}}]),t}();function tc(t,e,n,i){var r=e[0],o=e[1],a=void 0===o?-1:o;if(r in t)if(0===i){var s=t[r];if(a<0)return null!==s?void u("Invalid binding: consumer node's input "+r+" should be leaved as evaluation before evaluation."):void(t[r]=n);Array.isArray(s)?a>=s.length?u("Invalid binding: consumer node's input "+r+" have length "+s.length+" but the binding specified "+a):null===s[a]?s[a]=n:u("Invalid binding: consumer node's input "+r+"["+a+"] should be leaved as null before evaluation"):u("Invalid binding: consumer node's input "+r+" should be an array.")}else u("Node "+n.toString()+" does not have specified output "+i+".");else u("Invalid binding: consumer node has no property "+r)}var ec,nc=function(){function t(t,e,n,i){this._consumerNode=t,this._consumerPropertyKey=e,this._producerRecord=n,this._producerOutputIndex=i}return t.prototype.evaluate=function(){this._producerRecord.evaluate(),this._consumerNode[this._consumerPropertyKey]=this._producerRecord.getOutput(this._producerOutputIndex)},t}(),ic=function(){function t(t,e,n,i,r){this._consumerNode=t,this._consumerPropertyKey=e,this._consumerElementIndex=n,this._producerRecord=i,this._producerOutputIndex=r}return t.prototype.evaluate=function(){this._producerRecord.evaluate(),this._consumerNode[this._consumerPropertyKey][this._consumerElementIndex]=this._producerRecord.getOutput(this._producerOutputIndex)},t}();function rc(t,e,n,i){var r=e[0],o=e[1],a=void 0===o?-1:o;if(r in t){var s=t[r];if(a<0)return new nc(t,r,n,i);if(Array.isArray(s)){if(!(a>=s.length))return new ic(t,r,a,n,i);u("Invalid binding: consumer node's input "+r+" have length "+s.length+" but the binding specified "+a)}else u("Invalid binding: consumer node's input "+r+" should be an array.")}else u("Invalid binding: consumer node has no property "+r)}var oc=function(){function t(t,e,n){this.passthroughWeight=1,this._motionStates=[],this._proceduralPoseStates=[],this._topLevelEntry=void 0,this._topLevelExit=void 0,this._currentNode=void 0,this._pendingTransitionPath=[],this._activatedTransitions=[],this._activatedTransitionPool=Mc.createPool(4),this._updateContextGenerator=new Gl,this._conditionEvaluationContext=new Lc,this._additive=!1,this._additive=n.additive,this.name=e,this._controller=n.controller;var i=this._addStateMachine(t,null,n,e),r=i.entry,o=i.exit;this._topLevelEntry=r,this._topLevelExit=o,this._currentNode=r,r.increaseActiveReference(),this._resetTrigger=n.triggerResetter}var e=t.prototype;return e.settle=function(t){for(var e=this._proceduralPoseStates,n=e.length,i=0;i<n;++i)e[i].settle(t)},e.reenter=function(){for(var t,e=p(this._activatedTransitions);!(t=e()).done;){var n=t.value;n.destination.decreaseActiveReference(),this._activatedTransitionPool.free(n)}this._activatedTransitions.length=0,this._topLevelEntry.increaseActiveReference(),this._currentNode.decreaseActiveReference(),this._currentNode=this._topLevelEntry},e.update=function(t){_(!this.exited),this._loopMatchTransitions(),this._resetStateTickFlagsAndWeights(),this._updateActivatedTransitions(t.deltaTime),this._commitStateUpdates(t)},e.evaluate=function(t){return this._sample(t)||this._pushNullishPose(t)},e.getCurrentStateStatus=function(){var t=this._currentNode;return t.kind===sc.animation||t.kind===sc.procedural?t.getStatus():null},e.getCurrentClipStatuses=function(){var t=this._currentNode;return t.kind===sc.animation?t.getClipStatuses(t.absoluteWeight):lc},e.getCurrentTransition=function(t){var e=this._activatedTransitions;if(0===e.length)return!1;var n=e[e.length-1],i=1===e.length?this._currentNode:e[e.length-2].destination,r=n.getAbsoluteDuration(i);return t.duration=r,t.time=n.normalizedElapsedTime*r,!0},e.getNextStateStatus=function(){var t=this._activatedTransitions;if(0===t.length)return null;var e=t[t.length-1].destination;switch(e.kind){default:break;case sc.procedural:case sc.animation:return e.getStatus()}return null},e.getNextClipStatuses=function(){var t,e=this._activatedTransitions;if(0===e.length)return lc;var n=e[e.length-1],i=n.destination;switch(i.kind){default:return lc;case sc.animation:return null!==(t=i.getClipStatuses(n.destination.absoluteWeight))&&void 0!==t?t:lc}},e.overrideClips=function(t){for(var e=this._motionStates,n=e.length,i=0;i<n;++i)e[i].overrideClips(t)},e._addStateMachine=function(t,e,n,i){for(var r,o,a,s=this,u=Array.from(t.states()),l=u.map((function(e){if(e instanceof Nn){var i=new dc(e,n);return s._motionStates.push(i),i}if(e===t.entryState)return r=new xc(e,sc.entry,e.name);if(e===t.exitState)return a=new xc(e,sc.exit,e.name);if(e===t.anyState)return o=new xc(e,sc.any,e.name);if(e instanceof no)return new Rc(e);if(e instanceof oo){var u=new kc(e,n);return s._proceduralPoseStates.push(u),u}return null})),c={components:null,parent:e,entry:r,exit:a,any:o},h=0;h<u.length;++h){var f=l[h];f&&(f.stateMachine=c)}for(var d=u.map((function(t){if(t instanceof lo){var e=s._addStateMachine(t.stateMachine,c,n,i+"/"+t.name);return e.components=new pc(t),e}return null})),v=0;v<u.length;++v){var _=u[v],y=t.getOutgoings(_),g=void 0;if(_ instanceof lo){var m=d[v];g=m.exit}else{var E=l[v];g=E}for(var T,A=function(){var t,e=T.value,i=e.to,r=u.findIndex((function(t){return t===e.to}));if(i instanceof lo)t=d[r].entry;else{var o=l[r];t=o instanceof dc?o.entry:o}var a={conditions:e.conditions.map((function(t){return t[vo](n)})),to:t,triggers:void 0,duration:0,normalizedDuration:!1,destinationStart:0,relativeDestinationStart:!1,exitCondition:0,exitConditionEnabled:!1,activated:!1,startEventBinding:void 0,endEventBinding:void 0};(to(e)||e instanceof io||e instanceof so)&&(a.duration=e.duration,a.destinationStart=e.destinationStart,a.relativeDestinationStart=e.relativeDestinationStart,e.startEventBinding.isBound&&(a.startEventBinding=e.startEventBinding),e.endEventBinding.isBound&&(a.endEventBinding=e.endEventBinding),to(e)&&(a.normalizedDuration=e.relativeDuration,a.exitConditionEnabled=e.exitConditionEnabled,a.exitCondition=e.exitCondition)),a.conditions.forEach((function(t,n){var i,r=e.conditions[n];r instanceof ku&&r.trigger&&(null!==(i=a.triggers)&&void 0!==i?i:a.triggers=[]).push(r.trigger)})),g.addTransition(a)},b=p(y);!(T=b()).done;)A()}return c},e._loopMatchTransitions=function(){var t=this._pendingTransitionPath,e=this._activatedTransitions;_(0===t.length);for(var n=0===e.length?this._currentNode:e[e.length-1].destination,i=0;;++i){if(i>=16){h(14e3,16,"");break}var r=this._matchNextTransition(n);if(!r)break;var o=r.to,a=n;if(n=o,ac(o)){if(o===a)break;this._activateTransition(t,r),t.length=0}else t.push(r)}t.length=0},e._resetStateTickFlagsAndWeights=function(){var t=this._currentNode,e=this._activatedTransitions;t.resetTickFlagsAndWeight();for(var n=0;n<e.length;++n)e[n].destination.resetTickFlagsAndWeight()},e._commitStateUpdates=function(t){var e=this._currentNode,n=this._activatedTransitions;this._updateContextGenerator,this._commitStateUpdate(e,t);for(var i=0;i<n.length;++i){var r=n[i].destination;this._commitStateUpdate(r,t)}},e._commitStateUpdate=function(t,e){var n=this._updateContextGenerator;if(!t.testTickFlag(cc.UPDATED))if(t.setTickFlag(cc.UPDATED),t.kind===sc.animation)t.update(e.deltaTime,this._controller);else if(t.kind===sc.procedural){var i=n.generate(e.deltaTime,e.indicativeWeight*t.absoluteWeight);t.update(i)}},e._sample=function(t){var e,n=this._currentNode,i=this._activatedTransitions,r=1,o=null,a=0;if(n.kind===sc.animation)o=null!==(e=n.evaluate(t))&&void 0!==e?e:this._pushNullishPose(t);else if(n.kind===sc.procedural){var s;o=null!==(s=n.evaluate(t))&&void 0!==s?s:this._pushNullishPose(t)}else r-=n.absoluteWeight,o=null;o&&(a=n.absoluteWeight),n.setTickFlag(cc.EVALUATED);for(var u=0;u<i.length;++u){var l=i[u].destination;if(!l.testTickFlag(cc.EVALUATED)){l.setTickFlag(cc.EVALUATED);var c,h=l.absoluteWeight,f=void 0;l.kind===sc.empty?(r-=h,f=null):f=null!==(c=l.evaluate(t))&&void 0!==c?c:this._pushNullishPose(t),f&&(o&&(a+=h)?(bi(o,f,h/a),t.popPose()):o=f)}}return this.passthroughWeight=r,o},e._pushNullishPose=function(t){return this._additive?t.pushZeroDeltaPose():t.pushDefaultedPose()},e._matchNextTransition=function(t){var e=this._matchTransition(t,t);if(e)return e;if(t.kind===sc.animation||t.kind===sc.procedural){var n=this._matchAnyScoped(t);if(n)return n}return null},e._matchAnyScoped=function(t){for(var e=t.stateMachine;null!==e;e=e.parent){var n=this._matchTransition(e.any,t);if(n)return n}return null},e._matchTransition=function(t,e){_(t===e||t.kind===sc.any),this._conditionEvaluationContext.set(e);for(var n=t.outgoingTransitions,i=n.length,r=0;r<i;++r){var o=n[r];if(!o.activated){var a=o.conditions,s=a.length;if(0===s){if(t.kind===sc.entry||t.kind===sc.exit)return o;if(!o.exitConditionEnabled)continue}if(e.kind===sc.animation&&o.exitConditionEnabled){var u=e.duration*o.exitCondition;if(e.time<u)break}for(var l=!0,c=0;c<s;++c)if(!a[c].eval(this._conditionEvaluationContext)){l=!1;break}if(l)return o}}return null},e._activateTransition=function(t,e){var n=e.to;_(ac(n));var i=this._activatedTransitionPool.alloc();i.reset(t,e),this._activatedTransitions.push(i);for(var r=i.path.length,o=0;o<r;++o){var a=i.path[o];this._resetTriggersOnTransition(a)}for(var s=0;s<i.path.length;++s){var u=i.path[s];this._callEnterMethods(u.to)}_(this._activatedTransitions.length>0);var l=1===this._activatedTransitions.length?this._currentNode:this._activatedTransitions[this._activatedTransitions.length-2].destination;l instanceof fc&&l.transitionOutEventBinding&&this._emit(l.transitionOutEventBinding),e.startEventBinding&&this._emit(e.startEventBinding),n instanceof fc&&n.transitionInEventBinding&&this._emit(n.transitionInEventBinding)},e._updateActivatedTransitions=function(t){for(var e=this._activatedTransitions,n=e.length-1,i=1,r=n;n>=0;--n){var o=e[n],a=0===n?this._currentNode:e[n-1].destination;if(o.update(t,a),o.done){this._dropActivatedTransitions(r);break}var s=o.normalizedElapsedTime*i;o.destination.increaseAbsoluteWeight(s),i*=1-o.normalizedElapsedTime,r=n-1}this._currentNode.increaseAbsoluteWeight(i)},e._dropActivatedTransitions=function(t){var e=this._activatedTransitions,n=this._activatedTransitionPool;_(t>=0&&t<e.length);var i=t+1,r=e[t],o=r.destination;_(0!==r.path.length);var a=r.path[r.path.length-1];a.endEventBinding&&this._emit(a.endEventBinding),this._callExitMethods(this._currentNode);for(var s=0;s<=t;++s){var u=e[s];s!==t&&u.destination.decreaseActiveReference();for(var l=s===t?u.path.length-1:u.path.length,c=0;c<l;++c){var h=u.path[c];this._callExitMethods(h.to)}n.free(u)}if(t===e.length-1)e.length=0;else{for(var f=t+1;f<e.length;++f)e[f-i]=e[f];e.length-=i}this._currentNode.decreaseActiveReference(),this._currentNode=o},e._resetTriggersOnTransition=function(t){var e=t.triggers;if(e)for(var n=e.length,i=0;i<n;++i){var r=e[i];this._resetTrigger(r)}},e._resetTrigger=function(t){(0,this._triggerReset)(t)},e._callEnterMethods=function(t){var e,n=this._controller;switch(t.kind){default:break;case sc.animation:t.components.callMotionStateEnterMethods(n,t.getStatus());break;case sc.entry:null===(e=t.stateMachine.components)||void 0===e||e.callStateMachineEnterMethods(n)}},e._callExitMethods=function(t){var e,n=this._controller;switch(t.kind){default:break;case sc.animation:t.components.callMotionStateExitMethods(n,t.getStatus());break;case sc.exit:null===(e=t.stateMachine.components)||void 0===e||e.callStateMachineExitMethods(n)}},e._emit=function(t){t.emit(this._controller.node)},r(t,[{key:"exited",get:function(){return this._currentNode===this._topLevelExit}}]),t}();function ac(t){return t.kind===sc.animation||t.kind===sc.empty||t.kind===sc.procedural}var sc,uc={next:function(){return{done:!0,value:void 0}}},lc=((ec={})[Symbol.iterator]=function(){return uc},ec);!function(t){t[t.entry=0]="entry",t[t.exit=1]="exit",t[t.any=2]="any",t[t.animation=3]="animation",t[t.empty=4]="empty",t[t.procedural=5]="procedural"}(sc||(sc={}));var cc,hc=function(){function t(t){this.name=void 0,this.outgoingTransitions=[],this._activeReferenceCount=0,this._tickFlags=0,this._absoluteWeight=0,this.name=t.name}var e=t.prototype;return e.setPrefix_debug=function(t){this.__DEBUG_ID__=""+t+this.name},e.addTransition=function(t){this.outgoingTransitions.push(t)},e.increaseActiveReference=function(){0===this._activeReferenceCount&&(this._absoluteWeight=0,this._tickFlags=0),++this._activeReferenceCount},e.decreaseActiveReference=function(){--this._activeReferenceCount},e.resetTickFlagsAndWeight=function(){this._checkActivated(),this._absoluteWeight=0,this._tickFlags=0},e.increaseAbsoluteWeight=function(t){this._absoluteWeight+=t},e.testTickFlag=function(t){return!!(this._tickFlags&t)},e.setTickFlag=function(t){_(!this.testTickFlag(t),"Can not set "+cc[t]+" since it has been set!"),this._tickFlags|=t},e._checkActivated=function(){_(this._activeReferenceCount>0)},r(t,[{key:"absoluteWeight",get:function(){return this._absoluteWeight}},{key:"activeReferenceCount",get:function(){return this._activeReferenceCount}}]),t}(),fc=function(t){function e(e){var n;return(n=t.call(this,e)||this).transitionInEventBinding=void 0,n.transitionOutEventBinding=void 0,e.transitionInEventBinding.isBound&&(n.transitionInEventBinding=e.transitionInEventBinding),e.transitionOutEventBinding.isBound&&(n.transitionOutEventBinding=e.transitionOutEventBinding),n}return n(e,t),e}(hc);!function(t){t[t.UPDATED=1]="UPDATED",t[t.EVALUATED=2]="EVALUATED"}(cc||(cc={}));var pc=function(){function t(t){this._components=t.instantiateComponents()}var e=t.prototype;return e.callMotionStateEnterMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateEnter",t,e)},e.callMotionStateUpdateMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateUpdate",t,e)},e.callMotionStateExitMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateExit",t,e)},e.callStateMachineEnterMethods=function(t){this._callStateMachineCallbackIfNonDefault("onStateMachineEnter",t)},e.callStateMachineExitMethods=function(t){this._callStateMachineCallbackIfNonDefault("onStateMachineExit",t)},e._callMotionStateCallbackIfNonDefault=function(t,e,n){for(var i=this._components,r=i.length,o=0;o<r;++o){var a=i[o];a[t]!==Mu.prototype[t]&&a[t](e,n)}},e._callStateMachineCallbackIfNonDefault=function(t,e){for(var n=this._components,i=n.length,r=0;r<i;++r){var o=n[r];o[t]!==Mu.prototype[t]&&o[t](e)}},t}(),dc=function(){function t(t,e){var n,i;this._source=null,this._baseSpeed=1,this._speed=1,this._publicState=void 0,this._privateState=void 0;var r=t.name;if(this._baseSpeed=t.speed,this._setSpeedMultiplier(1),t.speedMultiplierEnabled&&t.speedMultiplier){var o=t.speedMultiplier,a=e.getVar(o);if(Ea(a,o)){!function(t,e,n){if(t!==e)throw new un(n,"number")}(a.type,Te.FLOAT,o),a.bind(this._setSpeedMultiplier,this);var s=a.value;this._setSpeedMultiplier(s)}}var u=null!==(n=null===(i=t.motion)||void 0===i?void 0:i[vo](e,!1))&&void 0!==n?n:null;u&&Object.defineProperty(u,"__DEBUG_ID__",{value:r}),this._source=u,this._publicState=new vc(this,t,null==u?void 0:u.createPort()),this._privateState=new vc(this,t,null==u?void 0:u.createPort()),this.components=new pc(t)}var e=t.prototype;return e.setPrefix_debug=function(t){this._publicState.setPrefix_debug(t),this._privateState.setPrefix_debug(t)},e.addTransition=function(t){t.to===this._publicState?this._publicState.addTransition(H({},t,{to:this._privateState})):this._publicState.addTransition(t),this._privateState.addTransition(t)},e.getClipStatuses=function(t){var e,n=this._source;return n?((e={})[Symbol.iterator]=function(){return n.getClipStatuses(t)},e):lc},e.overrideClips=function(t){var e;null===(e=this._source)||void 0===e||e.overrideClips(t)},e._setSpeedMultiplier=function(t){this._speed=this._baseSpeed*t},r(t,[{key:"duration",get:function(){var t,e;return null!==(t=null===(e=this._source)||void 0===e?void 0:e.duration)&&void 0!==t?t:0}},{key:"speed",get:function(){return this._speed}},{key:"entry",get:function(){return this._publicState}},{key:"stateMachine",get:function(){return this._stateMachine},set:function(t){this._stateMachine=t,this._publicState.stateMachine=t,this._privateState.stateMachine=t}}]),t}(),vc=function(t){function e(e,n,i){var r;return(r=t.call(this,n)||this).kind=sc.animation,r._container=void 0,r._progress=0,r._port=void 0,r._statusCache={progress:0},r._container=e,r._port=i,r}n(e,t);var i=e.prototype;return i.reenter=function(t){var e;this._progress=t,null===(e=this._port)||void 0===e||e.reenter()},i.getStatus=function(){var t=this._statusCache;return t.progress=_c(this._progress),t},i.getClipStatuses=function(t){return this._container.getClipStatuses(t)},i.update=function(t,e){this._progress=function(t,e,n){return 0===e?0:t+n/e}(this._progress,this.duration,t*this._container.speed),this._container.components.callMotionStateUpdateMethods(e,this.getStatus())},i.evaluate=function(t){var e,n;return null!==(e=null===(n=this._port)||void 0===n?void 0:n.evaluate(this._progress,t))&&void 0!==e?e:null},r(e,[{key:"duration",get:function(){return this._container.duration}},{key:"components",get:function(){return this._container.components}},{key:"normalizedTime",get:function(){return this._progress}},{key:"time",get:function(){return this._progress*this._container.duration}}]),e}(fc);function _c(t){var e=t-Math.trunc(t);return e>=0?e:1+e}var yc,gc,mc,Ec,Tc,Ac,bc,Cc,Sc,wc,Pc,Oc,Nc,Ic,xc=function(t){function e(e,n){var i;return(i=t.call(this,e)||this).kind=void 0,i.kind=n,i}return n(e,t),e}(hc),Rc=function(t){function e(e){var n;return(n=t.call(this,e)||this).kind=sc.empty,n}return n(e,t),e}(hc),kc=function(t){function e(e,n){var i;(i=t.call(this,e)||this).kind=sc.procedural,i.elapsedTime=0,i.statusCache={progress:0},i._instantiatedPoseGraph=void 0,i._statusCache={progress:0},i._elapsedTime=0;var r=Xl(e.graph,n,!0);return r.bind(n),i._instantiatedPoseGraph=r,i._statusCache.progress=0,i}n(e,t);var i=e.prototype;return i.settle=function(t){this._instantiatedPoseGraph.settle(t)},i.reenter=function(){this._statusCache.progress=0,this._instantiatedPoseGraph.reenter()},i.update=function(t){this._elapsedTime+=t.deltaTime,this._instantiatedPoseGraph.update(t)},i.evaluate=function(t){var e;return null!==(e=this._instantiatedPoseGraph.evaluate(t))&&void 0!==e?e:null},i.getStatus=function(){return this._statusCache.progress=_c(this._elapsedTime),this._statusCache},i.countMotionTime=function(){return this._instantiatedPoseGraph.countMotionTime()},e}(fc),Lc=function(){function t(){this.sourceStateWeight=0,this._sourceState=void 0}var e=t.prototype;return e.set=function(t){this._sourceState=t,ac(t)?(_(t.activeReferenceCount),this.sourceStateWeight=t.absoluteWeight):this.sourceStateWeight=0},e.unset=function(){this._sourceState=void 0,this.sourceStateWeight=0},r(t,[{key:"sourceStateMotionTimeNormalized",get:function(){var t=this._sourceState;switch(_(t&&(t.kind===sc.animation||t.kind===sc.procedural)&&t.activeReferenceCount),t.kind){case sc.animation:return t.normalizedTime;case sc.procedural:return t.countMotionTime();default:return 0}}}]),t}(),Mc=function(){function t(){this.normalizedElapsedTime=0,this.path=[],this._durationMultiplier=1}var e=t.prototype;return e.getAbsoluteDuration=function(t){return this._getAbsoluteDurationUnscaled(t)*this._durationMultiplier},e.update=function(t,e){if(ac(e)){var n=this.getAbsoluteDuration(e),i=0;if(n<=0)i=0,this.normalizedElapsedTime=1;else{var r=this.normalizedElapsedTime*n,o=n-r;i=Math.min(o,t);var a=z((r+i)/n);this.normalizedElapsedTime=a}}else this.normalizedElapsedTime=1},t.createPool=function(e){return new j((function(){return new t}),e,void 0)},e.reset=function(t,e){var n=e.to;_(ac(n)),this.normalizedElapsedTime=0,this.destination=n,this.path=[].concat(t,[e]);var i=n.activeReferenceCount;if(n.increaseActiveReference(),0===i)if(n.kind===sc.animation){var r=this.path[0],o=r.destinationStart,a=r.relativeDestinationStart?o:0===n.duration?0:o/n.duration;n.reenter(a)}else n.kind===sc.procedural&&n.reenter();_(n.activeReferenceCount>0),this._durationMultiplier=1-n.absoluteWeight},e._getAbsoluteDurationUnscaled=function(t){_(0!==this.path.length);var e=this.path[0],n=e.duration;return e.normalizedDuration?(t.kind===sc.animation?t.duration:1)*n:n},r(t,[{key:"done",get:function(){return V(this.normalizedElapsedTime,1,1e-6)}}]),t}();e(J+"PoseNodeStateMachine")(yc=Jn(Gs)(yc=ti({themeColor:"#CCCCCC",inline:!0})((gc=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name=mc&&mc(),e.stateMachine=Ec&&Ec(),e._stateMachineEval=void 0,e}n(e,t);var i=e.prototype;return i.__callOnAfterDeserializeRecursive=function(){this.stateMachine._allowEmptyStates=!1,this.stateMachine.__callOnAfterDeserializeRecursive()},i.bind=function(t){_(!this._stateMachineEval),this._stateMachineEval=new oc(this.stateMachine,"",t)},i.settle=function(t){var e;null===(e=this._stateMachineEval)||void 0===e||e.settle(t)},i.reenter=function(){var t;null===(t=this._stateMachineEval)||void 0===t||t.reenter()},i.doUpdate=function(t){var e=this._stateMachineEval;e.update(t),_(e.passthroughWeight>.99999)},i.doEvaluate=function(t){var e=this._stateMachineEval,n=e.evaluate(t);return _(e.passthroughWeight>.99999),n},e}(Fi),mc=i(gc.prototype,"name",[a],(function(){return""})),Ec=i(gc.prototype,"stateMachine",[a],(function(){return new uo(!1)})),yc=gc))||yc)||yc);var Dc,Bc,Fc,Uc,Vc,Gc,Wc,zc,jc,Hc,Qc,Yc,qc,Zc,Xc,Jc,Kc,$c,th,eh,nh,ih,rh,oh,ah,sh,uh,lh,ch,hh,fh=(Tc=e(J+"PoseNodeSampleMotion"),Ac=Jn(Gs),bc=Kn(jl((function(t){var e=new fh;return e.motion=t,e}))),Cc=ti({themeColor:"#D97721"}),Sc=Gi({type:jn.FLOAT}),Tc(wc=Ac(wc=bc(wc=Cc((Pc=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).motion=Oc&&Oc(),d(e,"time",Nc,R(e)),e.useNormalizedTime=Ic&&Ic(),e._workspace=null,e}n(e,t);var i=e.prototype;return i.bind=function(t){var e=this.motion;if(e){var n=e[vo](t,!0);if(n){var i=new ph(n,n.createPort());this._workspace=i}}},i.settle=function(){},i.reenter=function(){},i.doUpdate=function(){},i.doEvaluate=function(t){var e=this._workspace;if(!e)return t.pushDefaultedPose();var n=this.time,i=this.useNormalizedTime?n:n/e.motionEval.duration;return e.motionEvalPort.evaluate(z(i),t)},e}(Fi),Oc=i(Pc.prototype,"motion",[a],(function(){return new oa})),Nc=f(Pc.prototype,"time",[a,Sc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ic=i(Pc.prototype,"useNormalizedTime",[a],(function(){return!1})),wc=Pc))||wc)||wc)||wc)||wc),ph=function(t,e){this.motionEval=t,this.motionEvalPort=e};function dh(t){return t<1e-5}Dc=e(J+"PoseNodeAdditivelyBlend"),Bc=Jn(Ws),Fc=ti({themeColor:"#72A869"}),Uc=Gi({type:jn.POSE}),Vc=Gi({type:jn.POSE}),Gc=Gi({type:jn.FLOAT}),Dc(Wc=Bc(Wc=Fc((zc=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,d(e,"basePose",jc,R(e)),d(e,"additivePose",Hc,R(e)),d(e,"ratio",Qc,R(e)),e}n(e,t);var i=e.prototype;return i.bind=function(t){var e,n;null===(e=this.basePose)||void 0===e||e.bind(t),t._pushAdditiveFlag(!0),null===(n=this.additivePose)||void 0===n||n.bind(t),t._popAdditiveFlag()},i.settle=function(t){var e,n;null===(e=this.basePose)||void 0===e||e.settle(t),null===(n=this.additivePose)||void 0===n||n.settle(t)},i.reenter=function(){var t,e;null===(t=this.basePose)||void 0===t||t.reenter(),null===(e=this.additivePose)||void 0===e||e.reenter()},i.doUpdate=function(t){var e,n;null===(e=this.basePose)||void 0===e||e.update(t),null===(n=this.additivePose)||void 0===n||n.update(t)},i.doEvaluate=function(t){var e,n,i=null!==(e=null===(n=this.basePose)||void 0===n?void 0:n.evaluate(t,Ii.LOCAL))&&void 0!==e?e:t.pushDefaultedPose();return this.additivePose?(Oi(i,this.additivePose.evaluate(t,Ii.LOCAL),this.ratio),t.popPose(),i):i},e}(Fi),jc=f(zc.prototype,"basePose",[a,Uc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hc=f(zc.prototype,"additivePose",[a,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qc=f(zc.prototype,"ratio",[a,Gc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Wc=zc))||Wc)||Wc),Yc=e(J+"PoseNodeBlendInProportion"),qc=Jn(Ws),Zc=ti({themeColor:"#72A869"}),Xc=Gi({type:jn.POSE,arraySyncGroup:"blend-item"}),Jc=Gi({type:jn.FLOAT,arraySyncGroup:"blend-item",arraySyncGroupFollower:!0}),Yc(Kc=qc(Kc=Zc(($c=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,d(e,"poses",th,R(e)),d(e,"proportions",eh,R(e)),e._updateContextGenerator=new Gl,e}n(e,t);var i=e.prototype;return i.bind=function(t){for(var e,n=p(this.poses);!(e=n()).done;){var i=e.value;null==i||i.bind(t)}},i.settle=function(t){for(var e,n=p(this.poses);!(e=n()).done;){var i=e.value;null==i||i.settle(t)}},i.reenter=function(){for(var t,e=p(this.poses);!(t=e()).done;){var n=t.value;null==n||n.reenter()}},i.doUpdate=function(t){for(var e=this._updateContextGenerator,n=this.poses.length,i=0;i<n;++i){var r,o=this.proportions[i];if(!dh(o)){var a=e.generate(t.deltaTime,t.indicativeWeight*o);null===(r=this.poses[i])||void 0===r||r.update(a)}}},i.doEvaluate=function(t){for(var e=this.poses.length,n=0,i=null,r=0;r<e;++r){var o,a=this.proportions[r];if(!dh(a)){var s=null===(o=this.poses[r])||void 0===o?void 0:o.evaluate(t,Ii.LOCAL);s&&(n+=a,i?(n&&bi(i,s,a/n),t.popPose()):i=s)}}return i||t.pushDefaultedPose()},e}(Fi),th=f($c.prototype,"poses",[a,Xc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eh=f($c.prototype,"proportions",[a,Jc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Kc=$c))||Kc)||Kc);var vh,_h,yh,gh,mh,Eh,Th,Ah,bh=(nh=e(J+"PoseNodeBlendTwoPoseBase"),ih=$n(!0),rh=Gi({type:jn.POSE}),oh=Gi({type:jn.POSE}),ah=Gi({type:jn.FLOAT}),nh(sh=ih((uh=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,d(e,"pose0",lh,R(e)),d(e,"pose1",ch,R(e)),d(e,"ratio",hh,R(e)),e._updateContextGenerator=new Gl,e}n(e,t);var i=e.prototype;return i.bind=function(t){var e,n;null===(e=this.pose0)||void 0===e||e.bind(t),null===(n=this.pose1)||void 0===n||n.bind(t)},i.settle=function(t){var e,n;null===(e=this.pose0)||void 0===e||e.settle(t),null===(n=this.pose1)||void 0===n||n.settle(t)},i.reenter=function(){var t,e;null===(t=this.pose0)||void 0===t||t.reenter(),null===(e=this.pose1)||void 0===e||e.reenter()},i.doUpdate=function(t){var e=this.pose0,n=this.pose1,i=this._updateContextGenerator,r=this.ratio,o=i.generate(t.deltaTime,t.indicativeWeight*(1-r));null==e||e.update(o);var a=i.generate(t.deltaTime,t.indicativeWeight*r);null==n||n.update(a)},i.doEvaluate=function(t){var n,i,r,o,a=Ii.LOCAL;if(!this.pose0||!this.pose1)return e.evaluateDefaultPose(t,a);var s=null!==(n=null===(i=this.pose0)||void 0===i?void 0:i.evaluate(t,a))&&void 0!==n?n:e.evaluateDefaultPose(t,a),u=null!==(r=null===(o=this.pose1)||void 0===o?void 0:o.evaluate(t,a))&&void 0!==r?r:e.evaluateDefaultPose(t,a);return this.doBlend(s,u,this.ratio),t.popPose(),s},e}(Fi),lh=f(uh.prototype,"pose0",[a,rh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ch=f(uh.prototype,"pose1",[a,oh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hh=f(uh.prototype,"ratio",[a,ah],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),sh=uh))||sh)||sh);e(J+"PoseNodeBlendTwoPose")(vh=Jn(Ws)(vh=ti({themeColor:"#72A869"})(vh=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e.prototype.doBlend=function(t,e,n){return bi(t,e,n)},e}(bh))||vh)||vh),_h=e(J+"PoseNodeFilteringBlend"),yh=Jn(Ws),gh=ti({themeColor:"#72A869"}),mh=F(Bs),_h(Eh=yh(Eh=gh((Th=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).mask=Ah&&Ah(),e._transformFilter=void 0,e}n(e,t);var i=e.prototype;return i.settle=function(e){if(t.prototype.settle.call(this,e),this.mask){var n=e.createTransformFilter(this.mask);this._transformFilter=n}},i.doBlend=function(t,e,n){bi(t,e,n,this._transformFilter)},e}(bh),Ah=i(Th.prototype,"mask",[a,mh],(function(){return null})),Eh=Th))||Eh)||Eh);var Ch,Sh,wh,Ph,Oh,Nh,Ih,xh,Rh,kh,Lh,Mh,Dh,Bh,Fh,Uh,Vh,Gh,Wh,zh,jh,Hh,Qh,Yh,qh,Zh,Xh,Jh,Kh,$h,tf,ef,nf=Gs+"/i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes_choose/",rf=1e-5,of=e(J+"PoseNodeChoosePoseBase")(Ch=$n()((Sh=function(t){function e(e){var n;return void 0===e&&(e=0),(n=t.call(this)||this)._poses=wh&&wh(),n._fadeInDurations=Ph&&Ph(),n._updateContextGenerator=new Gl,n._evaluationRecord=void 0,n._poses.length=e,n._poses.fill(null),n._fadeInDurations.length=e,n._fadeInDurations.fill(0),n}n(e,t);var i=e.prototype;return i.bind=function(t){for(var e,n=p(this._poses);!(e=n()).done;){var i=e.value;null==i||i.bind(t)}var r=new af(this._poses.length,this.getChosenIndex());this._evaluationRecord=r},i.settle=function(t){for(var e,n=p(this._poses);!(e=n()).done;){var i=e.value;null==i||i.settle(t)}},i.reenter=function(){for(var t,e=p(this._poses);!(t=e()).done;){var n=t.value;null==n||n.reenter()}},i.doUpdate=function(t){var e=this._poses,n=this._evaluationRecord;if(n.update(t.deltaTime,this.getChosenIndex(),this._fadeInDurations),!n.allWeightsAreZero()){var i=e.length,r=n.items;_(r.length===i);for(var o=0;o<i;++o){var a=r[o].weight;if(!dh(a)){var s=e[o],u=this._updateContextGenerator.generate(t.deltaTime,t.indicativeWeight*a);null==s||s.update(u)}}}},i.doEvaluate=function(t){var n=this._poses,i=this._evaluationRecord,r=Ii.LOCAL,o=n.length,a=i.items;_(a.length===n.length);var s=null;if(!i.allWeightsAreZero())for(var u=0,l=0;l<o;++l){var c,h=i.items[l].weight;if(!dh(h)){var f=null===(c=n[l])||void 0===c?void 0:c.evaluate(t,Ii.LOCAL);f&&(u+=h,s?(u&&bi(s,f,h/u),t.popPose()):s=f)}}return s||e.evaluateDefaultPose(t,r)},i.getChosenIndex=function(){return 0},e}(Fi),wh=i(Sh.prototype,"_poses",[a],(function(){return[]})),Ph=i(Sh.prototype,"_fadeInDurations",[a],(function(){return[]})),Ch=Sh))||Ch)||Ch,af=function(){function t(t,e){this._items=void 0,this._chosenPoseIndex=-1,this._elapsedTransitionTime=0,this._blendingDuration=0;var n=Array.from({length:t},(function(){return new sf}));e>=0&&e<t&&(n[e].selfSourceWeight=1,n[e].selfTargetWeight=1,n[e].weight=1),this._items=n}var e=t.prototype;return e.allWeightsAreZero=function(){return this._chosenPoseIndex<0},e.update=function(t,e,n){if(this._checkAlternation(e,n),!(this._chosenPoseIndex<0)){var i=this._elapsedTransitionTime,r=this._blendingDuration,o=this._items;if(!(i>=r)){var a=o.length,s=0,u=0;t>r-i?(this._elapsedTransitionTime=r,u=1):(this._elapsedTransitionTime+=t,u=this._elapsedTransitionTime/r);for(var l=0;l<a;++l){var c=o[l],h=O(c.selfSourceWeight,c.selfTargetWeight,u);s+=h,c.weight=h}if(!dh(s))for(var f=0;f<a;++f)o[f].weight/=s}}},e._checkAlternation=function(t,e){var n=this._items,i=this._chosenPoseIndex,r=n.length;if(r&&t!==i&&!(t<0||t>=r)){var o=Math.max(e[t],0);if(o<rf)for(var a=0;a<r;++a){var s=n[a];a===t?(s.selfSourceWeight=1,s.selfTargetWeight=1,s.weight=1):(s.selfSourceWeight=0,s.selfTargetWeight=0,s.weight=0)}else for(var u=this._blendingDuration<rf?1:this._elapsedTransitionTime/this._blendingDuration,l=0;l<r;++l){var c=n[l];c.selfSourceWeight=O(c.selfSourceWeight,c.selfTargetWeight,u),c.selfTargetWeight=l===t?1:0}this._chosenPoseIndex=t,this._elapsedTransitionTime=0,this._blendingDuration=o}},r(t,[{key:"items",get:function(){return this._items}}]),t}(),sf=function(){this.selfSourceWeight=0,this.selfTargetWeight=0,this.weight=0};Oh=e(J+"PoseNodeChoosePoseByBoolean"),Nh=Jn(nf),Ih=ti({themeColor:"#D07979"}),xh=Gi({type:jn.POSE}),Rh=Gi({type:jn.POSE}),kh=Gi({type:jn.FLOAT}),Lh=Gi({type:jn.FLOAT}),Mh=Gi({type:jn.BOOLEAN}),Oh(Dh=Nh(Dh=Ih((Bh=function(t){function e(){var e;return e=t.call(this,2)||this,d(e,"choice",Fh,R(e)),e}return n(e,t),e.prototype.getChosenIndex=function(){return this.choice?0:1},r(e,[{key:"truePose",get:function(){return this._poses[0]},set:function(t){this._poses[0]=t}},{key:"falsePose",get:function(){return this._poses[1]},set:function(t){this._poses[1]=t}},{key:"trueFadeInDuration",get:function(){return this._fadeInDurations[0]},set:function(t){this._fadeInDurations[0]=t}},{key:"falseFadeInDuration",get:function(){return this._fadeInDurations[1]},set:function(t){this._fadeInDurations[1]=t}}]),e}(of),f(Bh.prototype,"truePose",[xh],Object.getOwnPropertyDescriptor(Bh.prototype,"truePose"),Bh.prototype),f(Bh.prototype,"falsePose",[Rh],Object.getOwnPropertyDescriptor(Bh.prototype,"falsePose"),Bh.prototype),f(Bh.prototype,"trueFadeInDuration",[kh],Object.getOwnPropertyDescriptor(Bh.prototype,"trueFadeInDuration"),Bh.prototype),f(Bh.prototype,"falseFadeInDuration",[Lh],Object.getOwnPropertyDescriptor(Bh.prototype,"falseFadeInDuration"),Bh.prototype),Fh=f(Bh.prototype,"choice",[a,Mh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Dh=Bh))||Dh)||Dh),Uh=e(J+"PoseNodeChoosePoseByIndex"),Vh=Jn(nf),Gh=ti({themeColor:"#D07979"}),Wh=Gi({type:jn.POSE,arraySyncGroup:"choose-item"}),zh=Gi({type:jn.FLOAT,arraySyncGroup:"choose-item",arraySyncGroupFollower:!0}),jh=Gi({type:jn.INTEGER}),Uh(Hh=Vh(Hh=Gh((Qh=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,d(e,"choice",Yh,R(e)),e}return n(e,t),e.prototype.getChosenIndex=function(){return this.choice},r(e,[{key:"poses",get:function(){return this._poses},set:function(t){this._poses=t}},{key:"fadeInDurations",get:function(){return this._fadeInDurations},set:function(t){this._fadeInDurations=t}}]),e}(of),f(Qh.prototype,"poses",[Wh],Object.getOwnPropertyDescriptor(Qh.prototype,"poses"),Qh.prototype),f(Qh.prototype,"fadeInDurations",[zh],Object.getOwnPropertyDescriptor(Qh.prototype,"fadeInDurations"),Qh.prototype),Yh=f(Qh.prototype,"choice",[a,jh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Hh=Qh))||Hh)||Hh),function(t){t[t.VALUE=0]="VALUE",t[t.AUXILIARY_CURVE=1]="AUXILIARY_CURVE"}(ef||(ef={})),N(ef);var uf,lf,cf,hf,ff,pf,df,vf,_f,yf,gf,mf,Ef,Tf,Af,bf,Cf,Sf,wf,Pf,Of,Nf,If,xf,Rf,kf=(qh=e(J+"IntensitySpecification"),Zh=F(ef),qh((Jh=function(){function t(){this.type=Kh&&Kh(),this.value=$h&&$h(),this.auxiliaryCurveName=tf&&tf(),this._handle=void 0}var e=t.prototype;return e.bind=function(t){if(this.type===ef.AUXILIARY_CURVE&&this.auxiliaryCurveName){var e=t.bindAuxiliaryCurve(this.auxiliaryCurveName);this._handle=e}},e.evaluate=function(t){return this.type===ef.AUXILIARY_CURVE&&this._handle?t.auxiliaryCurves[this._handle.index]:this.value},t}(),Kh=i(Jh.prototype,"type",[Zh,a],(function(){return ef.VALUE})),$h=i(Jh.prototype,"value",[a],(function(){return 1})),tf=i(Jh.prototype,"auxiliaryCurveName",[a],(function(){return""})),Xh=Jh))||Xh),Lf=function(){this.transformIndex=-1,this.transform=new pi},Mf=function(){function t(){this._pool=new j((function(){return new Lf}),3),this._array=new Q(3),this._debugLastTransformIndex=-1}var e=t.prototype;return e.push=function(t,e){var n=this._pool.alloc();n.transformIndex=t,pi.copy(n.transform,e),this._array.push(n)},e.clear=function(){for(var t=this._array.length,e=0;e<t;++e){var n=this._array.get(e);this._pool.free(n)}this._array.clear()},r(t,[{key:"length",get:function(){return this._array.length}},{key:"array",get:function(){return this._array.array}}]),t}(),Df=function(){function t(t){this._transformFlags=[],this._transformFlags=new Array(t)}var e=t.prototype;return e.clear=function(){this._transformFlags.fill(!1)},e.test=function(t){return this._transformFlags[t]},e.set=function(t){this._transformFlags[t]=!0},e.unset=function(t){this._transformFlags[t]=!1},t}(),Bf=new pi,Ff=new pi,Uf=(uf=e(J+"PoseNodeModifyPoseBase"),lf=$n(),cf=Gi({type:jn.POSE}),uf(hf=lf((ff=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,d(e,"pose",pf,R(e)),e._modificationQueue=new Mf,e._spaceFlagTable=new Df(0),e}n(e,t);var i=e.prototype;return i.settle=function(t){var e;null===(e=this.pose)||void 0===e||e.settle(t),this._spaceFlagTable=new Df(t.transformCount)},i.reenter=function(){var t;null===(t=this.pose)||void 0===t||t.reenter()},i.bind=function(t){var e;null===(e=this.pose)||void 0===e||e.bind(t)},i.doUpdate=function(t){var e;null===(e=this.pose)||void 0===e||e.update(t)},i.doEvaluate=function(t){var e,n,i=this.getPoseTransformSpaceRequirement(),r=null!==(e=null===(n=this.pose)||void 0===n?void 0:n.evaluate(t,i))&&void 0!==e?e:Fi.evaluateDefaultPose(t,i),o=this._modificationQueue;return _(0===o.length),this.modifyPose(t,r,o),function(t,e,n,i){var r=n.length;if(0!==r)if(e._poseTransformSpace!==yi.LOCAL){_(e._poseTransformSpace===yi.COMPONENT),i.clear();for(var o=n.array[0].transformIndex,a=o,s=0;s<r;++s){var u=n.array[s].transformIndex;i.set(u),a=u}for(var l=o;l<e.transforms.length;++l){var c=t.parentTable[l];c<0||i.test(c)&&(i.set(l),a=l)}for(var h=a;h>=o;--h)if(i.test(h)){var f=t.parentTable[h];if(f>=0){var p=e.transforms.getTransform(h,Bf),d=e.transforms.getTransform(f,Ff);pi.calculateRelative(p,p,d),e.transforms.setTransform(h,p)}}for(var v=0;v<r;++v){var y=n.array[v],g=y.transformIndex,m=y.transform;e.transforms.setTransform(g,m),i.unset(g)}for(var E=o;E<=a;++E)if(i.test(E)){var T=t.parentTable[E],A=e.transforms.getTransform(E,Bf),b=e.transforms.getTransform(T,Ff);pi.multiply(A,b,A),e.transforms.setTransform(E,A)}}else for(var C=0;C<r;++C){var S=n.array[C],w=S.transformIndex,P=S.transform;e.transforms.setTransform(w,P)}}(t,r,o,this._spaceFlagTable),o.clear(),r},e}(Fi),pf=f(ff.prototype,"pose",[a,cf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hf=ff))||hf)||hf);!function(t){t[t.LEAVE_UNCHANGED=0]="LEAVE_UNCHANGED",t[t.REPLACE=1]="REPLACE",t[t.ADD=2]="ADD"}(Rf||(Rf={})),N(Rf);var Vf=1e-5,Gf=new pi;df=e(J+"PoseNodeApplyTransform"),vf=Jn(Gs),_f=ti({themeColor:"#72A869"}),yf=F(Rf),gf=Gi({type:jn.VEC3}),mf=F(Rf),Ef=Gi({type:jn.QUAT}),Tf=F(qu),Af=Gi({type:jn.FLOAT}),df(bf=vf(bf=_f((Cf=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).node=Sf&&Sf(),e.positionOperation=wf&&wf(),d(e,"position",Pf,R(e)),e.rotationOperation=Of&&Of(),d(e,"rotation",Nf,R(e)),e.intensity=If&&If(),e.transformSpace=xf&&xf(),e._transformHandle=null,e}n(e,t);var i=e.prototype;return i.bind=function(e){var n=this.node;if(t.prototype.bind.call(this,e),n){var i=e.bindTransformByName(n);i?(this._transformHandle=i,this.intensity.bind(e)):b("Failed to bind transform "+n)}},i.getPoseTransformSpaceRequirement=function(){return Ii.NO},i.modifyPose=function(t,e,n){var i=this._transformHandle;if(!i)return e;var r=this.intensity.evaluate(e);if(r<Vf)return e;var o=V(r,1,Vf),a=i.index,s=e.transforms.getTransform(a,Gf),u=this.rotationOperation;if(u!==Rf.LEAVE_UNCHANGED){var l=this.rotation,c=this.transformSpace;switch(t._convertPoseSpaceTransformToTargetSpace(s,c,e,a),u){default:case Rf.REPLACE:rp(s,l,r,o);break;case Rf.ADD:op(s,l,r,o)}t._convertTransformToPoseTransformSpace(s,c,e,a)}var h=this.positionOperation;if(h!==Rf.LEAVE_UNCHANGED){var f=this.position,p=this.transformSpace;switch(t._convertPoseSpaceTransformToTargetSpace(s,p,e,a),h){default:case Rf.REPLACE:ep(s,f,r,o);break;case Rf.ADD:np(s,f,r,o)}t._convertTransformToPoseTransformSpace(s,p,e,a)}return n.push(a,s),e},r(e,[{key:"intensityValue",get:function(){return this.intensity.value},set:function(t){this.intensity.value=t}}]),e}(Uf),Sf=i(Cf.prototype,"node",[a],(function(){return""})),wf=i(Cf.prototype,"positionOperation",[a,yf],(function(){return Rf.LEAVE_UNCHANGED})),Pf=f(Cf.prototype,"position",[a,gf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new y}}),Of=i(Cf.prototype,"rotationOperation",[a,mf],(function(){return Rf.LEAVE_UNCHANGED})),Nf=f(Cf.prototype,"rotation",[a,Ef],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new g}}),If=i(Cf.prototype,"intensity",[a],(function(){return new kf})),xf=i(Cf.prototype,"transformSpace",[a,Tf],(function(){return qu.WORLD})),f(Cf.prototype,"intensityValue",[Af],Object.getOwnPropertyDescriptor(Cf.prototype,"intensityValue"),Cf.prototype),bf=Cf))||bf)||bf);var Wf,zf,jf,Hf,Qf,Yf,qf,Zf,Xf,Jf,Kf,$f,tp=(Wf=new y,zf=new y,{replace:function(t,e,n,i){if(i)t.position=e;else{var r=y.copy(Wf,t.position);y.lerp(r,r,e,n),t.position=r}},add:function(t,e,n,i){var r=zf;i?y.copy(r,e):y.slerp(r,y.ZERO,e,n),y.add(r,t.position,r),t.position=r}}),ep=tp.replace,np=tp.add,ip=function(){var t=new g,e=new g;return{replace:function(e,n,i,r){if(r)e.rotation=n;else{var o=g.copy(t,e.rotation);g.slerp(o,o,n,i),e.rotation=o}},add:function(n,i,r,o){var a=g.copy(t,n.rotation),s=e;o?g.copy(s,i):g.slerp(s,g.IDENTITY,i,r),g.multiply(s,s,a),n.rotation=s}}}(),rp=ip.replace,op=ip.add,ap=new pi;!function(t){t[t.LOCAL=0]="LOCAL",t[t.COMPONENT=1]="COMPONENT"}($f||($f={})),N($f),jf=e(J+"PoseNodeCopyTransform"),Hf=Jn(Gs),Qf=ti({themeColor:"#72A869"}),Yf=F($f),jf(qf=Hf(qf=Qf((Zf=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).sourceNodeName=Xf&&Xf(),e.targetNodeName=Jf&&Jf(),e.space=Kf&&Kf(),e._workspace=void 0,e}n(e,t);var i=e.prototype;return i.bind=function(e){t.prototype.bind.call(this,e);var n=e.bindTransformByName(this.sourceNodeName),i=e.bindTransformByName(this.targetNodeName);if(!n||!i)return null==n||n.destroy(),void(null==i||i.destroy());this._workspace=new yp(n,i)},i.modifyPose=function(t,e){var n=this._workspace;if(n){var i=n.hSource.index,r=n.hTarget.index,o=e.transforms.getTransform(i,ap);e.transforms.setTransform(r,o)}},i.getPoseTransformSpaceRequirement=function(){return this.space===$f.COMPONENT?Ii.COMPONENT:Ii.LOCAL},e}(Uf),Xf=i(Zf.prototype,"sourceNodeName",[a],(function(){return""})),Jf=i(Zf.prototype,"targetNodeName",[a],(function(){return""})),Kf=i(Zf.prototype,"space",[a,Yf],(function(){return $f.COMPONENT})),qf=Zf))||qf)||qf);var sp,up,lp,cp,hp,fp,pp,dp,vp,_p,yp=function(t,e){this.hSource=t,this.hTarget=e};!function(t){t[t.LEAVE_UNCHANGED=0]="LEAVE_UNCHANGED",t[t.REPLACE=1]="REPLACE",t[t.ADD=2]="ADD"}(_p||(_p={})),N(_p),sp=e(J+"PoseNodeSetAuxiliaryCurve"),up=Jn(Gs),lp=Gi({type:jn.FLOAT}),cp=F(_p),sp(hp=up((fp=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).curveName=pp&&pp(),d(e,"curveValue",dp,R(e)),e.flag=vp&&vp(),e._handle=void 0,e}n(e,t);var i=e.prototype;return i.bind=function(e){t.prototype.bind.call(this,e),this.curveName&&(this._handle=e.bindAuxiliaryCurve(this.curveName))},i.getPoseTransformSpaceRequirement=function(){return Ii.NO},i.modifyPose=function(t,e){var n=this._handle;if(n)switch(this.flag){case _p.REPLACE:e.auxiliaryCurves[n.index]=this.curveValue;break;case _p.ADD:e.auxiliaryCurves[n.index]+=this.curveValue;break;case _p.LEAVE_UNCHANGED:}},e}(Uf),pp=i(fp.prototype,"curveName",[a],(function(){return""})),dp=f(fp.prototype,"curveValue",[a,lp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vp=i(fp.prototype,"flag",[a,cp],(function(){return _p.REPLACE})),hp=fp))||hp);var gp,mp,Ep,Tp,Ap,bp,Cp,Sp,wp,Pp,Op,Np,Ip,xp,Rp,kp,Lp,Mp,Dp,Bp,Fp,Up,Vp,Gp=function(){var t,e,n=new g,i=new y,r=new y,o=new y,a=(t=new y,e=new y,function(n,i,r,o,a){return g.rotationTo(n,y.subtract(t,r,i).normalize(),y.subtract(e,a,o).normalize())});return function(t,e,s,u,l){var c=y.copy(i,null!=l?l:e.position),h=t.position,f=e.position,p=s.position;s.rotation;var d=r,v=o;Wp(h,f,p,u,c,d,v);var _=a(n,h,f,h,d);g.multiply(_,_,t.rotation),t.rotation=_;var m=a(n,f,p,d,v);g.multiply(m,m,e.rotation),e.rotation=m,e.position=d,s.position=v}}(),Wp=(gp=new y,mp=new y,Ep=new y,function(t,e,n,i,r,o,a){var s=y.distance(t,e),u=y.distance(e,n),l=y.distance(t,i),c=y.subtract(gp,i,t);c.normalize();var h=s+u;if(l>=h)return y.scaleAndAdd(o,t,c,s),void y.scaleAndAdd(a,t,c,h);y.copy(a,i);var f=D((s*s+l*l-u*u)/(2*s*l),-1,1),p=y.subtract(mp,r,t),d=y.projectOnPlane(Ep,p,c);d.normalize();var v=s*f,_=s*s-v*v,g=Math.sqrt(_);y.scaleAndAdd(o,t,c,v),y.scaleAndAdd(o,o,d,g)}),zp=new pi,jp=new pi,Hp=new pi,Qp=new y,Yp=new y,qp=new pi;!function(t){t[t.NONE=0]="NONE",t[t.VALUE=1]="VALUE",t[t.BONE=2]="BONE"}(Vp||(Vp={})),N(Vp);var Zp=(Tp=e(J+"PoseNodeTwoBoneIKSolver.TargetSpecification"),Ap=F(Vp),bp=F(qu),Tp((Sp=function(){function t(t){this.type=wp&&wp(),this.targetPosition=Pp&&Pp(),this.targetPositionSpace=Op&&Op(),this.targetBone=Np&&Np(),this._sourceBoneHandle=void 0,this._targetBoneHandle=void 0,void 0!==t&&(this.type=t)}var e=t.prototype;return e.bind=function(t,e){var n;this._sourceBoneHandle=e,this.type===Vp.BONE&&this.targetBone&&(this._targetBoneHandle=null!==(n=t.bindTransformByName(this.targetBone))&&void 0!==n?n:void 0)},e.evaluate=function(t,e,n){if(_(this._sourceBoneHandle),this._targetBoneHandle)e.transforms.getPosition(this._targetBoneHandle.index,t);else if(this.type===Vp.NONE)e.transforms.getPosition(this._sourceBoneHandle.index,t);else{var i=pi.setIdentity(qp);i.position=this.targetPosition,n._convertTransformToPoseTransformSpace(i,this.targetPositionSpace,e,this._sourceBoneHandle.index),y.copy(t,i.position)}return t},t}(),wp=i(Sp.prototype,"type",[a,Ap],(function(){return Vp.VALUE})),Pp=i(Sp.prototype,"targetPosition",[a],(function(){return new y})),Op=i(Sp.prototype,"targetPositionSpace",[a,bp],(function(){return qu.WORLD})),Np=i(Sp.prototype,"targetBone",[a],(function(){return""})),Cp=Sp))||Cp);Ip=e(J+"PoseNodeTwoBoneIKSolver"),xp=Jn("i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes//i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes_ik/"),Rp=Gi({type:jn.VEC3}),kp=Gi({type:jn.VEC3}),Ip(Lp=xp((Mp=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).debug=Dp&&Dp(),e.endEffectorBoneName=Bp&&Bp(),e.endEffectorTarget=Fp&&Fp(),e.poleTarget=Up&&Up(),e._workspace=void 0,e}n(e,t);var i=e.prototype;return i.bind=function(e){if(t.prototype.bind.call(this,e),this.endEffectorBoneName){var n=e.getParentBoneNameByName(this.endEffectorBoneName),i=n?e.getParentBoneNameByName(n):"";if(n&&i){var r=e.bindTransformByName(this.endEffectorBoneName),o=e.bindTransformByName(n),a=e.bindTransformByName(i);r&&o&&a?(this.endEffectorTarget.bind(e,r),this.poleTarget.bind(e,o),this._workspace=new od(r,o,a)):(null==r||r.destroy(),null==o||o.destroy(),null==a||a.destroy())}}},i.getPoseTransformSpaceRequirement=function(){return Ii.COMPONENT},i.modifyPose=function(t,e,n){var i=this._workspace;if(i){var r=i.hRoot.index,o=i.hMiddle.index,a=i.hEndEffector.index,s=e.transforms.getTransform(r,zp),u=e.transforms.getTransform(o,jp),l=e.transforms.getTransform(a,Hp),c=this.endEffectorTarget.evaluate(Qp,e,t),h=this.poleTarget.evaluate(Yp,e,t);Gp(s,u,l,c,h,this.debug?this:void 0),n.push(r,s),n.push(o,u),n.push(a,l)}},r(e,[{key:"endEffectorTargetPosition",get:function(){return this.endEffectorTarget.targetPosition},set:function(t){y.copy(this.endEffectorTarget.targetPosition,t)}},{key:"poleTargetPosition",get:function(){return this.poleTarget.targetPosition},set:function(t){y.copy(this.poleTarget.targetPosition,t)}}]),e}(Uf),Dp=i(Mp.prototype,"debug",[a],(function(){return!1})),Bp=i(Mp.prototype,"endEffectorBoneName",[a],(function(){return""})),Fp=i(Mp.prototype,"endEffectorTarget",[a],(function(){return new Zp(Vp.VALUE)})),f(Mp.prototype,"endEffectorTargetPosition",[Rp],Object.getOwnPropertyDescriptor(Mp.prototype,"endEffectorTargetPosition"),Mp.prototype),Up=i(Mp.prototype,"poleTarget",[a],(function(){return new Zp(Vp.NONE)})),f(Mp.prototype,"poleTargetPosition",[kp],Object.getOwnPropertyDescriptor(Mp.prototype,"poleTargetPosition"),Mp.prototype),Lp=Mp))||Lp);var Xp,Jp,Kp,$p,td,ed,nd,id,rd,od=function(t,e,n){this.hEndEffector=t,this.hMiddle=e,this.hRoot=n},ad={listEntries:function(t){for(var e,n=[],i=p(t.animationGraph.variables);!(e=i()).done;){var r=e.value,o=r[0],a=r[1].type;if(a!==Te.TRIGGER){var s=void 0;switch(a){default:break;case Te.FLOAT:s=jn.FLOAT;break;case Te.INTEGER:s=jn.INTEGER;break;case Te.BOOLEAN:s=jn.BOOLEAN;break;case Te.VEC3_experimental:s=jn.VEC3;break;case Te.QUAT_experimental:s=jn.QUAT}void 0!==s&&n.push({arg:{name:o,type:s},menu:o})}}return n},create:function(t){var e;switch(t.type){default:throw new Error("Bad create node arg: "+jn[t.type]);case jn.FLOAT:e=new ud;break;case jn.INTEGER:e=new ld;break;case jn.BOOLEAN:e=new cd;break;case jn.VEC3:e=new hd;break;case jn.QUAT:e=new fd}return e.variableName=t.name,e}},sd=e(J+"PVNodeGetVariableBase")(Xp=Kn(ad)((Jp=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).variableName=Kp&&Kp(),e._varInstance=void 0,e}return n(e,t),e.prototype.link=function(t){this._varInstance=t.getVar(this.variableName)},e}(Vi),Kp=i(Jp.prototype,"variableName",[a],(function(){return""})),Xp=Jp))||Xp)||Xp,ud=e(J+"PVNodeGetVariableFloat")($p=$n()($p=ti({inline:!0,themeColor:"#8471CF"})($p=function(t){function e(){return t.call(this,jn.FLOAT)||this}return n(e,t),e.prototype.selfEvaluateDefaultOutput=function(){var t;return null===(t=this._varInstance)||void 0===t?void 0:t.value},e}(sd))||$p)||$p)||$p,ld=e(J+"PVNodeGetVariableInteger")(td=$n()(td=ti({inline:!0,themeColor:"#2A90DC"})(td=function(t){function e(){return t.call(this,jn.INTEGER)||this}return n(e,t),e.prototype.selfEvaluateDefaultOutput=function(){var t;return null===(t=this._varInstance)||void 0===t?void 0:t.value},e}(sd))||td)||td)||td,cd=e(J+"PVNodeGetVariableBoolean")(ed=$n()(ed=ti({inline:!0,themeColor:"#D07979"})(ed=function(t){function e(){return t.call(this,jn.BOOLEAN)||this}return n(e,t),e.prototype.selfEvaluateDefaultOutput=function(){var t;return null===(t=this._varInstance)||void 0===t?void 0:t.value},e}(sd))||ed)||ed)||ed,hd=e(J+"PVNodeGetVariableVec3")(nd=$n()(nd=ti({inline:!0,themeColor:"#D97721"})(nd=function(t){function e(){return t.call(this,jn.VEC3)||this}return n(e,t),e.prototype.selfEvaluateDefaultOutput=function(){var t;return null===(t=this._varInstance)||void 0===t?void 0:t.value},e}(sd))||nd)||nd)||nd,fd=e(J+"PVNodeGetVariableQuat")(id=$n()(id=ti({inline:!0,themeColor:"#B169C4"})(id=function(t){function e(){return t.call(this,jn.QUAT)||this}return n(e,t),e.prototype.selfEvaluateDefaultOutput=function(){var t;return null===(t=this._varInstance)||void 0===t?void 0:t.value},e}(sd))||id)||id)||id,pd=function(){function t(){this._groups=[]}var e=t.prototype;return e.register=function(t){var e=t.group,n=this._groups.find((function(t){return t.name===e}));return n||(n=new dd(e),this._groups.push(n)),n.addMember()},e.sync=function(){for(var t,e=p(this._groups);!(t=e()).done;)t.value.sync()},t}(),dd=function(){function t(t){this._lastLeader=void 0,this._records=[],this.name=t}var e=t.prototype;return e.addMember=function(){var t=new vd;return this._records.push(t),t},e.sync=function(){var t=this._records,e=t.length,n=this._lastLeader;if(this._lastLeader=void 0,!t.every((function(t){return!t.active}))){t.sort((function(t,e){var n=t.active?t.weight:-1;return(e.active?e.weight:-1)-n}));var i=0,r=t[0].weight;if(t[i]!==n)for(var o=0;o<e;++o){var a=t[o];if(!a.active||!V(a.weight,r,1e-6))break;if(a===n){i=o;break}}_(t[i].active),this._lastLeader=t[i];for(var s=t[i].normalizedTime,u=0;u<e;++u){var l=t[u];if(!l.active)break;l.normalizedTime=s,l.reset()}}},t}(),vd=function(){function t(){this.normalizedTime=0,this.weight=0,this.active=!1}var e=t.prototype;return e.notifyRenter=function(t){this.reset(),this.normalizedTime=t},e.notifyUpdate=function(t,e){this.normalizedTime+=t,this.active?this.weight+=e:(this.active=!0,this.weight=e)},e.reset=function(){this.active=!1,this.weight=0},e.getSyncedEnterTime=function(){return this.normalizedTime},t}();!function(t){t[t.UNINITIALIZED=0]="UNINITIALIZED",t[t.UNSETTLED=1]="UNSETTLED",t[t.SETTLED=2]="SETTLED",t[t.UP_TO_DATE=3]="UP_TO_DATE",t[t.OUTDATED=4]="OUTDATED",t[t.UPDATING=5]="UPDATING",t[t.UPDATED=6]="UPDATED",t[t.EVALUATING=7]="EVALUATING",t[t.EVALUATED=8]="EVALUATED"}(rd||(rd={}));var _d,yd,gd,md,Ed,Td,Ad=function(){function t(t){this._state=rd.UNINITIALIZED,this._instantiatedPoseGraph=void 0,this._maxRequestedUpdateTime=0,this._evaluationCache=null,this._updateContextGenerator=new Gl,this._allocator=t}var e=t.prototype;return e.set=function(t,e){_(this._state===rd.UNINITIALIZED);var n=Xl(t.graph,e);n.bind(e),this._instantiatedPoseGraph=n,this._state=rd.UNSETTLED},e.settle=function(t){_(this._state===rd.UNSETTLED||this._state===rd.SETTLED),_(this._instantiatedPoseGraph),this._instantiatedPoseGraph.settle(t),this._state=rd.SETTLED},e.reset=function(){switch(this._state){case rd.SETTLED:case rd.OUTDATED:break;case rd.UP_TO_DATE:this._state=rd.OUTDATED;break;case rd.UPDATED:case rd.EVALUATED:this._evaluationCache&&(this._allocator.destroyPose(this._evaluationCache),this._evaluationCache=null),this._maxRequestedUpdateTime=0,this._state=rd.UP_TO_DATE;break;case rd.UNINITIALIZED:}},e.reenter=function(){switch(this._state){default:_(!1,"Unexpected stash state "+this._state+" when reenter().");break;case rd.UP_TO_DATE:case rd.UPDATED:break;case rd.SETTLED:case rd.OUTDATED:this._state=rd.UP_TO_DATE,_(this._instantiatedPoseGraph),this._instantiatedPoseGraph.reenter()}},e.requestUpdate=function(t){var e=t.deltaTime;if(_(this._state===rd.OUTDATED||this._state===rd.UP_TO_DATE||this._state===rd.UPDATING||this._state===rd.UPDATED),_(this._instantiatedPoseGraph),this._state!==rd.UPDATING){var n=Math.max(0,e-this._maxRequestedUpdateTime);if(this._state!==rd.UPDATED||!V(n,0,1e-8)){this._state=rd.UPDATING,this._maxRequestedUpdateTime=Math.max(e,this._maxRequestedUpdateTime);var i=this._updateContextGenerator.generate(n,t.indicativeWeight);this._instantiatedPoseGraph.update(i),this._state=rd.UPDATED}}},e.evaluate=function(t){switch(this._state){default:_(!1,"Unexpected stash state "+this._state+" when evaluate().");break;case rd.EVALUATING:this._state=rd.EVALUATED;break;case rd.EVALUATED:break;case rd.UPDATED:var e;_(!this._evaluationCache),this._state=rd.EVALUATING;var n=null===(e=this._instantiatedPoseGraph)||void 0===e?void 0:e.evaluate(t);if(this._state=rd.EVALUATED,n){var i=this._allocator.allocatePose();i.transforms.set(n.transforms),i.auxiliaryCurves.set(n.auxiliaryCurves),this._evaluationCache=i,t.popPose()}this._state=rd.EVALUATED}return _(this._state===rd.EVALUATED),_(this._instantiatedPoseGraph),this._evaluationCache?t.pushDuplicatedPose(this._evaluationCache):null},t}(),bd=function(){function t(t){this._allocator=void 0,this._stashEvaluations={},this._allocator=t}var e=t.prototype;return e.bindStash=function(t){return this._stashEvaluations[t]},e.getStash=function(t){return this._stashEvaluations[t]},e.addStash=function(t){this._stashEvaluations[t]=new Ad(this._allocator)},e.setStash=function(t,e,n){_(t in this._stashEvaluations),this._stashEvaluations[t].set(e,n)},e.reset=function(){for(var t in this._stashEvaluations)this._stashEvaluations[t].reset()},e.settle=function(t){for(var e in this._stashEvaluations)this._stashEvaluations[e].settle(t)},t}(),Cd=function(t){function e(e,n,i){var r;(r=t.call(this)||this)._layerRecords=void 0;var o=e.layers.map((function(t){return new Sd(t,n,i)}));return r._layerRecords=o,r}n(e,t);var i=e.prototype;return i.reenter=function(){},i.bind=function(){},i.settle=function(t){for(var e=this._layerRecords,n=e.length,i=0;i<n;++i)e[i].settle(t)},i.getLayerWeight=function(t){return _(t>=0&&t<this._layerRecords.length),this._layerRecords[t].weight},i.setLayerWeight=function(t,e){_(t>=0&&t<this._layerRecords.length),this._layerRecords[t].weight=e},i.getLayerTopLevelStateMachineEvaluation=function(t){return this._layerRecords[t].stateMachineEvaluation},i.overrideClips=function(t){for(var e=this._layerRecords,n=e.length,i=0;i<n;++i){var r=e[i];t._pushAdditiveFlag(r.additive),r.stateMachineEvaluation.overrideClips(t),t._popAdditiveFlag()}},i.doUpdate=function(t){for(var e=this._layerRecords,n=e.length,i=0;i<n;++i)e[i].update(t)},i.doEvaluate=function(t){for(var e=t.pushDefaultedPose(),n=this._layerRecords,i=n.length,r=0;r<i;++r){var o=n[r],a=o.stateMachineEvaluation.evaluate(t),s=o.weight*o.stateMachineEvaluation.passthroughWeight,u=o.transformFilter;o.additive?Oi(e,a,s,u):bi(e,a,s,u),t.popPose(),o.postEvaluate()}return e},r(e,[{key:"layerCount",get:function(){return this._layerRecords.length}}]),e}(Fi),Sd=function(){function t(t,e,n){var i;this.additive=!1,this.weight=0,this._topLevelStateMachineEval=void 0,this._stashManager=void 0,this._motionSyncManager=void 0,this._mask=void 0,this.transformFilter=void 0;for(var r,o=new bd(n),a=p(t.stashes());!(r=a()).done;){var s=r.value,u=s[0];s[1],o.addStash(u)}this._stashManager=o;var l=new pd;this._motionSyncManager=l,e._setLayerWideContextProperties(o,l);for(var c,h=p(t.stashes());!(c=h()).done;){var f=c.value,d=f[0],v=f[1];o.setStash(d,v,e)}this.weight=t.weight;var _=this.additive=t.additive;this._mask=null!==(i=t.mask)&&void 0!==i?i:void 0,e._pushAdditiveFlag(_),this._topLevelStateMachineEval=new oc(t.stateMachine,t.name,e),e._popAdditiveFlag(),e._unsetLayerWideContextProperties()}var e=t.prototype;return e.settle=function(t){this._mask&&(this.transformFilter=t.createTransformFilter(this._mask)),this._stashManager.settle(t),this._topLevelStateMachineEval.settle(t)},e.update=function(t){this.stateMachineEvaluation.update(t),this._motionSyncManager.sync()},e.postEvaluate=function(){this._stashManager.reset()},r(t,[{key:"stateMachineEvaluation",get:function(){return this._topLevelStateMachineEval}}]),t}(),wd=function(){function t(t,e,n,i){this._currentTransitionCache={duration:0,time:0},this._rootPoseNode=void 0,this._varInstances={},this._hasAutoTrigger=!1,this._auxiliaryCurveRegistry=new dl,this._poseLayoutMaintainer=void 0,this._bindingContext=void 0,this._settleContext=void 0,this._rootUpdateContextGenerator=new Gl;for(var r,o=p(t.variables);!(r=o()).done;){var a=r.value,s=a[0],u=a[1][Be]();this._varInstances[s]=u,u instanceof tn&&u.resetMode===De.NEXT_FRAME_OR_AFTER_CONSUMED&&(this._hasAutoTrigger=!0)}var l=new vl(e,this._auxiliaryCurveRegistry);this._poseLayoutMaintainer=l;var c=new fl(e,l,this._varInstances,n);c._setClipOverrides(null!=i?i:void 0),this._bindingContext=c;var h=new Ml(l);this._settleContext=h,l.startBind();var f=new Wl;this._poseStashAllocator=f,this._rootPoseNode=new Cd(t,c,f),this._root=e,this._initializeContexts()}var e=t.prototype;return e.destroy=function(){this._evaluationContext.destroy()},e._destroyAfterException_debugging=function(){var t=this._evaluationContext._stackSize_debugging;if(0!==t)for(var e=0;e<t;++e)this._evaluationContext.popPose();this._evaluationContext.destroy()},e.update=function(t){var e=this._evaluationContext,n=this._poseLayoutMaintainer,i=this._rootUpdateContextGenerator,r=this._rootPoseNode,o=i.generate(t,1);r.update(o);var a=r.evaluate(e,Ii.LOCAL);if(this._hasAutoTrigger){var s=this._varInstances;for(var u in s){var l=s[u];l instanceof tn&&l.resetMode===De.NEXT_FRAME_OR_AFTER_CONSUMED&&(l.value=!1)}}n.apply(a),e.popPose()},e.getVariables=function(){return Object.entries(this._varInstances)},e.getCurrentStateStatus=function(t){return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getCurrentStateStatus()},e.getCurrentClipStatuses=function(t){return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getCurrentClipStatuses()},e.getCurrentTransition=function(t){var e=this._currentTransitionCache;return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getCurrentTransition(e)?e:null},e.getNextStateStatus=function(t){return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getNextStateStatus()},e.getNextClipStatuses=function(t){return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getNextClipStatuses()},e.getValue=function(t){var e=this._varInstances[t];return e?e.value:void 0},e.setValue=function(t,e){var n=this._varInstances[t];n&&(n.value=e)},e.getLayerWeight=function(t){return this._rootPoseNode.getLayerWeight(t)},e.setLayerWeight=function(t,e){this._rootPoseNode.setLayerWeight(t,e)},e.overrideClips=function(t){this._poseLayoutMaintainer.startBind(),this._bindingContext._setClipOverrides(t),this._rootPoseNode.overrideClips(this._bindingContext),this._updateAfterPossiblePoseLayoutChange()},e.getAuxiliaryCurveValue=function(t){return this._auxiliaryCurveRegistry.get(t)},e._initializeContexts=function(){var t=this._poseLayoutMaintainer;t.endBind(),this._createOrUpdateTransformFilters();var e=t.createEvaluationContext();this._evaluationContext=e,t.fetchDefaultTransforms(e[Ll]),t.resetPoseStashAllocator(this._poseStashAllocator)},e._updateAfterPossiblePoseLayoutChange=function(){var t=this._poseLayoutMaintainer,e=t.endBind();if(0!==e){(e&hl.TRANSFORM_COUNT||e&hl.TRANSFORM_ORDER)&&this._createOrUpdateTransformFilters();var n=!1;if(e&hl.TRANSFORM_COUNT||e&hl.AUXILIARY_CURVE_COUNT){var i=t.createEvaluationContext();this._evaluationContext.destroy(),this._evaluationContext=i,n=!0,t.resetPoseStashAllocator(this._poseStashAllocator)}(n||e&hl.TRANSFORM_COUNT||e&hl.TRANSFORM_ORDER)&&t.fetchDefaultTransforms(this._evaluationContext[Ll])}},e._createOrUpdateTransformFilters=function(){this._rootPoseNode.settle(this._settleContext)},r(t,[{key:"layerCount",get:function(){return this._rootPoseNode.layerCount}}]),t}(),Pd=F,Od=a,Nd=Y,Id=(_d=e("cc.animation.AnimationController"),yd=Pd(xn),gd=Nd("graph"),_d((Ed=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._graph=Td&&Td(),e._graphEval=null,e}n(e,t);var i=e.prototype;return i.__preload=function(){var t=this.graph;if(t){var e,n=null;if(t instanceof Us){if(!t.original)return;e=t.original,n=t.clipOverrides}else e=t;var i=new wd(e,this.node,this,n);this._graphEval=i}},i.onDestroy=function(){var t;null===(t=this._graphEval)||void 0===t||t.destroy()},i.update=function(t){var e;null===(e=this._graphEval)||void 0===e||e.update(t)},i.getVariables=function(){return this._graphEval.getVariables()},i.setValue=function(t,e){return this.setValue_experimental(t,e)},i.setValue_experimental=function(t,e){this._graphEval.setValue(t,e)},i.getValue=function(t){var e=this.getValue_experimental(t);return"object"==typeof e?void 0:e},i.getValue_experimental=function(t){return this._graphEval.getValue(t)},i.getCurrentStateStatus=function(t){return this._graphEval.getCurrentStateStatus(t)},i.getCurrentClipStatuses=function(t){return this._graphEval.getCurrentClipStatuses(t)},i.getCurrentTransition=function(t){return this._graphEval.getCurrentTransition(t)},i.getNextStateStatus=function(t){return this._graphEval.getNextStateStatus(t)},i.getNextClipStatuses=function(t){return this._graphEval.getNextClipStatuses(t)},i.getLayerWeight=function(t){return this._graphEval.getLayerWeight(t)},i.setLayerWeight=function(t,e){return this._graphEval.setLayerWeight(t,e)},i.overrideClips_experimental=function(t){this._graphEval.overrideClips(t)},i.getAuxiliaryCurveValue_experimental=function(t){var e=this._graphEval;return e?e.getAuxiliaryCurveValue(t):0},r(e,[{key:"graph",get:function(){return this._graph},set:function(t){this._graph=t}},{key:"layerCount",get:function(){var t,e;return null!==(t=null===(e=this._graphEval)||void 0===e?void 0:e.layerCount)&&void 0!==t?t:0}}]),e}(Bt),f(Ed.prototype,"graph",[yd],Object.getOwnPropertyDescriptor(Ed.prototype,"graph"),Ed.prototype),Td=i(Ed.prototype,"_graph",[Od,gd],(function(){return null})),md=Ed))||md);t("animation",Object.freeze({__proto__:null,UniformProxyFactory:be,MorphWeightValueProxy:Ce,MorphWeightsValueProxy:Se,MorphWeightsAllValueProxy:we,Track:et,TrackPath:ht,RealTrack:ft,VectorTrack:pt,QuatTrack:dt,ColorTrack:vt,SizeTrack:_t,ObjectTrack:yt,isPropertyPath:gt,isCustomPath:mt,HierarchyPath:Et,ComponentPath:Tt,CubicSplineVec2Value:At,CubicSplineVec3Value:bt,CubicSplineVec4Value:Ct,CubicSplineQuatValue:St,CubicSplineNumberValue:wt,AnimationController:Id,get VariableType(){return Te},StateMachineComponent:Mu}));var xd,Rd=function(){function t(){this._nodeBlendStates=new Map}var e=t.prototype;return e.createWriter=function(t,e,n,i){var r=this.ref(t,e);return new kd(t,e,r,n,i)},e.destroyWriter=function(t){var e=t;this.deRef(e.node,e.property)},e.ref=function(t,e){var n=this._nodeBlendStates.get(t);return n||(n=this.createNodeBlendState(),this._nodeBlendStates.set(t,n)),n.refProperty(t,e)},e.deRef=function(t,e){var n=this._nodeBlendStates.get(t);n&&(n.deRefProperty(e),n.empty&&this._nodeBlendStates.delete(t))},e.apply=function(){this._nodeBlendStates.forEach((function(t,e){t.apply(e)}))},t}(),kd=function(){function t(t,e,n,i,r){this._node=t,this._property=e,this._propertyBlendState=n,this._host=i,this._constants=r}var e=t.prototype;return e.getValue=function(){return this._node[this._property]},e.setValue=function(t){var e=this._propertyBlendState,n=this._host.weight;e.blend(t,n)},r(t,[{key:"node",get:function(){return this._node}},{key:"property",get:function(){return this._property}}]),t}();!function(t){t[t.POSITION=1]="POSITION",t[t.ROTATION=2]="ROTATION",t[t.SCALE=4]="SCALE",t[t.EULER_ANGLES=8]="EULER_ANGLES"}(xd||(xd={})),xd.POSITION,xd.ROTATION,xd.SCALE,xd.EULER_ANGLES;var Ld,Md,Dd=function(){function t(){this.refCount=0,this.accumulatedWeight=0,this.result=new y}var e=t.prototype;return e.blend=function(t,e){this.accumulatedWeight=function(t,e,n,i,r){var o=n+r;if(1!==r||n){if(o){var a=r/o;y.lerp(t,t,i,a)}}else y.copy(t,i);return o}(this.result,this.result,this.accumulatedWeight,t,e)},e.reset=function(){this.accumulatedWeight=0,y.zero(this.result)},t}(),Bd=function(){function t(){this.refCount=0,this.accumulatedWeight=0,this.result=new g}var e=t.prototype;return e.blend=function(t,e){this.accumulatedWeight=function(t,e,n,i,r){var o=n+r;if(1!==r||n){if(o){var a=r/o;g.slerp(t,e,i,a)}}else g.copy(t,i);return o}(this.result,this.result,this.accumulatedWeight,t,e)},e.reset=function(){this.accumulatedWeight=0,g.identity(this.result)},t}(),Fd=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var i=e.prototype;return i.apply=function(e){var n=this._properties,i=n.position,r=n.scale,o=n.rotation,a=n.eulerAngles;i&&i.accumulatedWeight&&(this._transformApplyFlags|=xd.POSITION,i.accumulatedWeight<1&&i.blend(e.position,1-i.accumulatedWeight)),r&&r.accumulatedWeight&&(this._transformApplyFlags|=xd.SCALE,r.accumulatedWeight<1&&r.blend(e.scale,1-r.accumulatedWeight)),a&&a.accumulatedWeight&&(this._transformApplyFlags|=xd.EULER_ANGLES,a.accumulatedWeight<1&&a.blend(e.eulerAngles,1-a.accumulatedWeight)),o&&o.accumulatedWeight&&(this._transformApplyFlags|=xd.ROTATION,o.accumulatedWeight<1&&o.blend(e.rotation,1-o.accumulatedWeight)),t.prototype.apply.call(this,e),null==i||i.reset(),null==r||r.reset(),null==o||o.reset(),null==a||a.reset()},i._createVec3BlendState=function(){return new Dd},i._createQuatBlendState=function(){return new Bd},e}(function(){function t(){this._transformApplyFlags=0,this._properties={}}var e=t.prototype;return e.refProperty=function(t,e){var n,i,r,o=this._properties;switch(e){default:case"position":case"scale":case"eulerAngles":r=null!==(n=o[e])&&void 0!==n?n:o[e]=this._createVec3BlendState(t[e]);break;case"rotation":r=null!==(i=o[e])&&void 0!==i?i:o[e]=this._createQuatBlendState(t.rotation)}return++r.refCount,r},e.deRefProperty=function(t){var e=this._properties,n=e[t];n&&(--n.refCount,n.refCount>0||delete e[t])},e.apply=function(t){var e,n,i,r=this._transformApplyFlags,o=this._properties,a=o.position,s=o.scale,u=o.rotation,l=o.eulerAngles;r&&(a&&r&xd.POSITION&&(e=a.result),s&&r&xd.SCALE&&(n=s.result),l&&r&xd.EULER_ANGLES&&(i=l.result),u&&r&xd.ROTATION&&(i=u.result),(i||e||n)&&t.setRTS(i,e,n),this._transformApplyFlags=0)},r(t,[{key:"empty",get:function(){var t=this._properties;return!(t.position||t.rotation||t.eulerAngles||t.scale)}}]),t}()),Ud=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e.prototype.createNodeBlendState=function(){return new Fd},e}(Rd),Vd=t("AnimationManager",e(((Md=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._anims=new X([]),e._crossFades=new X([]),e._delayEvents=[],e._blendStateBuffer=new Ud,e._sockets=[],e}n(e,t);var i=e.prototype;return i.addCrossFade=function(t){-1===this._crossFades.array.indexOf(t)&&this._crossFades.push(t)},i.removeCrossFade=function(t){var e=this._crossFades.array.indexOf(t);e>=0?this._crossFades.fastRemoveAt(e):s(3907)},i.update=function(t){var e=this._delayEvents,n=this._crossFades,i=this._sockets,r=n.array;for(n.i=0;n.i<r.length;++n.i)r[n.i].update(t);var o=this._anims,a=o.array;for(o.i=0;o.i<a.length;++o.i){var s=a[o.i];s.isMotionless||s.update(t)}this._blendStateBuffer.apply();for(var u=Lt.getTotalFrames(),l=0,c=i.length;l<c;l++){var h=i[l],f=h.target,p=h.transform;f.matrix=Wt(p,u)}for(var d=0,v=e.length;d<v;d++){var _=e[d];_.fn.apply(_.thisArg,_.args)}e.length=0},i.destruct=function(){},i.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)},i.removeAnimation=function(t){var e=this._anims.array.indexOf(t);e>=0?this._anims.fastRemoveAt(e):s(3907)},i.pushDelayEvent=function(t,e,n){this._delayEvents.push({fn:t,thisArg:e,args:n})},i.addSockets=function(t,e){for(var n=this,i=function(){var i=e[r];if(n._sockets.find((function(t){return t.target===i.target})))return 1;var o=t.getChildByPath(i.path),a=i.target&&o&&jt(o,t);a&&n._sockets.push({target:i.target,transform:a})},r=0;r<e.length;++r)i()},i.removeSockets=function(t,e){for(var n=0;n<e.length;++n)for(var i=e[n],r=0;r<this._sockets.length;++r){var o=this._sockets[r];if(o.target===i.target){zt(o.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},r(e,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),e}(q)).ID="animation",Ld=Md))||Ld);Lt.on(Mt.EVENT_INIT,(function(){var t=new Vd;Lt.registerSystem(Vd.ID,t,q.Priority.HIGH)})),Z.AnimationManager=Vd}}}));
